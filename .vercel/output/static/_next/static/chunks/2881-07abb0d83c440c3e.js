(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2881],{40194:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},22604:e=>{"use strict";e.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:8,RTLD_LOCAL:4,E2BIG:7,EACCES:13,EADDRINUSE:48,EADDRNOTAVAIL:49,EAFNOSUPPORT:47,EAGAIN:35,EALREADY:37,EBADF:9,EBADMSG:94,EBUSY:16,ECANCELED:89,ECHILD:10,ECONNABORTED:53,ECONNREFUSED:61,ECONNRESET:54,EDEADLK:11,EDESTADDRREQ:39,EDOM:33,EDQUOT:69,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:65,EIDRM:90,EILSEQ:92,EINPROGRESS:36,EINTR:4,EINVAL:22,EIO:5,EISCONN:56,EISDIR:21,ELOOP:62,EMFILE:24,EMLINK:31,EMSGSIZE:40,EMULTIHOP:95,ENAMETOOLONG:63,ENETDOWN:50,ENETRESET:52,ENETUNREACH:51,ENFILE:23,ENOBUFS:55,ENODATA:96,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:77,ENOLINK:97,ENOMEM:12,ENOMSG:91,ENOPROTOOPT:42,ENOSPC:28,ENOSR:98,ENOSTR:99,ENOSYS:78,ENOTCONN:57,ENOTDIR:20,ENOTEMPTY:66,ENOTSOCK:38,ENOTSUP:45,ENOTTY:25,ENXIO:6,EOPNOTSUPP:102,EOVERFLOW:84,EPERM:1,EPIPE:32,EPROTO:100,EPROTONOSUPPORT:43,EPROTOTYPE:41,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:70,ETIME:101,ETIMEDOUT:60,ETXTBSY:26,EWOULDBLOCK:35,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:10,SIGFPE:8,SIGKILL:9,SIGUSR1:30,SIGSEGV:11,SIGUSR2:31,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:20,SIGCONT:19,SIGSTOP:17,SIGTSTP:18,SIGTTIN:21,SIGTTOU:22,SIGURG:16,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:23,SIGINFO:29,SIGSYS:12,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,EXTENSIONLESS_FORMAT_JAVASCRIPT:0,EXTENSIONLESS_FORMAT_WASM:1,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,UV_FS_O_FILEMAP:0,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:0x300000f0,SSL_OP_ALL:0x80000850,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:0x80000000,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:0x40000000,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:0x2000000,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:0x4000000,SSL_OP_NO_TLSv1_1:0x10000000,SSL_OP_NO_TLSv1_2:0x8000000,SSL_OP_NO_TLSv1_3:0x20000000,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},38437:(e,t,r)=>{e.exports=r(4327)},4327:function(e,t){!function(r,n){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function l(e){return e^=e>>>16,e=o(e,0x85ebca6b),e^=e>>>13,e=o(e,0xc2b2ae35),e^=e>>>16}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function c(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=h(e=f(e,[0,e[0]>>>1]),[0xff51afd7,0xed558ccd]),e=h(e=f(e,[0,e[0]>>>1]),[0xc4ceb9fe,0x1a85ec53]),e=f(e,[0,e[0]>>>1])}i.x86.hash32=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%4,n=e.length-r,u=t,h=0,c=0;c<n;c+=4)h=a(h=o(h=e[c]|e[c+1]<<8|e[c+2]<<16|e[c+3]<<24,0xcc9e2d51),15),u^=h=o(h,0x1b873593),u=o(u=a(u,13),5)+0xe6546b64;switch(h=0,r){case 3:h^=e[c+2]<<16;case 2:h^=e[c+1]<<8;case 1:h^=e[c],h=a(h=o(h,0xcc9e2d51),15),u^=h=o(h,0x1b873593)}return u^=e.length,(u=l(u))>>>0}},i.x86.hash128=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%16,n=e.length-r,u=t,h=t,c=t,d=t,f=0,p=0,g=0,y=0,m=0;m<n;m+=16)f=e[m]|e[m+1]<<8|e[m+2]<<16|e[m+3]<<24,p=e[m+4]|e[m+5]<<8|e[m+6]<<16|e[m+7]<<24,g=e[m+8]|e[m+9]<<8|e[m+10]<<16|e[m+11]<<24,y=e[m+12]|e[m+13]<<8|e[m+14]<<16|e[m+15]<<24,f=a(f=o(f,0x239b961b),15),u^=f=o(f,0xab0e9789),u=o(u=a(u,19)+h,5)+0x561ccd1b,p=a(p=o(p,0xab0e9789),16),h^=p=o(p,0x38b34ae5),h=o(h=a(h,17)+c,5)+0xbcaa747,g=a(g=o(g,0x38b34ae5),17),c^=g=o(g,0xa1e38b93),c=o(c=a(c,15)+d,5)+0x96cd1c35,y=a(y=o(y,0xa1e38b93),18),d^=y=o(y,0x239b961b),d=o(d=a(d,13)+u,5)+0x32ac3b17;switch(f=0,p=0,g=0,y=0,r){case 15:y^=e[m+14]<<16;case 14:y^=e[m+13]<<8;case 13:y^=e[m+12],y=a(y=o(y,0xa1e38b93),18),d^=y=o(y,0x239b961b);case 12:g^=e[m+11]<<24;case 11:g^=e[m+10]<<16;case 10:g^=e[m+9]<<8;case 9:g^=e[m+8],g=a(g=o(g,0x38b34ae5),17),c^=g=o(g,0xa1e38b93);case 8:p^=e[m+7]<<24;case 7:p^=e[m+6]<<16;case 6:p^=e[m+5]<<8;case 5:p^=e[m+4],p=a(p=o(p,0xab0e9789),16),h^=p=o(p,0x38b34ae5);case 4:f^=e[m+3]<<24;case 3:f^=e[m+2]<<16;case 2:f^=e[m+1]<<8;case 1:f^=e[m],f=a(f=o(f,0x239b961b),15),u^=f=o(f,0xab0e9789)}return u^=e.length,h^=e.length,c^=e.length,d^=e.length,u+=h,u+=c,u+=d,h+=u,c+=u,d+=u,u=l(u),h=l(h),c=l(c),d=l(d),u+=h,u+=c,u+=d,h+=u,c+=u,d+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)}},i.x64.hash128=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%16,n=e.length-r,o=[0,t],a=[0,t],l=[0,0],g=[0,0],y=[0x87c37b91,0x114253d5],m=[0x4cf5ad43,0x2745937f],w=0;w<n;w+=16)l=[e[w+4]|e[w+5]<<8|e[w+6]<<16|e[w+7]<<24,e[w]|e[w+1]<<8|e[w+2]<<16|e[w+3]<<24],g=[e[w+12]|e[w+13]<<8|e[w+14]<<16|e[w+15]<<24,e[w+8]|e[w+9]<<8|e[w+10]<<16|e[w+11]<<24],l=c(l=h(l,y),31),o=u(o=c(o=f(o,l=h(l,m)),27),a),o=u(h(o,[0,5]),[0,0x52dce729]),g=c(g=h(g,m),33),a=u(a=c(a=f(a,g=h(g,y)),31),o),a=u(h(a,[0,5]),[0,0x38495ab5]);switch(l=[0,0],g=[0,0],r){case 15:g=f(g,d([0,e[w+14]],48));case 14:g=f(g,d([0,e[w+13]],40));case 13:g=f(g,d([0,e[w+12]],32));case 12:g=f(g,d([0,e[w+11]],24));case 11:g=f(g,d([0,e[w+10]],16));case 10:g=f(g,d([0,e[w+9]],8));case 9:g=c(g=h(g=f(g,[0,e[w+8]]),m),33),a=f(a,g=h(g,y));case 8:l=f(l,d([0,e[w+7]],56));case 7:l=f(l,d([0,e[w+6]],48));case 6:l=f(l,d([0,e[w+5]],40));case 5:l=f(l,d([0,e[w+4]],32));case 4:l=f(l,d([0,e[w+3]],24));case 3:l=f(l,d([0,e[w+2]],16));case 2:l=f(l,d([0,e[w+1]],8));case 1:l=c(l=h(l=f(l,[0,e[w]]),y),31),o=f(o,l=h(l,m))}return o=u(o=f(o,[0,e.length]),a=f(a,[0,e.length])),a=u(a,o),o=u(o=p(o),a=p(a)),a=u(a,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)}},e.exports&&(t=e.exports=i),t.murmurHash3=i}(0)},55507:function(e,t){(function(){var e,r,n,i,s,o,a,l;l=function(e){return[(-0x1000000&e)>>>24,(0xff0000&e)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,i,s,o,a;for(t=[],i=s=0;s<=3&&0!==e.length;i=++s){if(i>0){if("."!==e[0])throw Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw Error("Invalid IP");switch(t.length){case 1:if(t[0]>0xffffffff)throw Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>0xffffff)throw Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw Error("Invalid IP")}},i=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),s=n("A"),r=function(e){var t,r,a,l,u;for(l=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),u=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)l=l*t+(n(e[a])-i)>>>0;else if(16===t){if("a"<=e[a]&&e[a]<="f")l=l*t+(10+n(e[a])-o)>>>0;else if("A"<=e[a]&&e[a]<="F")l=l*t+(10+n(e[a])-s)>>>0;else break}else break;if(l>0xffffffff)throw Error("too large");a++}if(a===u)throw Error("empty octet");return[l,a]},e=function(){function e(e,t){var r,n,i;if("string"!=typeof e)throw Error("Missing `net' parameter");if(t||(e=(i=e.split("/",2))[0],t=i[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===0xffffffff<<32-r>>>0){this.bitmask=r;break}}else if(t||0===t)this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=0xffffffff<<32-this.bitmask>>>0);else throw Error("Invalid mask: empty");try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=l(this.netLong),this.mask=l(this.maskLong),this.hostmask=l(~this.maskLong),this.first=this.bitmask<=30?l(this.netLong+1):this.base,this.last=this.bitmask<=30?l(this.netLong+this.size-2):l(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?l(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return("string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e)?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(l(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(l(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=l,t.Netmask=e}).call(this)},13368:(e,t,r)=>{e.exports=r(86085)},50152:(e,t,r)=>{"use strict";var n=r(48287).Buffer;class i{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let r=i.toUint8Array(e),n=i.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(let e of t)r+=e.byteLength;let n=new Uint8Array(r),i=0;for(let e of t){let t=this.toUint8Array(e);n.set(t,i),i+=t.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}let s="string",o=/^[0-9a-f]+$/i,a=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,l=/^[a-zA-Z0-9-_]+$/;class u{static fromString(e){let t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){let t=i.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class h{static toString(e,t=!1){let r=i.toArrayBuffer(e),n=new DataView(r),s="";for(let e=0;e<r.byteLength;e+=2)s+=String.fromCharCode(n.getUint16(e,t));return s}static fromString(e,t=!1){let r=new ArrayBuffer(2*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),t);return r}}class c{static isHex(e){return typeof e===s&&o.test(e)}static isBase64(e){return typeof e===s&&a.test(e)}static isBase64Url(e){return typeof e===s&&l.test(e)}static ToString(e,t="utf8"){let r=i.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return h.toString(r,!0);case"utf16":case"utf16be":return h.toString(r);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return h.fromString(e,!0);case"utf16":case"utf16be":return h.fromString(e);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=i.toUint8Array(e);return"undefined"!=typeof btoa?btoa(this.ToString(t,"binary")):n.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64(t))throw TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(n.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64Url(t))throw TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=c.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return u.fromString(e);case"utf16":case"utf16be":return h.fromString(e);case"utf16le":case"usc2":return h.fromString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=c.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return u.toString(e);case"utf16":case"utf16be":return h.toString(e);case"utf16le":case"usc2":return h.toString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){let t=i.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){let t=i.toUint8Array(e),r="",n=t.length;for(let e=0;e<n;e++){let n=t[e];n<16&&(r+="0"),r+=n.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isHex(t))throw TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){let n=t.slice(e,e+2);r[e/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return h.toString(e,t)}static FromUtf16String(e,t=!1){return h.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}c.DEFAULT_UTF8_ENCODING="utf8",t._H=i,t.U$=c},87583:(e,t,r)=>{let n=r(91333),i=r(90157),s=r(47899),o=r(56756);function a(e,t,r,s,o){let a=[].slice.call(arguments,1),l=a.length,u="function"==typeof a[l-1];if(!u&&!n())throw Error("Callback required as last argument");if(u){if(l<2)throw Error("Too few arguments provided");2===l?(o=r,r=t,t=s=void 0):3===l&&(t.getContext&&void 0===o?(o=s,s=void 0):(o=s,s=r,r=t,t=void 0))}else{if(l<1)throw Error("Too few arguments provided");return 1===l?(r=t,t=s=void 0):2!==l||t.getContext||(s=r,r=t,t=void 0),new Promise(function(n,o){try{let o=i.create(r,s);n(e(o,t,s))}catch(e){o(e)}})}try{let n=i.create(r,s);o(null,e(n,t,s))}catch(e){o(e)}}t.create=i.create,t.toCanvas=a.bind(null,s.render),t.toDataURL=a.bind(null,s.renderToDataURL),t.toString=a.bind(null,function(e,t,r){return o.render(e,r)})},91333:e=>{e.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},6421:(e,t,r)=>{let n=r(56886).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];let t=Math.floor(e/7)+2,r=n(e),i=145===r?26:2*Math.ceil((r-13)/(2*t-2)),s=[r-7];for(let e=1;e<t-1;e++)s[e]=s[e-1]-i;return s.push(6),s.reverse()},t.getPositions=function(e){let r=[],n=t.getRowColCoords(e),i=n.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)(0!==e||0!==t)&&(0!==e||t!==i-1)&&(e!==i-1||0!==t)&&r.push([n[e],n[t]]);return r}},11433:(e,t,r)=>{let n=r(7827),i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(e){this.mode=n.ALPHANUMERIC,this.data=e}s.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let r=45*i.indexOf(this.data[t]);r+=i.indexOf(this.data[t+1]),e.put(r,11)}this.data.length%2&&e.put(i.indexOf(this.data[t]),6)},e.exports=s},99899:e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){let t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(let r=0;r<t;r++)this.putBit((e>>>t-r-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},8820:e=>{function t(e){if(!e||e<1)throw Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,r,n){let i=e*this.size+t;this.data[i]=r,n&&(this.reservedBit[i]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},25822:(e,t,r)=>{let n=r(69049),i=r(7827);function s(e){this.mode=i.BYTE,"string"==typeof e&&(e=n(e)),this.data=new Uint8Array(e)}s.getBitsLength=function(e){return 8*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){for(let t=0,r=this.data.length;t<r;t++)e.put(this.data[t],8)},e.exports=s},97518:(e,t,r)=>{let n=r(49953),i=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case n.L:return i[(e-1)*4+0];case n.M:return i[(e-1)*4+1];case n.Q:return i[(e-1)*4+2];case n.H:return i[(e-1)*4+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case n.L:return s[(e-1)*4+0];case n.M:return s[(e-1)*4+1];case n.Q:return s[(e-1)*4+2];case n.H:return s[(e-1)*4+3];default:return}}},49953:(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw Error("Unknown EC Level: "+e)}}(e)}catch(e){return r}}},7756:(e,t,r)=>{let n=r(56886).getSymbolSize;t.getPositions=function(e){let t=n(e);return[[0,0],[t-7,0],[0,t-7]]}},84565:(e,t,r)=>{let n=r(56886),i=n.getBCHDigit(1335);t.getEncodedBits=function(e,t){let r=e.bit<<3|t,s=r<<10;for(;n.getBCHDigit(s)-i>=0;)s^=1335<<n.getBCHDigit(s)-i;return(r<<10|s)^21522}},2731:(e,t)=>{let r=new Uint8Array(512),n=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)r[t]=e,n[e]=t,256&(e<<=1)&&(e^=285);for(let e=255;e<512;e++)r[e]=r[e-255]}(),t.log=function(e){if(e<1)throw Error("log("+e+")");return n[e]},t.exp=function(e){return r[e]},t.mul=function(e,t){return 0===e||0===t?0:r[n[e]+n[t]]}},24861:(e,t,r)=>{let n=r(7827),i=r(56886);function s(e){this.mode=n.KANJI,this.data=e}s.getBitsLength=function(e){return 13*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let r=i.toSJIS(this.data[t]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");r=(r>>>8&255)*192+(255&r),e.put(r,13)}},e.exports=s},81332:(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};let r={N1:3,N2:3,N3:40,N4:10};t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){let t=e.size,n=0,i=0,s=0,o=null,a=null;for(let l=0;l<t;l++){i=s=0,o=a=null;for(let u=0;u<t;u++){let t=e.get(l,u);t===o?i++:(i>=5&&(n+=r.N1+(i-5)),o=t,i=1),(t=e.get(u,l))===a?s++:(s>=5&&(n+=r.N1+(s-5)),a=t,s=1)}i>=5&&(n+=r.N1+(i-5)),s>=5&&(n+=r.N1+(s-5))}return n},t.getPenaltyN2=function(e){let t=e.size,n=0;for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){let t=e.get(r,i)+e.get(r,i+1)+e.get(r+1,i)+e.get(r+1,i+1);(4===t||0===t)&&n++}return n*r.N2},t.getPenaltyN3=function(e){let t=e.size,n=0,i=0,s=0;for(let r=0;r<t;r++){i=s=0;for(let o=0;o<t;o++)i=i<<1&2047|e.get(r,o),o>=10&&(1488===i||93===i)&&n++,s=s<<1&2047|e.get(o,r),o>=10&&(1488===s||93===s)&&n++}return n*r.N3},t.getPenaltyN4=function(e){let t=0,n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return Math.abs(Math.ceil(100*t/n/5)-10)*r.N4},t.applyMask=function(e,r){let n=r.size;for(let i=0;i<n;i++)for(let s=0;s<n;s++)r.isReserved(s,i)||r.xor(s,i,function(e,r,n){switch(e){case t.Patterns.PATTERN000:return(r+n)%2==0;case t.Patterns.PATTERN001:return r%2==0;case t.Patterns.PATTERN010:return n%3==0;case t.Patterns.PATTERN011:return(r+n)%3==0;case t.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2==0;case t.Patterns.PATTERN101:return r*n%2+r*n%3==0;case t.Patterns.PATTERN110:return(r*n%2+r*n%3)%2==0;case t.Patterns.PATTERN111:return(r*n%3+(r+n)%2)%2==0;default:throw Error("bad maskPattern:"+e)}}(e,s,i))},t.getBestMask=function(e,r){let n=Object.keys(t.Patterns).length,i=0,s=1/0;for(let o=0;o<n;o++){r(o),t.applyMask(o,e);let n=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(o,e),n<s&&(s=n,i=o)}return i}},7827:(e,t,r)=>{let n=r(21878),i=r(67044);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw Error("Invalid mode: "+e);if(!n.isValid(t))throw Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return i.testNumeric(e)?t.NUMERIC:i.testAlphanumeric(e)?t.ALPHANUMERIC:i.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw Error("Unknown mode: "+e)}}(e)}catch(e){return r}}},46738:(e,t,r)=>{let n=r(7827);function i(e){this.mode=n.NUMERIC,this.data=e.toString()}i.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t,r;for(t=0;t+3<=this.data.length;t+=3)r=parseInt(this.data.substr(t,3),10),e.put(r,10);let n=this.data.length-t;n>0&&(r=parseInt(this.data.substr(t),10),e.put(r,3*n+1))},e.exports=i},64713:(e,t,r)=>{let n=r(2731);t.mul=function(e,t){let r=new Uint8Array(e.length+t.length-1);for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)r[i+s]^=n.mul(e[i],t[s]);return r},t.mod=function(e,t){let r=new Uint8Array(e);for(;r.length-t.length>=0;){let e=r[0];for(let i=0;i<t.length;i++)r[i]^=n.mul(t[i],e);let i=0;for(;i<r.length&&0===r[i];)i++;r=r.slice(i)}return r},t.generateECPolynomial=function(e){let r=new Uint8Array([1]);for(let i=0;i<e;i++)r=t.mul(r,new Uint8Array([1,n.exp(i)]));return r}},90157:(e,t,r)=>{let n=r(56886),i=r(49953),s=r(99899),o=r(8820),a=r(6421),l=r(7756),u=r(81332),h=r(97518),c=r(74764),d=r(31427),f=r(84565),p=r(7827),g=r(29801);function y(e,t,r){let n,i;let s=e.size,o=f.getEncodedBits(t,r);for(n=0;n<15;n++)i=(o>>n&1)==1,n<6?e.set(n,8,i,!0):n<8?e.set(n+1,8,i,!0):e.set(s-15+n,8,i,!0),n<8?e.set(8,s-n-1,i,!0):n<9?e.set(8,15-n-1+1,i,!0):e.set(8,15-n-1,i,!0);e.set(s-8,8,1,!0)}t.create=function(e,t){let r,f;if(void 0===e||""===e)throw Error("No input text");let m=i.M;return void 0!==t&&(m=i.from(t.errorCorrectionLevel,i.M),r=d.from(t.version),f=u.from(t.maskPattern),t.toSJISFunc&&n.setToSJISFunction(t.toSJISFunc)),function(e,t,r,i){let f;if(Array.isArray(e))f=g.fromArray(e);else if("string"==typeof e){let n=t;if(!n){let t=g.rawSplit(e);n=d.getBestVersionForData(t,r)}f=g.fromString(e,n||40)}else throw Error("Invalid data");let m=d.getBestVersionForData(f,r);if(!m)throw Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<m)throw Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+m+".\n")}else t=m;let w=function(e,t,r){let i=new s;r.forEach(function(t){i.put(t.mode.bit,4),i.put(t.getLength(),p.getCharCountIndicator(t.mode,e)),t.write(i)});let o=(n.getSymbolTotalCodewords(e)-h.getTotalCodewordsCount(e,t))*8;for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(0);let a=(o-i.getLengthInBits())/8;for(let e=0;e<a;e++)i.put(e%2?17:236,8);return function(e,t,r){let i,s;let o=n.getSymbolTotalCodewords(t),a=o-h.getTotalCodewordsCount(t,r),l=h.getBlocksCount(t,r),u=o%l,d=l-u,f=Math.floor(o/l),p=Math.floor(a/l),g=p+1,y=f-p,m=new c(y),w=0,b=Array(l),v=Array(l),E=0,S=new Uint8Array(e.buffer);for(let e=0;e<l;e++){let t=e<d?p:g;b[e]=S.slice(w,w+t),v[e]=m.encode(b[e]),w+=t,E=Math.max(E,t)}let k=new Uint8Array(o),A=0;for(i=0;i<E;i++)for(s=0;s<l;s++)i<b[s].length&&(k[A++]=b[s][i]);for(i=0;i<y;i++)for(s=0;s<l;s++)k[A++]=v[s][i];return k}(i,e,t)}(t,r,f),b=new o(n.getSymbolSize(t));return function(e,t){let r=e.size,n=l.getPositions(t);for(let t=0;t<n.length;t++){let i=n[t][0],s=n[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1)&&!(r<=i+t))for(let n=-1;n<=7;n++)s+n<=-1||r<=s+n||(t>=0&&t<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===t||6===t)||t>=2&&t<=4&&n>=2&&n<=4?e.set(i+t,s+n,!0,!0):e.set(i+t,s+n,!1,!0))}}(b,t),function(e){let t=e.size;for(let r=8;r<t-8;r++){let t=r%2==0;e.set(r,6,t,!0),e.set(6,r,t,!0)}}(b),function(e,t){let r=a.getPositions(t);for(let t=0;t<r.length;t++){let n=r[t][0],i=r[t][1];for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)-2===t||2===t||-2===r||2===r||0===t&&0===r?e.set(n+t,i+r,!0,!0):e.set(n+t,i+r,!1,!0)}}(b,t),y(b,r,0),t>=7&&function(e,t){let r,n,i;let s=e.size,o=d.getEncodedBits(t);for(let t=0;t<18;t++)r=Math.floor(t/3),n=t%3+s-8-3,i=(o>>t&1)==1,e.set(r,n,i,!0),e.set(n,r,i,!0)}(b,t),function(e,t){let r=e.size,n=-1,i=r-1,s=7,o=0;for(let a=r-1;a>0;a-=2)for(6===a&&a--;;){for(let r=0;r<2;r++)if(!e.isReserved(i,a-r)){let n=!1;o<t.length&&(n=(t[o]>>>s&1)==1),e.set(i,a-r,n),-1==--s&&(o++,s=7)}if((i+=n)<0||r<=i){i-=n,n=-n;break}}}(b,w),isNaN(i)&&(i=u.getBestMask(b,y.bind(null,b,r))),u.applyMask(i,b),y(b,r,i),{modules:b,version:t,errorCorrectionLevel:r,maskPattern:i,segments:f}}(e,r,m,f)}},74764:(e,t,r)=>{let n=r(64713);function i(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(e){this.degree=e,this.genPoly=n.generateECPolynomial(this.degree)},i.prototype.encode=function(e){if(!this.genPoly)throw Error("Encoder not initialized");let t=new Uint8Array(e.length+this.degree);t.set(e);let r=n.mod(t,this.genPoly),i=this.degree-r.length;if(i>0){let e=new Uint8Array(this.degree);return e.set(r,i),e}return r},e.exports=i},67044:(e,t)=>{let r="[0-9]+",n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+",i="(?:(?![A-Z0-9 $%*+\\-./:]|"+(n=n.replace(/u/g,"\\u"))+")(?:.|[\r\n]))+";t.KANJI=RegExp(n,"g"),t.BYTE_KANJI=RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=RegExp(i,"g"),t.NUMERIC=RegExp(r,"g"),t.ALPHANUMERIC=RegExp("[A-Z $%*+\\-./:]+","g");let s=RegExp("^"+n+"$"),o=RegExp("^"+r+"$"),a=RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return s.test(e)},t.testNumeric=function(e){return o.test(e)},t.testAlphanumeric=function(e){return a.test(e)}},29801:(e,t,r)=>{let n=r(7827),i=r(46738),s=r(11433),o=r(25822),a=r(24861),l=r(67044),u=r(56886),h=r(76320);function c(e){return unescape(encodeURIComponent(e)).length}function d(e,t,r){let n;let i=[];for(;null!==(n=e.exec(r));)i.push({data:n[0],index:n.index,mode:t,length:n[0].length});return i}function f(e){let t,r;let i=d(l.NUMERIC,n.NUMERIC,e),s=d(l.ALPHANUMERIC,n.ALPHANUMERIC,e);return u.isKanjiModeEnabled()?(t=d(l.BYTE,n.BYTE,e),r=d(l.KANJI,n.KANJI,e)):(t=d(l.BYTE_KANJI,n.BYTE,e),r=[]),i.concat(s,t,r).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function p(e,t){switch(t){case n.NUMERIC:return i.getBitsLength(e);case n.ALPHANUMERIC:return s.getBitsLength(e);case n.KANJI:return a.getBitsLength(e);case n.BYTE:return o.getBitsLength(e)}}function g(e,t){let r;let l=n.getBestModeForData(e);if((r=n.from(t,l))!==n.BYTE&&r.bit<l.bit)throw Error('"'+e+'" cannot be encoded with mode '+n.toString(r)+".\n Suggested mode is: "+n.toString(l));switch(r!==n.KANJI||u.isKanjiModeEnabled()||(r=n.BYTE),r){case n.NUMERIC:return new i(e);case n.ALPHANUMERIC:return new s(e);case n.KANJI:return new a(e);case n.BYTE:return new o(e)}}t.fromArray=function(e){return e.reduce(function(e,t){return"string"==typeof t?e.push(g(t,null)):t.data&&e.push(g(t.data,t.mode)),e},[])},t.fromString=function(e,r){let i=function(e,t){let r={},i={start:{}},s=["start"];for(let o=0;o<e.length;o++){let a=e[o],l=[];for(let e=0;e<a.length;e++){let u=a[e],h=""+o+e;l.push(h),r[h]={node:u,lastCount:0},i[h]={};for(let e=0;e<s.length;e++){let o=s[e];r[o]&&r[o].node.mode===u.mode?(i[o][h]=p(r[o].lastCount+u.length,u.mode)-p(r[o].lastCount,u.mode),r[o].lastCount+=u.length):(r[o]&&(r[o].lastCount=u.length),i[o][h]=p(u.length,u.mode)+4+n.getCharCountIndicator(u.mode,t))}}s=l}for(let e=0;e<s.length;e++)i[s[e]].end=0;return{map:i,table:r}}(function(e){let t=[];for(let r=0;r<e.length;r++){let i=e[r];switch(i.mode){case n.NUMERIC:t.push([i,{data:i.data,mode:n.ALPHANUMERIC,length:i.length},{data:i.data,mode:n.BYTE,length:i.length}]);break;case n.ALPHANUMERIC:t.push([i,{data:i.data,mode:n.BYTE,length:i.length}]);break;case n.KANJI:t.push([i,{data:i.data,mode:n.BYTE,length:c(i.data)}]);break;case n.BYTE:t.push([{data:i.data,mode:n.BYTE,length:c(i.data)}])}}return t}(f(e,u.isKanjiModeEnabled())),r),s=h.find_path(i.map,"start","end"),o=[];for(let e=1;e<s.length-1;e++)o.push(i.table[s[e]].node);return t.fromArray(o.reduce(function(e,t){let r=e.length-1>=0?e[e.length-1]:null;return r&&r.mode===t.mode?e[e.length-1].data+=t.data:e.push(t),e},[]))},t.rawSplit=function(e){return t.fromArray(f(e,u.isKanjiModeEnabled()))}},56886:(e,t)=>{let r;let n=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw Error('"version" cannot be null or undefined');if(e<1||e>40)throw Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return n[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!=typeof e)throw Error('"toSJISFunc" is not a valid function.');r=e},t.isKanjiModeEnabled=function(){return void 0!==r},t.toSJIS=function(e){return r(e)}},21878:(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},31427:(e,t,r)=>{let n=r(56886),i=r(97518),s=r(49953),o=r(7827),a=r(21878),l=n.getBCHDigit(7973);function u(e,t){return o.getCharCountIndicator(e,t)+4}t.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,r){if(!a.isValid(e))throw Error("Invalid QR Code version");void 0===r&&(r=o.BYTE);let s=(n.getSymbolTotalCodewords(e)-i.getTotalCodewordsCount(e,t))*8;if(r===o.MIXED)return s;let l=s-u(r,e);switch(r){case o.NUMERIC:return Math.floor(l/10*3);case o.ALPHANUMERIC:return Math.floor(l/11*2);case o.KANJI:return Math.floor(l/13);case o.BYTE:default:return Math.floor(l/8)}},t.getBestVersionForData=function(e,r){let n;let i=s.from(r,s.M);if(Array.isArray(e)){if(e.length>1)return function(e,r){for(let n=1;n<=40;n++)if(function(e,t){let r=0;return e.forEach(function(e){let n=u(e.mode,t);r+=n+e.getBitsLength()}),r}(e,n)<=t.getCapacity(n,r,o.MIXED))return n}(e,i);if(0===e.length)return 1;n=e[0]}else n=e;return function(e,r,n){for(let i=1;i<=40;i++)if(r<=t.getCapacity(i,n,e))return i}(n.mode,n.getLength(),i)},t.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw Error("Invalid QR Code version");let t=e<<12;for(;n.getBCHDigit(t)-l>=0;)t^=7973<<n.getBCHDigit(t)-l;return e<<12|t}},47899:(e,t,r)=>{let n=r(92726);t.render=function(e,t,r){var i;let s=r,o=t;void 0!==s||t&&t.getContext||(s=t,t=void 0),t||(o=function(){try{return document.createElement("canvas")}catch(e){throw Error("You need to specify a canvas element")}}()),s=n.getOptions(s);let a=n.getImageWidth(e.modules.size,s),l=o.getContext("2d"),u=l.createImageData(a,a);return n.qrToImageData(u.data,e,s),i=o,l.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px",l.putImageData(u,0,0),o},t.renderToDataURL=function(e,r,n){let i=n;void 0!==i||r&&r.getContext||(i=r,r=void 0),i||(i={});let s=t.render(e,r,i),o=i.type||"image/png",a=i.rendererOpts||{};return s.toDataURL(o,a.quality)}},56756:(e,t,r)=>{let n=r(92726);function i(e,t){let r=e.a/255,n=t+'="'+e.hex+'"';return r<1?n+" "+t+'-opacity="'+r.toFixed(2).slice(1)+'"':n}function s(e,t,r){let n=e+t;return void 0!==r&&(n+=" "+r),n}t.render=function(e,t,r){let o=n.getOptions(t),a=e.modules.size,l=e.modules.data,u=a+2*o.margin,h=o.color.light.a?"<path "+i(o.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",c="<path "+i(o.color.dark,"stroke")+' d="'+function(e,t,r){let n="",i=0,o=!1,a=0;for(let l=0;l<e.length;l++){let u=Math.floor(l%t),h=Math.floor(l/t);u||o||(o=!0),e[l]?(a++,l>0&&u>0&&e[l-1]||(n+=o?s("M",u+r,.5+h+r):s("m",i,0),i=0,o=!1),u+1<t&&e[l+1]||(n+=s("h",a),a=0)):i++}return n}(l,a,o.margin)+'"/>',d='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+('viewBox="0 0 '+u)+" "+u+'" shape-rendering="crispEdges">'+h+c+"</svg>\n";return"function"==typeof r&&r(null,d),d}},92726:(e,t)=>{function r(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw Error("Invalid hex color: "+e);(3===t.length||4===t.length)&&(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");let r=parseInt(t.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:255&r,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});let t=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,n=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:n,scale:n?4:i,margin:t,color:{dark:r(e.color.dark||"#000000ff"),light:r(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,r){let n=t.getScale(e,r);return Math.floor((e+2*r.margin)*n)},t.qrToImageData=function(e,r,n){let i=r.modules.size,s=r.modules.data,o=t.getScale(i,n),a=Math.floor((i+2*n.margin)*o),l=n.margin*o,u=[n.color.light,n.color.dark];for(let t=0;t<a;t++)for(let r=0;r<a;r++){let h=(t*a+r)*4,c=n.color.light;t>=l&&r>=l&&t<a-l&&r<a-l&&(c=u[s[Math.floor((t-l)/o)*i+Math.floor((r-l)/o)]?1:0]),e[h++]=c.r,e[h++]=c.g,e[h++]=c.b,e[h]=c.a}}},52669:e=>{"use strict";function t(e,t){return e+r(t)}function r(e){let t=e;return t-=t>>1&0x55555555,((t=(0x33333333&t)+(t>>2&0x33333333))+(t>>4)&0xf0f0f0f)*0x1010101>>24}function n(e,t){return e[0]-t[0]}function i(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t=0,r,n;for(;t<this.length&&!r;)r=e(n=this.get(t)),t++;return r?n:void 0}_internalPositionFor(e,n){let i=this._bytePosFor(e,n);if(i>=this._bitArrays.length)return -1;let s=this._bitArrays[i],o=e-7*i;return(s&1<<o)>0?this._bitArrays.slice(0,i).reduce(t,0)+r(s&~(0xffffffff<<o+1))-1:-1}_bytePosFor(e,t){let r=Math.floor(e/7),n=r+1;for(;!t&&this._bitArrays.length<n;)this._bitArrays.push(0);return r}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,r,n){let i=this._data,s=[t,r];if(n)this._sortData(),i[e]=s;else{if(i.length){if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let e=Math.round(i.length/2);this._data=i.slice(0,e).concat(s).concat(i.slice(e))}}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(n),this._changedData=!1}bitField(){let e;let t=[],r=8,n=0,i=0,s=this._bitArrays.slice();for(;s.length||n;){0===n&&(e=s.shift(),n=7);let o=Math.min(n,r);i|=(e&~(255<<o))<<8-r,e>>>=o,n-=o,(r-=o)&&(n||s.length)||(t.push(i),i=0,r=8)}for(var o=t.length-1;o>0;o--)if(0===t[o])t.pop();else break;return t}compactArray(){return this._sortData(),this._data.map(i)}}},26797:e=>{e.exports=function e(t,r){var n,i=0,r=r||0,s=0,o=r,a=t.length;do{if(o>=a||s>49)throw e.bytes=0,RangeError("Could not decode varint");n=t[o++],i+=s<28?(127&n)<<s:(127&n)*Math.pow(2,s),s+=7}while(n>=128);return e.bytes=o-r,i}},81877:e=>{e.exports=function e(r,n,i){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw e.bytes=0,RangeError("Could not encode varint");n=n||[];for(var s=i=i||0;r>=0x80000000;)n[i++]=255&r|128,r/=128;for(;r&t;)n[i++]=255&r|128,r>>>=7;return n[i]=0|r,e.bytes=i-s+1,n};var t=-128},61203:(e,t,r)=>{e.exports={encode:r(81877),decode:r(26797),encodingLength:r(37867)}},37867:e=>{e.exports=function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10}},5454:e=>{!function(){e.exports=l;var t="000000000",r=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},n=l.prototype,i=(l.fromDate=function(e){return new l(+e)},l.fromInt64BE=f(0,1,2,3,0,4),l.fromInt64LE=f(3,2,1,0,4,0),l.fromString=function(e){var r,n=new l,e=(e+="").replace(/^\s*[+\-]?\d+/,function(e){var e=+e,t=1970+(e-1970)%400;return n.year=e-t,t}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(e,t,n){return t<0&&(n*=-1),r=6e4*(60*+t+ +n),""}).replace(/\.\d+$/,function(e){return n.nano=+(e+t).substr(1,9),""}).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,n.time=r=Date.UTC.apply(Date,e)-(r||0),isNaN(r))throw TypeError("Invalid Date");return u(n)},l.fromTimeT=function(e){return c(e,0)},n.year=0,n.time=0,n.nano=0,n.addNano=function(e){return this.nano+=+e||0,this},n.getNano=function(){var e=u(this);return(e.time%1e3*1e6+ +e.nano+1e9)%1e9},n.getTimeT=function(){var e=u(this),t=Math.floor(e.time/1e3),e=e.year;return e&&(t+=0x178302cc00*e/3200),t},n.getYear=function(){return this.toDate().getUTCFullYear()+this.year},n.toDate=function(){return h(u(this).time)},n.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},n.toString=function(e){var t=this,r=t.toDate(),n={H:function(){return g(r.getUTCHours())},L:function(){return y(r.getUTCMilliseconds(),3)},M:function(){return g(r.getUTCMinutes())},N:function(){return y(t.getNano(),9)},S:function(){return g(r.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+y(e,6):0<=e?y(e,4):-999999<=e?"-"+y(-e,6):e},a:function(){return o[r.getUTCDay()]},b:function(){return s[r.getUTCMonth()]},d:function(){return g(r.getUTCDate())},e:function(){var e;return(9<(e=r.getUTCDate())?"":" ")+(0|e)},m:function(){return g(r.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,function(t){var r=t[1],i=a[r],r=n[r];return i?e(i):r?r():t})}(e||i)},n.writeInt64BE=d(0,1,2,3,0,4),n.writeInt64LE=d(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};function l(e,t,r){if(!(this instanceof l))return new l(e,t,r);this.time=+e||0,this.nano=+t||0,this.year=+r||0,u(this)}function u(e){var t,n,i,s=e.year,o=e.time,a=e.nano,l=((a<0||1e6<=a)&&(a-=1e6*(n=Math.floor(a/1e6)),o+=n,n=1),s%3200);return(o<-864e13||864e13<o||l)&&((t=r(o/1009822464e5))&&(s+=3200*t,o-=1009822464e5*t),(i=h(o)).setUTCFullYear(l+i.getUTCFullYear()),i=(o=+i)+1009822464e5*(t=r((s-=l)/3200)),t&&-864e13<=i&&i<=864e13&&(s-=3200*t,o=i),n=1),n&&(e.year=s,e.time=o,e.nano=a),e}function h(e){var t=new Date(0);return t.setTime(e),t}function c(e,t){e=+e||0;var n=r((t=(0|t)*0x100000000)/0x178302cc00)+r(e/0x178302cc00),t=t%0x178302cc00+e%0x178302cc00,e=r(t/0x178302cc00);return e&&(n+=e,t-=0x178302cc00*e),new l(1e3*t,0,3200*n)}function d(e,t,n,i,s,o){return function(e,t){var n=u(this);p(e=e||Array(8),t|=0);var i=Math.floor(n.time/1e3),n=0x1e18558*n.year,l=r(n/0x100000000)+r(i/0x100000000),n=n%0x100000000+i%0x100000000,i=Math.floor(n/0x100000000);return i&&(l+=i,n-=0x100000000*i),a(e,t+s,l),a(e,t+o,n),e};function a(r,s,o){r[s+e]=o>>24&255,r[s+t]=o>>16&255,r[s+n]=o>>8&255,r[s+i]=255&o}}function f(e,t,r,n,i,s){return function(e,t){p(e,t|=0);var r=o(e,t+i);return c(o(e,t+s),r)};function o(i,s){return 0x1000000*i[s+e]+(i[s+t]<<16|i[s+r]<<8|i[s+n])}}function p(e,t){if(null==(e=e&&e.length))throw TypeError("Invalid Buffer");if(e<t+8)throw RangeError("Out of range")}function g(e){return(9<e?"":"0")+(0|e)}function y(e,r){return(t+(0|e)).substr(-r)}}()},25687:(e,t,r)=>{"use strict";r.d(t,{J:()=>l});var n=r(43831),i=r(15284),s=r(65269),o=r(29857),a=r(74848),l=(0,i.R)(function(e,t){let{getButtonProps:r}=(0,n.AV)(),i=r(e,t),l={display:"flex",alignItems:"center",width:"100%",outline:0,...(0,n.EF)().button};return(0,a.jsx)(s.B.button,{...i,className:(0,o.cx)("chakra-accordion__button",e.className),__css:l})});l.displayName="AccordionButton"},93633:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(34029),i=r(43831),s=r(15284),o=r(65269),a=r(29857),l=r(96540),u=r(74848),h=(0,s.R)(function(e,t){let{children:r,className:s}=e,{htmlProps:h,...c}=(0,n.r9)(e),d={...(0,i.EF)().container,overflowAnchor:"none"},f=(0,l.useMemo)(()=>c,[c]);return(0,u.jsx)(i.TG,{value:f,children:(0,u.jsx)(o.B.div,{ref:t,...h,className:(0,a.cx)("chakra-accordion__item",s),__css:d,children:"function"==typeof r?r({isExpanded:!!c.isOpen,isDisabled:!!c.isDisabled}):r})})});h.displayName="AccordionItem"},99424:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var n=r(34029),i=r(43831),s=r(93809),o=r(29857),a=r(74848);function l(e){let{isOpen:t,isDisabled:r}=(0,i.AV)(),{reduceMotion:l}=(0,n.Dr)(),u=(0,o.cx)("chakra-accordion__icon",e.className),h={opacity:r?.4:1,transform:t?"rotate(-180deg)":void 0,transition:l?void 0:"transform 0.2s",transformOrigin:"center",...(0,i.EF)().icon};return(0,a.jsx)(s.I,{viewBox:"0 0 24 24","aria-hidden":!0,className:u,__css:h,...e,children:(0,a.jsx)("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})})}l.displayName="AccordionIcon"},36928:(e,t,r)=>{"use strict";r.d(t,{v:()=>m});var n=r(34029),i=r(43831),s=r(15284),o=r(65269),a=r(70479),l=r(29857),u=r(10905),h=r(73867),c=r(96540),d=r(74848),f=e=>null!=e&&parseInt(e.toString(),10)>0,p={exit:{height:{duration:.2,ease:a.xf.ease},opacity:{duration:.3,ease:a.xf.ease}},enter:{height:{duration:.3,ease:a.xf.ease},opacity:{duration:.4,ease:a.xf.ease}}},g={exit:({animateOpacity:e,startingHeight:t,transition:r,transitionEnd:n,delay:i})=>{var s;return{...e&&{opacity:f(t)?1:0},height:t,transitionEnd:null==n?void 0:n.exit,transition:null!=(s=null==r?void 0:r.exit)?s:a.yA.exit(p.exit,i)}},enter:({animateOpacity:e,endingHeight:t,transition:r,transitionEnd:n,delay:i})=>{var s;return{...e&&{opacity:1},height:t,transitionEnd:null==n?void 0:n.enter,transition:null!=(s=null==r?void 0:r.enter)?s:a.yA.enter(p.enter,i)}}},y=(0,c.forwardRef)((e,t)=>{let{in:r,unmountOnExit:n,animateOpacity:i=!0,startingHeight:s=0,endingHeight:o="auto",style:a,className:f,transition:p,transitionEnd:y,...m}=e,[w,b]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let e=setTimeout(()=>{b(!0)});return()=>clearTimeout(e)},[]),(0,l.R8)({condition:Number(s)>0&&!!n,message:"startingHeight and unmountOnExit are mutually exclusive. You can't use them together"});let v=parseFloat(s.toString())>0,E={startingHeight:s,endingHeight:o,animateOpacity:i,transition:w?p:{enter:{duration:0}},transitionEnd:{enter:null==y?void 0:y.enter,exit:n?null==y?void 0:y.exit:{...null==y?void 0:y.exit,display:v?"block":"none"}}},S=!n||r,k=r||n?"enter":"exit";return(0,d.jsx)(u.N,{initial:!1,custom:E,children:S&&(0,d.jsx)(h.P.div,{ref:t,...m,className:(0,l.cx)("chakra-collapse",f),style:{overflow:"hidden",display:"block",...a},custom:E,variants:g,initial:!!n&&"exit",animate:k,exit:"exit"})})});y.displayName="Collapse";var m=(0,s.R)(function(e,t){let{className:r,motionProps:s,...a}=e,{reduceMotion:u}=(0,n.Dr)(),{getPanelProps:h,isOpen:c}=(0,i.AV)(),f=h(a,t),p=(0,l.cx)("chakra-accordion__panel",r),g=(0,i.EF)();u||delete f.hidden;let m=(0,d.jsx)(o.B.div,{...f,__css:g.panel,className:p});return u?m:(0,d.jsx)(y,{in:c,...s,children:m})});m.displayName="AccordionPanel"},14085:(e,t,r)=>{"use strict";r.d(t,{g:()=>u});var n=r(15284),i=r(65269),s=r(11235),o=r(29857),a=r(96540),l=r(74848),u=(0,n.R)(function(e,t){let{ratio:r=4/3,children:n,className:u,...h}=e,c=a.Children.only(n),d=(0,o.cx)("chakra-aspect-ratio",u);return(0,l.jsx)(i.B.div,{ref:t,position:"relative",className:d,_before:{height:0,content:'""',display:"block",paddingBottom:(0,s.bk)(r,e=>`${1/e*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...h,children:c})});u.displayName="AspectRatio"},33757:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l,r:()=>a});var n=r(15284),i=r(65269),s=r(29857),o=r(74848),a=(0,n.R)(function(e,t){let{isExternal:r,target:n,rel:a,className:l,...u}=e;return(0,o.jsx)(i.B.a,{...u,ref:t,className:(0,s.cx)("chakra-linkbox__overlay",l),rel:r?"noopener noreferrer":a,target:r?"_blank":n,__css:{position:"static","&::before":{content:"''",cursor:"inherit",display:"block",position:"absolute",top:0,left:0,zIndex:0,width:"100%",height:"100%"}}})}),l=(0,n.R)(function(e,t){let{className:r,...n}=e;return(0,o.jsx)(i.B.div,{ref:t,position:"relative",...n,className:(0,s.cx)("chakra-linkbox",r),__css:{"a[href]:not(.chakra-linkbox__overlay), abbr[title]":{position:"relative",zIndex:1}}})})},95170:(e,t,r)=>{"use strict";r.d(t,{s:()=>c});var n=r(86945),i=r(12619),s=r(15284),o=r(54443),a=r(44515),l=r(65269),u=r(29857),h=r(74848),c=(0,s.R)((e,t)=>{var r;let s=(0,i.R)(),{onChange:c,value:d}=e,f=(0,o.o5)("Radio",{...s,...e}),{spacing:p="0.5rem",children:g,isDisabled:y=null==s?void 0:s.isDisabled,isFocusable:m=null==s?void 0:s.isFocusable,inputProps:w,...b}=(0,a.MN)(e),v=e.isChecked;(null==s?void 0:s.value)!=null&&null!=d&&(v=s.value===d);let E=c;(null==s?void 0:s.onChange)&&null!=d&&(E=(0,u.OK)(s.onChange,c));let S=null!=(r=null==e?void 0:e.name)?r:null==s?void 0:s.name,{getInputProps:k,getCheckboxProps:A,getLabelProps:x,getRootProps:I,htmlProps:B}=(0,n.z)({...b,isChecked:v,isFocusable:m,isDisabled:y,onChange:E,name:S}),[C,N]=function(e,t){let r={},n={};for(let[i,s]of Object.entries(e))t.includes(i)?r[i]=s:n[i]=s;return[r,n]}(B,a.GF),T=A(N),_=k(w,t),L=x(),R=Object.assign({},C,I()),O={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...f.container},P={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...f.control},U={userSelect:"none",marginStart:p,...f.label};return(0,h.jsxs)(l.B.label,{className:"chakra-radio",...R,__css:O,children:[(0,h.jsx)("input",{className:"chakra-radio__input",..._}),(0,h.jsx)(l.B.span,{className:"chakra-radio__control",...T,__css:P}),g&&(0,h.jsx)(l.B.span,{className:"chakra-radio__label",...L,__css:U,children:g})]})});c.displayName="Radio"},72505:(e,t,r)=>{"use strict";let n,i;r.d(t,{D:()=>fx});var s,o,a,l,u,h,c,d,f,p,g,y={};r.r(y),r.d(y,{base10:()=>Z});var m={};r.r(m),r.d(m,{base16:()=>X,base16upper:()=>Q});var w={};r.r(w),r.d(w,{base2:()=>ee});var b={};r.r(b),r.d(b,{base256emoji:()=>ei});var v={};r.r(v),r.d(v,{base32:()=>es,base32hex:()=>eu,base32hexpad:()=>ec,base32hexpadupper:()=>ed,base32hexupper:()=>eh,base32pad:()=>ea,base32padupper:()=>el,base32upper:()=>eo,base32z:()=>ef});var E={};r.r(E),r.d(E,{base36:()=>ep,base36upper:()=>eg});var S={};r.r(S),r.d(S,{base58btc:()=>ey,base58flickr:()=>em});var k={};r.r(k),r.d(k,{base64:()=>ew,base64pad:()=>eb,base64url:()=>ev,base64urlpad:()=>eE});var A={};r.r(A),r.d(A,{base8:()=>eS});var x={};r.r(x),r.d(x,{identity:()=>ek});var I={};r.r(I),r.d(I,{code:()=>eB,decode:()=>eN,encode:()=>eC,name:()=>eI});var B={};r.r(B),r.d(B,{code:()=>e_,decode:()=>eR,encode:()=>eL,name:()=>eT});var C={};r.r(C),r.d(C,{identity:()=>ez});var N={};r.r(N),r.d(N,{sha256:()=>ej,sha512:()=>eG});var T={};r.r(T),r.d(T,{code:()=>up,decode:()=>uy,decodeOptions:()=>ud,encode:()=>ug,encodeOptions:()=>uh,name:()=>uf,toByteView:()=>ul});var _={};r.r(_),r.d(_,{code:()=>uB,decode:()=>uN,encode:()=>uC,format:()=>uT,name:()=>uI,parse:()=>uL,stringify:()=>uT});var L={};r.r(L),r.d(L,{code:()=>uQ,createLink:()=>uZ,createNode:()=>uJ,decode:()=>u1,encode:()=>u0,name:()=>uX,prepare:()=>uK,validate:()=>uY});class R extends Error{static name="InsufficientProvidersError";constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}class O extends Error{static name="NoRoutersAvailableError";constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}class P extends Error{static name="UnknownHashAlgorithmError";constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}class U extends Error{static name="UnknownCodecError";constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}let D=(e,...t)=>{};class F extends EventTarget{#e=new Map;constructor(){super(),D(1/0,this)}listenerCount(e){let t=this.#e.get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=this.#e.get(e);null==n&&(n=[],this.#e.set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=this.#e.get(e);null!=n&&(n=n.filter(({callback:e})=>e!==t),this.#e.set(e,n))}dispatchEvent(e){let t=super.dispatchEvent(e),r=this.#e.get(e.type);return null==r||(r=r.filter(({once:e})=>!e),this.#e.set(e.type,r)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}let $=new Uint8Array(0);function M(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):$}function z(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")}let H=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function c(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var n=0,i=0;e[t]===l;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var c=0,d=s-1;(0!==h||c<i)&&-1!==d;d--,c++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw Error("Non-zero carry");i=c,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),g=n;f!==s;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var c=t[i],d=0,f=o-1;(0!==c||d<n)&&-1!==f;f--,d++)c+=256*u[f]>>>0,u[f]=c%a>>>0,c=c/a>>>0;if(0!==c)throw Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var g=l.repeat(r);p<o;++p)g+=e.charAt(u[p]);return g},decodeUnsafe:c,decode:function(e){var r=c(e);if(r)return r;throw Error(`Non-${t} character`)}}};class V{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class q{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;let n=t.codePointAt(0);if(void 0===n)throw Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return G(this,e)}}class j{decoders;constructor(e){this.decoders=e}or(e){return G(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function G(e,t){return new j({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class W{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new V(e,t,r),this.decoder=new q(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function K({name:e,prefix:t,encode:r,decode:n}){return new W(e,t,r,n)}function Y({name:e,prefix:t,alphabet:r}){let{encode:n,decode:i}=H(r,e);return K({prefix:t,name:e,encode:n,decode:e=>z(i(e))})}function J({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return K({prefix:t,name:e,encode:e=>(function(e,t,r){let n="="===t[t.length-1],i=(1<<r)-1,s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(0!==o&&(s+=t[i&a<<r-o]),n)for(;(s.length*r&7)!=0;)s+="=";return s})(e,n,r),decode:t=>(function(e,t,r,n){let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,u=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw SyntaxError(`Non-${n} character`);l=l<<r|s,(a+=r)>=8&&(a-=8,o[u++]=255&l>>a)}if(a>=r||(255&l<<8-a)!=0)throw SyntaxError("Unexpected end of data");return o})(t,n,r,e)})}let Z=Y({prefix:"9",name:"base10",alphabet:"0123456789"}),X=J({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Q=J({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ee=J({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),et=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),er=et.reduce((e,t,r)=>(e[r]=t,e),[]),en=et.reduce((e,t,r)=>{let n=t.codePointAt(0);if(null==n)throw Error(`Invalid character: ${t}`);return e[n]=r,e},[]),ei=K({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=er[t],"")},decode:function(e){let t=[];for(let r of e){let e=r.codePointAt(0);if(null==e)throw Error(`Invalid character: ${r}`);let n=en[e];if(null==n)throw Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}}),es=J({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eo=J({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ea=J({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),el=J({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eu=J({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eh=J({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ec=J({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ed=J({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ef=J({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ep=Y({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),eg=Y({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ey=Y({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),em=Y({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ew=J({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),eb=J({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ev=J({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),eE=J({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),eS=J({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ek=K({prefix:"\0",name:"identity",encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)}),eA=new TextEncoder,ex=new TextDecoder,eI="json",eB=512;function eC(e){return eA.encode(JSON.stringify(e))}function eN(e){return JSON.parse(ex.decode(e))}let eT="raw",e_=85;function eL(e){return z(e)}function eR(e){return z(e)}let eO={encode:function e(t,r,n){r=r||[];for(var i=n=n||0;t>=0x80000000;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},decode:function e(t,r){var n,i=0,r=r||0,s=0,o=r,a=t.length;do{if(o>=a)throw e.bytes=0,RangeError("Could not decode varint");n=t[o++],i+=s<28?(127&n)<<s:(127&n)*Math.pow(2,s),s+=7}while(n>=128);return e.bytes=o-r,i},encodingLength:function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10}};function eP(e,t=0){return[eO.decode(e,t),eO.decode.bytes]}function eU(e,t,r=0){return eO.encode(e,t,r),t}function eD(e){return eO.encodingLength(e)}function eF(e,t){let r=t.byteLength,n=eD(e),i=n+eD(r),s=new Uint8Array(i+r);return eU(e,s,0),eU(r,s,n),s.set(t,i),new eM(e,r,t,s)}function e$(e){let t=z(e),[r,n]=eP(t),[i,s]=eP(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw Error("Incorrect length");return new eM(r,i,o,t)}class eM{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}let ez={code:0,name:"identity",encode:z,digest:function(e){return eF(0,z(e))}};function eH({name:e,code:t,encode:r}){return new eV(e,t,r)}class eV{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?eF(this.code,t):t.then(e=>eF(this.code,e))}throw Error("Unknown type, must be binary type")}}function eq(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}let ej=eH({name:"sha2-256",code:18,encode:eq("SHA-256")}),eG=eH({name:"sha2-512",code:19,encode:eq("SHA-512")});function eW(e,t){let{bytes:r,version:n}=e;return 0===n?function(e,t,r){let{prefix:n}=r;if(n!==ey.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(null!=i)return i;{let i=r.encode(e).slice(1);return t.set(n,i),i}}(r,eY(e),t??ey.encoder):function(e,t,r){let{prefix:n}=r,i=t.get(n);if(null!=i)return i;{let i=r.encode(e);return t.set(n,i),i}}(r,eY(e),t??es.encoder)}let eK=new WeakMap;function eY(e){let t=eK.get(e);if(null==t){let t=new Map;return eK.set(e,t),t}return t}class eJ{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==eZ)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==eX)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return eJ.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=eF(e,t);return eJ.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return eJ.equals(this,e)}static equals(e,t){var r,n;return null!=t&&e.code===t.code&&e.version===t.version&&((r=e.multihash)===(n=t.multihash)||r.code===n.code&&r.size===n.size&&n.bytes instanceof Uint8Array&&function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(r.bytes,n.bytes))}toString(e){return eW(this,e)}toJSON(){return{"/":eW(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;if(e instanceof eJ)return e;if(null!=e["/"]&&e["/"]===e.bytes||e.asCID===e){let{version:t,code:r,multihash:n,bytes:i}=e;return new eJ(t,r,n,i??eQ(t,r,n.bytes))}if(!0!==e[e0])return null;{let{version:t,multihash:r,code:n}=e,i=e$(r);return eJ.create(t,n,i)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===eZ)return new eJ(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${eZ}) block encoding`);case 1:{let n=eQ(e,t,r.bytes);return new eJ(e,t,r,n)}default:throw Error("Invalid version")}}static createV0(e){return eJ.create(0,eZ,e)}static createV1(e,t){return eJ.create(1,e,t)}static decode(e){let[t,r]=eJ.decodeFirst(e);if(0!==r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=eJ.inspectBytes(e),r=t.size-t.multihashSize,n=z(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=n.subarray(t.multihashSize-t.digestSize),s=new eM(t.multihashCode,t.digestSize,i,n);return[0===t.version?eJ.createV0(s):eJ.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=eP(e.subarray(t));return t+=n,r},n=r(),i=eZ;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let s=t,o=r(),a=r(),l=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:l-s,size:l}}static parse(e,t){let[r,n]=function(e,t){switch(e[0]){case"Q":{let r=t??ey;return[ey.prefix,r.decode(`${ey.prefix}${e}`)]}case ey.prefix:{let r=t??ey;return[ey.prefix,r.decode(e)]}case es.prefix:{let r=t??es;return[es.prefix,r.decode(e)]}case ep.prefix:{let r=t??ep;return[ep.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),i=eJ.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return eY(i).set(r,e),i}}let eZ=112,eX=18;function eQ(e,t,r){let n=eD(e),i=n+eD(t),s=new Uint8Array(i+r.byteLength);return eU(e,s,0),eU(t,s,n),s.set(r,i),s}let e0=Symbol.for("@ipld/js-cid/CID"),e1={...x,...w,...A,...y,...m,...v,...E,...S,...k,...b};function e2(e=0){return new Uint8Array(e)}function e8(e=0){return new Uint8Array(e)}function e6(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}({...N,...C});let e4=e6("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),e3=e6("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{let t=e8((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),e5={utf8:e4,"utf-8":e4,hex:e1.base16,latin1:e3,ascii:e3,binary:e3,...e1};function e7(e,t="utf8"){let r=e5[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function e9(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}class te{fp;h;seed;constructor(e,t,r,n=2){if(n>64)throw TypeError("Invalid Fingerprint Size");let i=t.hashV(e,r),s=e2(n);for(let e=0;e<s.length;e++)s[e]=i[e];0===s.length&&(s[0]=7),this.fp=s,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array&&e9(this.fp,e.fp)}}function tt(e,t){return Math.floor(Math.random()*(t-e))+e}class tr{contents;constructor(e){this.contents=Array(e).fill(null)}has(e){if(!(e instanceof te))throw TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof te))throw TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(null==this.contents[t]){this.contents[t]=e;break}return!0}swap(e){if(!(e instanceof te))throw TypeError("Invalid Fingerprint");let t=tt(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof te))throw TypeError("Invalid Fingerprint");let t=this.contents.findIndex(t=>e.equals(t));return t>-1&&(this.contents[t]=null,!0)}}let tn={32:16777619n,64:1099511628211n,128:0x1000000000000000000013bn,256:0x1000000000000000000000000000000000000000163n,512:0x100000000000000000000000000000000000000000000000000000000000000000000000000000000000157n,1024:0x10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018dn},ti={32:2166136261n,64:0xcbf29ce484222325n,128:0x6c62272e07bb014262b821756295c58dn,256:0xdd268dbcaac550362d98c384c4e576ccc8b1536847b6bbb31023b4c8caee0535n,512:0xb86db0b1171f4416dca1e50f309990acac87d059c90000000000000000000d21e948f68a34c192f62ea79bc942dbe7ce182036415f56e34bac982aac4afe9fd9n,1024:0x5f7a76758ecc4d32e56d5a591028b74b29fc4223fdada16c3bf34eda3674da9a21d9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004c6d7eb6e73802734510a555f256cc005ae556bde8cc9c6a93b21aff4b16c71ee90b3n},ts=new globalThis.TextEncoder;var to=r(38437);let ta={hash:e=>Number(function(e,{size:t=32,utf8Buffer:r}={}){if(!tn[t])throw Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if("string"==typeof e){if(r)return function(e,t,r){if(0===r.length)throw Error("The `utf8Buffer` option must have a length greater than zero");let n=tn[t],i=ti[t],s=e;for(;s.length>0;){let e=ts.encodeInto(s,r);s=s.slice(e.read);for(let s=0;s<e.written;s++)i^=BigInt(r[s]),i=BigInt.asUintN(t,i*n)}return i}(e,t,r);e=ts.encode(e)}return function(e,t){let r=tn[t],n=ti[t];for(let i=0;i<e.length;i++)n^=BigInt(e[i]),n=BigInt.asUintN(t,n*r);return n}(e,t)}(e,{size:32})),hashV:(e,t)=>(function(e){let t=e.toString(16);return t.length%2==1&&(t=`0${t}`),e7(t,"base16")})(ta.hash(e,t))};class tl{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??ta,this.seed=e.seed??tt(0,1024)}add(e){"string"==typeof e&&(e=e7(e));let t=new te(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=(r^t.hash())%this.filterSize;if(null==this.buckets[r]&&(this.buckets[r]=new tr(this.bucketSize)),null==this.buckets[n]&&(this.buckets[n]=new tr(this.bucketSize)),this.buckets[r].add(t)||this.buckets[n].add(t))return this.count++,!0;let i=[r,n],s=i[tt(0,i.length-1)];null==this.buckets[s]&&(this.buckets[s]=new tr(this.bucketSize));for(let e=0;e<500;e++){let e=this.buckets[s].swap(t);if(null!=e){if(s=(s^e.hash())%this.filterSize,null==this.buckets[s]&&(this.buckets[s]=new tr(this.bucketSize)),this.buckets[s].add(e))return this.count++,!0;continue}}return!1}has(e){"string"==typeof e&&(e=e7(e));let t=new te(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.has(t)??!1;if(n)return n;let i=(r^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){"string"==typeof e&&(e=e7(e));let t=new te(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.remove(t)??!1;if(n)return this.count--,n;let i=(r^t.hash())%this.filterSize,s=this.buckets[i]?.remove(t)??!1;return s&&this.count--,s}get reliable(){return 90>=Math.floor(100*(this.count/this.filterSize))}}let tu={1:.5,2:.84,4:.95,8:.98};class th{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??262144/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??ta,this.seed=e.seed??tt(0,1024),this.filterSeries=[new tl({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if("string"==typeof e&&(e=e7(e)),this.has(e))return!0;let t=this.filterSeries.find(e=>e.reliable);return null==t&&(t=new tl({filterSize:this.filterSize*Math.pow(this.scale,this.filterSeries.length),bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)),t.add(e)}has(e){"string"==typeof e&&(e=e7(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){"string"==typeof e&&(e=e7(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}class tc extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class td extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class tf extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class tp extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}}class tg extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class ty extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class tm extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}function tw(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}class tb{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class tv{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new tb(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new tb(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class tE extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function tS(e={}){return function(e,t){let r,n,i;let s=(t=t??{}).onEnd,o=new tv,a=tw(),l=e=>null!=n?n(e):(o.push(e),r),u=e=>(o=new tv,null!=n)?n({error:e}):(o.push({error:e}),r),h=e=>{if(i)return r;if(t?.objectMode!==!0&&e?.byteLength==null)throw Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},c=e=>i?r:(i=!0,null!=e?u(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{if(!o.isEmpty())return e(o);if(i)return{done:!0};return await new Promise((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})}finally{o.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=tw()})}},return:()=>(o=new tv,c(),{done:!0}),throw:e=>(c(e),{done:!0}),push:h,end:c,get readableLength(){return o.size},onEmpty:async e=>{let t,r;let n=e?.signal;if(n?.throwIfAborted(),!o.isEmpty()){null!=n&&(t=new Promise((e,t)=>{r=()=>{t(new tE)},n.addEventListener("abort",r)}));try{await Promise.race([a.promise,t])}finally{null!=r&&null!=n&&n?.removeEventListener("abort",r)}}}},null==s)return r;let d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:h,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)}}(e=>{let t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}},e)}class tk extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}}async function tA(e,t,r,n){let i=new tk(n?.errorMessage,n?.errorCode);return r?.aborted===!0?Promise.reject(i):new Promise((s,o)=>{function a(){r?.removeEventListener("abort",h),e.removeEventListener(t,l),n?.errorEvent!=null&&e.removeEventListener(n.errorEvent,u)}let l=e=>{try{if(n?.filter?.(e)===!1)return}catch(e){a(),o(e);return}a(),s(e)},u=e=>{a(),o(e.detail)},h=()=>{a(),o(i)};r?.addEventListener("abort",h),e.addEventListener(t,l),n?.errorEvent!=null&&e.addEventListener(n.errorEvent,u)})}class tx extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}class tI extends Error{type;code;constructor(e,t,r){super(e??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=t??"ABORT_ERR"}}async function tB(e,t,r){let n;if(null==t)return e;if(t.aborted)return Promise.reject(new tI(r?.errorMessage,r?.errorCode,r?.errorName));let i=new tI(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((e,r)=>{n=()=>{r(i)},t.addEventListener("abort",n)})])}finally{null!=n&&t.removeEventListener("abort",n)}}class tC{deferred;signal;constructor(e){this.signal=e,this.deferred=tw(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new tc)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}class tN{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,D(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>e&&t.signal?.aborted===!0,!0)&&(this.controller.abort(new tc),this.cleanup())}async join(e={}){let t=new tC(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=await tB(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class tT extends F{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),0===this.running&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new tx;let r=new tN(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status){for(let e=0;e<this.queue.length;e++)if(this.queue[e]===r){this.queue.splice(e,1);break}}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new tc)}),this.clear()}async onEmpty(e){0!==this.size&&await tA(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await tA(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){(0!==this.pending||0!==this.size)&&await tA(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async *toGenerator(e){e?.signal?.throwIfAborted();let t=tS({objectMode:!0}),r=e=>{null!=e?this.abort():this.clear(),t.end(e)},n=e=>{null!=e.detail&&t.push(e.detail)},i=e=>{r(e.detail)},s=()=>{r()},o=()=>{r(new tc("Queue aborted"))};this.addEventListener("completed",n),this.addEventListener("error",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",o);try{yield*t}finally{this.removeEventListener("completed",n),this.removeEventListener("error",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",o),r()}}}class t_ extends F{intialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;constructor(e,t){super(),D(1/0,this),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??1,this.maxProviders=t.maxProviders??5,this.providers=[],this.evictionFilter=function(e,t=.001,r){return new th({...function(e,t=.001){let r=function(e=.001){return e>.002?2:e>1e-5?4:8}(t),n=Math.round(e/tu[r]),i=Math.min(Math.ceil(Math.log2(1/t)+Math.log2(2*r)),64);return{filterSize:n,bucketSize:r,fingerprintSize:i}}(e,t),...(void 0)??{}})}(this.maxProviders)}async retrieve(e,t={}){let r=ew.encode(e.multihash.bytes),n=this.requests.get(r);if(null!=n)return this.log("join existing request for %c",e),n;let i=tw();if(this.requests.set(r,i.promise),0===this.providers.length){let r=!1;null==this.intialPeerSearchComplete&&(r=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.intialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),await this.intialPeerSearchComplete,r&&this.log("found initial session peers for %c",e)}let s=!1,o=new tT({concurrency:this.maxProviders});o.addEventListener("error",()=>{}),o.addEventListener("failure",e=>{this.log.error("error querying provider %o, evicting from session",e.detail.job.options.provider,e.detail.error),this.evict(e.detail.job.options.provider)}),o.addEventListener("success",e=>{s=!0,i.resolve(e.detail.result)}),o.addEventListener("idle",()=>{s||t.signal?.aborted===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",e);for(let e=0;e<this.minProviders&&0!==this.providers.length;e++){let e=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(e)}await this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(r),i.resolve(await this.retrieve(e,t))}).catch(t=>{this.log.error("could not find new providers for %c",e,t),i.reject(t)})});let a=r=>{o.add(async()=>this.queryProvider(e,r.detail,t),{provider:r.detail}).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)})};this.addEventListener("provider",a),Promise.all([...this.providers].map(async r=>o.add(async()=>this.queryProvider(e,r,t),{provider:r}))).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)});try{return await i.promise}finally{this.removeEventListener("provider",a),o.clear(),this.requests.delete(r)}}evict(e){this.evictionFilter.add(this.toEvictionKey(e));let t=this.providers.findIndex(t=>this.equals(t,e));-1!==t&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(null!=this.providers.find(t=>this.equals(t,e))||this.isEvicted(e))}async findProviders(e,t,r){let n=tw(),i=0;return Promise.resolve().then(async()=>{for await(let s of(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.findNewProviders(e,r))){if(i===this.maxProviders||r.signal?.aborted===!0)break;if(!this.hasProvider(s)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(s),this.safeDispatchEvent("provider",{detail:s}),++i===t&&(this.log("session is ready"),n.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new R(`Found ${i} of ${t} ${this.name} providers for ${e}`)}).catch(t=>{this.log.error("error searching routing for potential session peers for %c",e,t.errors??t),n.reject(t)}),n.promise}}class tL{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0)||void 0!==this.readGivenChar(e))return r()})}readNumber(e,t,r,n){return this.readAtomically(()=>{let i=0,s=0,o=this.peekChar();if(void 0===o)return;let a=2**(8*n)-1;for(;;){let r=this.readAtomically(()=>{let t=this.readChar();if(void 0===t)return;let r=Number.parseInt(t,e);if(!Number.isNaN(r))return r});if(void 0===r)break;if(i*=e,(i+=r)>a||(s+=1,void 0!==t&&s>t))return}return 0===s?void 0:!r&&"0"===o&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(void 0===r)return;e[t]=r}return e})}readIPv6Addr(){let e=e=>{for(let t=0;t<e.length/2;t++){let r=2*t;if(t<e.length-3){let n=this.readSeparator(":",t,()=>this.readIPv4Addr());if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}let n=this.readSeparator(":",t,()=>this.readNumber(16,4,!0,2));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n||void 0===this.readGivenChar(":")||void 0===this.readGivenChar(":"))return;let i=new Uint8Array(14),[s]=e(i.subarray(0,16-(r+2)));return t.set(i.subarray(0,s),16-s),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}let tR=new tL;function tO(e){return!!function(e){if(!(e.length>15))return tR.new(e).parseWith(()=>tR.readIPv4Addr())}(e)}function tP(e){return!!function(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>45))return tR.new(e).parseWith(()=>tR.readIPv6Addr())}(e)}function tU(e){return!!function(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>45))return tR.new(e).parseWith(()=>tR.readIPAddr())}(e)}var tD=r(55507);let tF=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(e=>new tD.Netmask(e));function t$(e){for(let t of tF)if(t.contains(e))return!0;return!1}let tM=e=>e.toString().split("/").slice(1),tz=e=>({match:t=>!(t.length<1)&&!!e(t[0])&&t.slice(1),pattern:"fn"}),tH=e=>({match:t=>tz(t=>t===e).match(t),pattern:e}),tV=()=>({match:e=>tz(e=>"string"==typeof e).match(e),pattern:"{string}"}),tq=()=>({match:e=>tz(e=>!isNaN(parseInt(e))).match(e),pattern:"{number}"}),tj=()=>({match:e=>{if(e.length<2||"p2p"!==e[0]&&"ipfs"!==e[0]||!(e[1].startsWith("Q")||e[1].startsWith("1")))return!1;try{ey.decode(`z${e[1]}`)}catch(e){return!1}return e.slice(2)},pattern:"/p2p/{peerid}"}),tG=()=>({match:e=>{if(e.length<2||"certhash"!==e[0])return!1;try{ev.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),tW=e=>({match:t=>{let r=e.match(t);return!1===r?t:r},pattern:`optional(${e.pattern})`}),tK=(...e)=>({match:t=>{let r;for(let n of e){let e=n.match(t);!1!==e&&(null==r||e.length<r.length)&&(r=e)}return null!=r&&r},pattern:`or(${e.map(e=>e.pattern).join(", ")})`}),tY=(...e)=>({match:t=>{for(let r of e){let e=r.match(t);if(!1===e)return!1;t=e}return t},pattern:`and(${e.map(e=>e.pattern).join(", ")})`});function tJ(...e){function t(t){let r=tM(t);for(let t of e){let e=t.match(r);if(!1===e)return!1;r=e}return r}return{matchers:e,matches:function(e){return!1!==t(e)},exactMatch:function(e){let r=t(e);return!1!==r&&0===r.length}}}let tZ=tY(tH("dns4"),tV()),tX=tY(tH("dns6"),tV()),tQ=tY(tH("dnsaddr"),tV()),t0=tY(tH("dns"),tV());tJ(tZ,tW(tj())),tJ(tX,tW(tj())),tJ(tQ,tW(tj()));let t1=tJ(tK(t0,tQ,tZ,tX),tW(tj())),t2=tY(tH("ip4"),tz(tO)),t8=tY(tH("ip6"),tz(tP)),t6=tK(t2,t8),t4=tK(t6,t0,tZ,tX,tQ);tJ(tK(t6,tY(tK(t0,tQ,tZ,tX),tW(tj())))),tJ(t2),tJ(t8),tJ(t6);let t3=tY(t4,tH("tcp"),tq()),t5=tY(t4,tH("udp"),tq());tJ(tY(t3,tW(tj()))),tJ(t5);let t7=tY(t5,tH("quic")),t9=tY(t5,tH("quic-v1")),re=tK(t7,t9);tJ(t7),tJ(t9);let rt=tK(t4,t3,t5,t7,t9),rr=tK(tY(rt,tH("ws"),tW(tj())));tJ(rr);let rn=tK(tY(rt,tH("wss"),tW(tj())),tY(rt,tH("tls"),tW(tY(tH("sni"),tV())),tH("ws"),tW(tj())));tJ(rn);let ri=tY(t5,tH("webrtc-direct"),tW(tG()),tW(tG()),tW(tj()));tJ(ri);let rs=tY(t9,tH("webtransport"),tW(tG()),tW(tG()),tW(tj()));tJ(rs);let ro=tK(rr,rn,tY(t3,tW(tj())),tY(re,tW(tj())),tY(t4,tW(tj())),ri,rs,tj());tJ(ro),tJ(tY(ro,tH("p2p-circuit"),tj())),tJ(tK(tY(ro,tH("p2p-circuit"),tH("webrtc"),tW(tj())),tY(ro,tH("webrtc"),tW(tj())),tH("webrtc")));let ra=tJ(tK(tY(t4,tH("tcp"),tq(),tH("http"),tW(tj())),tY(t4,tH("http"),tW(tj())))),rl=tJ(tK(tY(t4,tH("tcp"),tK(tY(tH("443"),tH("http")),tY(tq(),tH("https"))),tW(tj())),tY(t4,tH("tls"),tH("http"),tW(tj())),tY(t4,tH("https"),tW(tj()))));function ru(e,t="utf8"){let r=e5[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}function rh(e){if(e<128)return 1;if(e<16384)return 2;if(e<2097152)return 3;if(e<0x10000000)return 4;if(e<0x800000000)return 5;if(e<0x40000000000)return 6;if(e<0x2000000000000)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw RangeError("Could not encode varint");return 8}function rc(e,t,r=0){switch(rh(e)){case 8:t[r++]=255&e|128,e/=128;case 7:t[r++]=255&e|128,e/=128;case 6:t[r++]=255&e|128,e/=128;case 5:t[r++]=255&e|128,e/=128;case 4:t[r++]=255&e|128,e>>>=7;case 3:t[r++]=255&e|128,e>>>=7;case 2:t[r++]=255&e|128,e>>>=7;case 1:t[r++]=255&e,e>>>=7;break;default:throw Error("unreachable")}return t}function rd(e,t){let r,n=e[t];if(r=0+(127&n),n<128||(r+=(127&(n=e[t+1]))<<7,n<128)||(r+=(127&(n=e[t+2]))<<14,n<128)||(r+=(127&(n=e[t+3]))<<21,n<128)||(r+=(127&(n=e[t+4]))*0x10000000,n<128)||(r+=(127&(n=e[t+5]))*0x800000000,n<128)||(r+=(127&(n=e[t+6]))*0x40000000000,n<128)||(r+=(127&(n=e[t+7]))*0x2000000000000,n<128))return r;throw RangeError("Could not decode varint")}function rf(e,t,r=0){return(null==t&&(t=e8(rh(e))),t instanceof Uint8Array)?rc(e,t,r):function(e,t,r=0){switch(rh(e)){case 8:t.set(r++,255&e|128),e/=128;case 7:t.set(r++,255&e|128),e/=128;case 6:t.set(r++,255&e|128),e/=128;case 5:t.set(r++,255&e|128),e/=128;case 4:t.set(r++,255&e|128),e>>>=7;case 3:t.set(r++,255&e|128),e>>>=7;case 2:t.set(r++,255&e|128),e>>>=7;case 1:t.set(r++,255&e),e>>>=7;break;default:throw Error("unreachable")}return t}(e,t,r)}function rp(e,t=0){return e instanceof Uint8Array?rd(e,t):function(e,t){let r,n=e.get(t);if(r=0+(127&n),n<128||(r+=(127&(n=e.get(t+1)))<<7,n<128)||(r+=(127&(n=e.get(t+2)))<<14,n<128)||(r+=(127&(n=e.get(t+3)))<<21,n<128)||(r+=(127&(n=e.get(t+4)))*0x10000000,n<128)||(r+=(127&(n=e.get(t+5)))*0x800000000,n<128)||(r+=(127&(n=e.get(t+6)))*0x40000000000,n<128)||(r+=(127&(n=e.get(t+7)))*0x2000000000000,n<128))return r;throw RangeError("Could not decode varint")}(e,t)}function rg(e,t){null==t&&(t=e.reduce((e,t)=>e+t.length,0));let r=e8(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return r}tJ(tK(tY(tH("memory"),tV(),tW(tj())))),parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);let ry=function(e){let t=0;if(tO(e=e.toString().trim())){let r=new Uint8Array(t+4);return e.split(/\./g).forEach(e=>{r[t++]=255&parseInt(e,10)}),r}if(tP(e)){let r;let n=e.split(":",8);for(r=0;r<n.length;r++){let e;tO(n[r])&&(e=ry(n[r]),n[r]=ru(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,ru(e.slice(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);let e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}let i=new Uint8Array(t+16);for(r=0;r<n.length;r++){let e=parseInt(n[r],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw Error("invalid ip address")},rm=function(e,t=0,r){t=~~t,r=r??e.length-t;let n=new DataView(e.buffer);if(4===r){let n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){let e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},rw={},rb={};function rv(e){if("number"==typeof e){if(null!=rb[e])return rb[e];throw Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=rw[e])return rw[e];throw Error(`no protocol with name: ${e}`)}throw Error(`invalid protocol id type: ${typeof e}`)}function rE(e,t){switch(rv(e).code){case 4:case 41:return function(e){let t=rm(e,0,e.length);if(null==t)throw Error("ipBuff is required");if(!tU(t))throw Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return rC(t);case 6:case 273:case 33:case 132:return rI(t).toString();case 421:return function(e){let t=rp(e),r=e.slice(rh(t));if(r.length!==t)throw Error("inconsistent lengths");return ru(r,"base58btc")}(t);case 444:case 445:return function(e){let t=e.slice(0,e.length-2),r=e.slice(e.length-2),n=ru(t,"base32"),i=rI(r);return`${n}:${i}`}(t);case 466:return function(e){let t=rp(e),r=e.slice(rh(t));if(r.length!==t)throw Error("inconsistent lengths");return"u"+ru(r,"base64url")}(t);case 481:return globalThis.encodeURIComponent(rC(t));default:return ru(t,"base16")}}function rS(e,t){switch(rv(e).code){case 4:case 41:return function(e){if(!tU(e))throw Error("invalid ip address");return ry(e)}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return rB(t);case 6:case 273:case 33:case 132:return rx(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?e$(ey.decode(`z${e}`)).bytes:eJ.parse(e).multihash.bytes;let r=Uint8Array.from(rf(t.length));return rg([r,t],r.length+t.length)}(t);case 444:return function(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=es.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=rx(n);return rg([r,i],r.length+i.length)}(t);case 445:return function(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=es.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=rx(n);return rg([r,i],r.length+i.length)}(t);case 466:return function(e){let t=rA.decode(e),r=Uint8Array.from(rf(t.length));return rg([r,t],r.length+t.length)}(t);case 481:return rB(globalThis.decodeURIComponent(t));default:return e7(t,"base16")}}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]].forEach(e=>{let t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:!!n,path:!!i}}(...e);rb[t.code]=t,rw[t.name]=t}),rv("ip4"),rv("ip6"),rv("ipcidr");let rk=Object.values(e1).map(e=>e.decoder),rA=function(){let e=rk[0].or(rk[1]);return rk.slice(2).forEach(t=>e=e.or(t)),e}();function rx(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function rI(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function rB(e){let t=e7(e),r=Uint8Array.from(rf(t.length));return rg([r,t],r.length+t.length)}function rC(e){let t=rp(e);if((e=e.slice(rh(t))).length!==t)throw Error("inconsistent lengths");return ru(e)}function rN(e){let t=[],r=[],n=null,i=0;for(;i<e.length;){let s=rp(e,i),o=rh(s),a=rv(s),l=function(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{let e=rp(t instanceof Uint8Array?t:Uint8Array.from(t));return e+rh(e)}}(a,e.slice(i+o));if(0===l){t.push([s]),r.push([s]),i+=o;continue}let u=e.slice(i+o,i+o+l);if((i+=l+o)>e.length)throw rR("Invalid address Uint8Array: "+ru(e,"base16"));t.push([s,u]);let h=rE(s,u);if(r.push([s,h]),!0===a.path){n=h;break}}return{bytes:Uint8Array.from(e),string:rT(r),tuples:t,stringTuples:r,path:n}}function rT(e){let t=[];return e.map(e=>{let r=rv(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null}),rL(t.join("/"))}function r_(e){return rg(e.map(e=>{let t=rv(e[0]),r=Uint8Array.from(rf(t.code));return e.length>1&&null!=e[1]&&(r=rg([r,e[1]])),r}))}function rL(e){return"/"+e.trim().split("/").filter(e=>e).join("/")}function rR(e){return Error("Error parsing address: "+e)}let rO=Symbol.for("nodejs.util.inspect.custom"),rP=Symbol.for("@multiformats/js-multiaddr/multiaddr"),rU=[rv("dns").code,rv("dns4").code,rv("dns6").code,rv("dnsaddr").code];class rD extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}class rF{bytes;#t;#r;#n;#i;[rP]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=rN(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw Error(`multiaddr "${e}" must start with a "/"`);t=function(e){e=rL(e);let t=[],r=[],n=null,i=e.split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){let o=rv(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(++s>=i.length)throw rR("invalid address: "+e);if(!0===o.path){n=rL(i.slice(s).join("/")),t.push([o.code,rS(o.code,n)]),r.push([o.code,n]);break}let a=rS(o.code,i[s]);t.push([o.code,a]),r.push([o.code,rE(o.code,a)])}return{string:rT(r),bytes:r_(t),tuples:t,stringTuples:r,path:n}}(e)}else{var r;if(r=e,r?.[rP])t=rN(e.bytes);else throw Error("addr must be a string, Buffer, or another Multiaddr")}this.bytes=t.bytes,this.#t=t.string,this.#r=t.tuples,this.#n=t.stringTuples,this.#i=t.path}toString(){return this.#t}toJSON(){return this.toString()}toOptions(){let e,t,r,n;let i="",s=rv("tcp"),o=rv("udp"),a=rv("ip4"),l=rv("ip6"),u=rv("dns6"),h=rv("ip6zone");for(let[c,d]of this.stringTuples())c===h.code&&(i=`%${d??""}`),rU.includes(c)&&(t=s.name,n=443,r=`${d??""}${i}`,e=c===u.code?6:4),(c===s.code||c===o.code)&&(t=rv(c).name,n=parseInt(d??"")),(c===a.code||c===l.code)&&(t=rv(c).name,r=`${d??""}${i}`,e=c===l.code?6:4);if(null==e||null==t||null==r||null==n)throw Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#r.map(([e])=>Object.assign({},rv(e)))}protoCodes(){return this.#r.map(([e])=>e)}protoNames(){return this.#r.map(([e])=>rv(e).name)}tuples(){return this.#r}stringTuples(){return this.#n}encapsulate(e){return e=new rF(e),new rF(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new rF(r.slice(0,n))}decapsulateCode(e){let t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new rF(r_(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([t,r])=>{t===rw.p2p.code&&e.push([t,r]),t===rw["p2p-circuit"].code&&(e=[])});let t=e.pop();if(t?.[1]!=null){let e=t[1];if("Q"===e[0]||"1"===e[0])return ru(ey.decode(`z${e}`),"base58btc");return ru(eJ.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#i}equals(e){return e9(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(e=>e.resolvable);if(null==t)return[this];let r=r$.get(t.name);if(null==r)throw new rD(`no available resolver for ${t.name}`);return(await r(this,e)).map(e=>rM(e))}nodeAddress(){let e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return 2===t.length&&(4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code)}[rO](){return`Multiaddr(${this.#t})`}}let r$=new Map;function rM(e){return new rF(e)}let rz=[rv("tcp").code,rv("dns").code,rv("dnsaddr").code,rv("dns4").code,rv("dns6").code];function rH(e){return rq("sni",e)?.[1]}function rV(e){let t=rq("tcp",e)?.[1];return null==t?"":`:${t}`}function rq(e,t){let r;try{r=rv(e).code}catch(e){return}for(let[e,n]of t)if(e===r&&null!=n)return[e,n]}function rj(e){return e.some(([e,t])=>e===rv("tls").code)}function rG(e,t,r){let n=rW[rv(e).name];if(null==n)throw Error(`Can't interpret protocol ${rv(e).name}`);let i=n(t,r);return e===rv("ip6").code?`[${i}]`:i}let rW={ip4:(e,t)=>e,ip6:(e,t)=>0===t.length?e:`[${e}]`,tcp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`tcp://${rG(r[0],r[1]??"",t)}:${e}`},udp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`udp://${rG(r[0],r[1]??"",t)}:${e}`},dnsaddr:(e,t)=>e,dns4:(e,t)=>e,dns6:(e,t)=>e,dns:(e,t)=>e,ipfs:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${rG(r[0],r[1]??"",t)}/ipfs/${e}`},p2p:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${rG(r[0],r[1]??"",t)}/p2p/${e}`},http:(e,t)=>{let r=rj(t),n=rH(t),i=rV(t);if(r&&null!=n)return`https://${n}${i}`;let s=t.pop();if(null==s)throw Error("Unexpected end of multiaddr");let o=rG(s[0],s[1]??"",t);return o=o.replace("tcp://",""),`${r?"https://":"http://"}${o}`},"http-path":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=rG(r[0],r[1]??"",t),i=decodeURIComponent(e);return`${n}/${i}`},tls:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return rG(r[0],r[1]??"",t)},sni:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return rG(r[0],r[1]??"",t)},https:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=rG(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`https://${n}`},ws:(e,t)=>{let r=rj(t),n=rH(t),i=rV(t);if(r&&null!=n)return`wss://${n}${i}`;let s=t.pop();if(null==s)throw Error("Unexpected end of multiaddr");let o=rG(s[0],s[1]??"",t);return o=o.replace("tcp://",""),`${r?"wss://":"ws://"}${o}`},wss:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=rG(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`wss://${n}`},"p2p-websocket-star":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${rG(r[0],r[1]??"",t)}/p2p-websocket-star`},"p2p-webrtc-star":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${rG(r[0],r[1]??"",t)}/p2p-webrtc-star`},"p2p-webrtc-direct":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${rG(r[0],r[1]??"",t)}/p2p-webrtc-direct`}};class rK{url;#s=0;#o=0;#a=0;#l=0;#u=new Map;log;constructor(e,t){this.url=e instanceof URL?e:new URL(e),this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#h(e){let t=e.multihash.bytes;return ew.encode(t)}async getRawBlock(e,t){let r=new URL(this.url.toString());if(r.pathname=`/ipfs/${e.toString()}`,r.search="?format=raw",t?.aborted===!0)throw Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);let n=this.#h(e),i=new AbortController,s=()=>{i.abort()};t?.addEventListener("abort",s);try{let t=this.#u.get(n);return null==t&&(this.#s++,t=fetch(r.toString(),{signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"}).then(async t=>{if(this.log("GET %s %d",r,t.status),!t.ok)throw this.#o++,Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return this.#l++,new Uint8Array(await t.arrayBuffer())}),this.#u.set(n,t)),await t}catch(r){if(t?.aborted===!0)throw Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`);throw this.#o++,Error(`unable to fetch raw block for CID ${e}`)}finally{t?.removeEventListener("abort",s),this.#u.delete(n)}}reliability(){return 0===this.#s?1:this.#a>0?-1/0:this.#l/(this.#s+3*this.#o)}incrementInvalidBlocks(){this.#a++}getStats(){return{attempts:this.#s,errors:this.#o,invalidBlocks:this.#a,successes:this.#l,pendingResponses:this.#u.size}}}async function*rY(e,t,r,n,i,s){for await(let o of t.findProviders(e,s)){let e=function(e,t,r){return e.filter(e=>{if(rl.matches(e)||t&&ra.matches(e)){var n;return!!(r||t1.matches(e))||!1===(tO(n=e.toOptions().host)?t$(n):/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(n)?function(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0");return t$(`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`)}(n):/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)?function(e){let t=e.split(":");return t$(t[t.length-1])}(n):tP(n)?/^::$/.test(n)||/^::1$/.test(n)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(n)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(n)||/^ff([0-9a-fA-F]{2,2}):/i.test(n):void 0)}if(!t&&r){let{host:t}=e.toOptions();if("127.0.0.1"===t||"localhost"===t||t.endsWith(".localhost"))return!0}return!1})}(o.multiaddrs,n,i);if(0===e.length)continue;let t=function(e,t){let r=rM(e).stringTuples(),n=r.pop();if(null==n)throw Error("Unexpected end of multiaddr");let i=rv(n[0]),s=rW[i.name];if(null==s)throw Error(`No interpreter found for ${i.name}`);let o=s(n[1]??"",r);return rz.includes(n[0])&&(o=o.replace(/^.*:\/\//,""),o="443"===n[1]?`https://${o}`:`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString()).endsWith("/")&&(o=o.substring(0,o.length-1)),o}(e[0]);yield new rK(t,r)}}class rJ extends t_{routing;allowInsecure;allowLocal;constructor(e,t){super(e,{...t,name:"helia:trustless-gateway:session"}),this.routing=e.routing,this.allowInsecure=t.allowInsecure??rX,this.allowLocal=t.allowLocal??rQ}async queryProvider(e,t,r){this.log("fetching BLOCK for %c from %s",e,t.url);let n=await t.getRawBlock(e,r.signal);return this.log.trace("got block for %c from %s",e,t.url),await r.validateFn?.(n),n}async *findNewProviders(e,t={}){yield*rY(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,t)}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}}class rZ{allowInsecure;allowLocal;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??rX,this.allowLocal=t.allowLocal??rQ}async retrieve(e,t={}){let r=[];for await(let n of rY(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,t)){this.log("getting block for %c from %s",e,n.url);try{let r=await n.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,n.url);try{await t.validateFn?.(r)}catch(t){this.log.error("failed to validate block for %c from %s",e,n.url,t);continue}return r}catch(i){if(this.log.error("failed to get block for %c from %s",e,n.url,i),i instanceof Error?r.push(i):r.push(Error(`Unable to fetch raw block for CID ${e} from gateway ${n.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,n.url);break}}}if(r.length>0)throw AggregateError(r,`Unable to fetch raw block for CID ${e} from any gateway`);throw Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return new rJ({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure})}}let rX=!1,rQ=!1;function r0(e={}){return t=>new rZ(t,e)}let r1=Symbol.for("@libp2p/content-routing"),r2=Symbol.for("@libp2p/peer-routing"),r8=function(e,t){try{if("string"==typeof e&&e.length>0)return function(e){if((e=String(e)).length>100)throw Error("Value exceeds the maximum length of 100 characters.");let t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;let r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw Error(`The unit ${n} was matched, but no matching case exists.`)}}(e);if("number"==typeof e&&isFinite(e))return t?.long?function(e){let t=Math.abs(e);return t>=864e5?r6(e,t,864e5,"day"):t>=36e5?r6(e,t,36e5,"hour"):t>=6e4?r6(e,t,6e4,"minute"):t>=1e3?r6(e,t,1e3,"second"):`${e} ms`}(e):function(e){let t=Math.abs(e);return t>=864e5?`${Math.round(e/864e5)}d`:t>=36e5?`${Math.round(e/36e5)}h`:t>=6e4?`${Math.round(e/6e4)}m`:t>=1e3?`${Math.round(e/1e3)}s`:`${e}ms`}(e);throw Error("Value is not a string or number.")}catch(t){throw Error("object"==typeof t&&null!==t&&"message"in t?`${t.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.")}};function r6(e,t,r,n){return`${Math.round(e/r)} ${n}${t>=1.5*r?"s":""}`}let r4=function(){try{return localStorage}catch(e){}}(),r3=function(e){function t(e){let n,i,s;let o=null;function a(...e){if(!a.enabled)return;let r=Number(new Date),i=r-(n||r);a.diff=i,a.prev=n,a.curr=r,n=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,n)=>{if("%%"===r)return"%";s++;let i=t.formatters[n];if("function"==typeof i){let t=e[s];r=i.call(a,t),e.splice(s,1),s--}return r}),t.formatArgs.call(a,e),(a.log||t.log).apply(a,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){let n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack??e.message:e},t.disable=function(){let e=[...t.names.map(n),...t.skips.map(n).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];let n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.substr(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){let r,n;if("*"===e[e.length-1])return!0;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r8,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return t.colors[Math.abs(r)%t.colors.length]},t.setupFormatters(t.formatters),t.enable(t.load()),t}({formatArgs:function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+r8(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),e.splice(n,0,t)},save:function(e){try{e?r4?.setItem("debug",e):r4?.removeItem("debug")}catch(e){}},load:function(){let e;try{e=r4?.getItem("debug")}catch(e){}return!e&&void 0!==globalThis.process&&"env"in globalThis.process&&(e=globalThis.process.env.DEBUG),e},useColors:function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||("undefined"==typeof navigator||navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)==null)&&("undefined"!=typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(e){e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:r4,log:console.debug??console.log??(()=>{})});function r5(e){let t=function(e){let t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return r3.enabled(`${e}:trace`)&&null!=r3.names.map(e=>e.toString()).find(e=>e.includes(":trace"))&&(t=r3(`${e}:trace`)),Object.assign(r3(e),{error:r3(`${e}:error`),trace:t})}function r7(e){if(null!=e&&0!==(e=e.trim()).length)return e}r3.formatters.b=e=>null==e?"undefined":ey.baseEncode(e),r3.formatters.t=e=>null==e?"undefined":es.baseEncode(e),r3.formatters.m=e=>null==e?"undefined":ew.baseEncode(e),r3.formatters.p=e=>null==e?"undefined":e.toString(),r3.formatters.c=e=>null==e?"undefined":e.toString(),r3.formatters.k=e=>null==e?"undefined":e.toString(),r3.formatters.a=e=>null==e?"undefined":e.toString(),r3.formatters.e=e=>null==e?"undefined":r7(e.stack)??r7(e.message)??e.toString();var r9=r(6013),ne=r(79271),nt=r(68279);let[nr,nn]=ne.Ay.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ni=new Uint32Array(80),ns=new Uint32Array(80);class no extends r9.ol{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:l,El:u,Fh:h,Fl:c,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,l,u,h,c,d,f,p,g]}set(e,t,r,n,i,s,o,a,l,u,h,c,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|l,this.El=0|u,this.Fh=0|h,this.Fl=0|c,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)ni[r]=e.getUint32(t),ns[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|ni[e-15],r=0|ns[e-15],n=ne.Ay.rotrSH(t,r,1)^ne.Ay.rotrSH(t,r,8)^ne.Ay.shrSH(t,r,7),i=ne.Ay.rotrSL(t,r,1)^ne.Ay.rotrSL(t,r,8)^ne.Ay.shrSL(t,r,7),s=0|ni[e-2],o=0|ns[e-2],a=ne.Ay.rotrSH(s,o,19)^ne.Ay.rotrBH(s,o,61)^ne.Ay.shrSH(s,o,6),l=ne.Ay.rotrSL(s,o,19)^ne.Ay.rotrBL(s,o,61)^ne.Ay.shrSL(s,o,6),u=ne.Ay.add4L(i,l,ns[e-7],ns[e-16]),h=ne.Ay.add4H(u,n,a,ni[e-7],ni[e-16]);ni[e]=0|h,ns[e]=0|u}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:l,Dl:u,Eh:h,El:c,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:m}=this;for(let e=0;e<80;e++){let t=ne.Ay.rotrSH(h,c,14)^ne.Ay.rotrSH(h,c,18)^ne.Ay.rotrBH(h,c,41),w=ne.Ay.rotrSL(h,c,14)^ne.Ay.rotrSL(h,c,18)^ne.Ay.rotrBL(h,c,41),b=h&d^~h&p,v=c&f^~c&g,E=ne.Ay.add5L(m,w,v,nn[e],ns[e]),S=ne.Ay.add5H(E,y,t,b,nr[e],ni[e]),k=0|E,A=ne.Ay.rotrSH(r,n,28)^ne.Ay.rotrBH(r,n,34)^ne.Ay.rotrBH(r,n,39),x=ne.Ay.rotrSL(r,n,28)^ne.Ay.rotrBL(r,n,34)^ne.Ay.rotrBL(r,n,39),I=r&i^r&o^i&o,B=n&s^n&a^s&a;y=0|p,m=0|g,p=0|d,g=0|f,d=0|h,f=0|c,({h:h,l:c}=ne.Ay.add(0|l,0|u,0|S,0|k)),l=0|o,u=0|a,o=0|i,a=0|s,i=0|r,s=0|n;let C=ne.Ay.add3L(k,x,B);r=ne.Ay.add3H(C,S,A,I),n=0|C}({h:r,l:n}=ne.Ay.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=ne.Ay.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=ne.Ay.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:l,l:u}=ne.Ay.add(0|this.Dh,0|this.Dl,0|l,0|u)),({h:h,l:c}=ne.Ay.add(0|this.Eh,0|this.El,0|h,0|c)),({h:d,l:f}=ne.Ay.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=ne.Ay.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:m}=ne.Ay.add(0|this.Hh,0|this.Hl,0|y,0|m)),this.set(r,n,i,s,o,a,l,u,h,c,d,f,p,g,y,m)}roundClean(){ni.fill(0),ns.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let na=(0,nt.ld)(()=>new no);var nl=r(38293);let nu=BigInt(0),nh=BigInt(1),nc=BigInt(2),nd=BigInt(3),nf=BigInt(4),np=BigInt(5),ng=BigInt(8);function ny(e,t){let r=e%t;return r>=nu?r:t+r}function nm(e,t,r){let n=e;for(;t-- >nu;)n*=n,n%=r;return n}function nw(e,t){if(e===nu||t<=nu)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=ny(e,t),n=t,i=nu,s=nh,o=nh,a=nu;for(;r!==nu;){let e=n/r,t=n%r,l=i-o*e,u=s-a*e;n=r,r=t,i=o,s=a,o=l,a=u}if(n!==nh)throw Error("invert: does not exist");return ny(i,t)}BigInt(9),BigInt(16);let nb=(e,t)=>(ny(e,t)&nh)===nh,nv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nE(e,t){let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function nS(e,t,r=!1,n={}){if(e<=nu)throw Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:i,nByteLength:s}=nE(e,t);if(s>2048)throw Error("Field lengths over 2048 bytes are not supported");let o=function(e){if(e%nf===nd){let t=(e+nh)/nf;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}if(e%ng===np){let t=(e-np)/ng;return function(e,r){let n=e.mul(r,nc),i=e.pow(n,t),s=e.mul(r,i),o=e.mul(e.mul(s,nc),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw Error("Cannot find square root");return a}}return function(e){let t,r,n;let i=(e-nh)/nc;for(t=e-nh,r=0;t%nc===nu;t/=nc,r++);for(n=nc;n<e&&function(e,t,r){if(r<=nu||t<nu)throw Error("Expected power/modulo > 0");if(r===nh)return nu;let n=nh;for(;t>nu;)t&nh&&(n=n*e%r),e=e*e%r,t>>=nh;return n}(n,i,e)!==e-nh;n++);if(1===r){let t=(e+nh)/nf;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let s=(t+nh)/nc;return function(e,o){if(e.pow(o,i)===e.neg(e.ONE))throw Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,n),t),u=e.pow(o,s),h=e.pow(o,t);for(;!e.eql(h,e.ONE);){if(e.eql(h,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(h);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(l,nh<<BigInt(a-t-1));l=e.sqr(r),u=e.mul(u,r),h=e.mul(h,l),a=t}return u}}(e)}(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:(0,nl.OG)(i),ZERO:nu,ONE:nh,create:t=>ny(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error(`Invalid field element: expected bigint, got ${typeof t}`);return nu<=t&&t<e},is0:e=>e===nu,isOdd:e=>(e&nh)===nh,neg:t=>ny(-t,e),eql:(e,t)=>e===t,sqr:t=>ny(t*t,e),add:(t,r)=>ny(t+r,e),sub:(t,r)=>ny(t-r,e),mul:(t,r)=>ny(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<nu)throw Error("Expected power > 0");if(r===nu)return e.ONE;if(r===nh)return t;let n=e.ONE,i=t;for(;r>nu;)r&nh&&(n=e.mul(n,i)),i=e.sqr(i),r>>=nh;return n})(a,e,t),div:(t,r)=>ny(t*nw(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>nw(t,e),sqrt:n.sqrt||(e=>o(a,e)),invertBatch:e=>(function(e,t){let r=Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r})(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?(0,nl.z)(e,s):(0,nl.lq)(e,s),fromBytes:e=>{if(e.length!==s)throw Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return r?(0,nl.lX)(e):(0,nl.Ph)(e)}});return Object.freeze(a)}function nk(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function nA(e){let t=nk(e);return t+Math.ceil(t/2)}let nx=BigInt(0),nI=BigInt(1),nB=new WeakMap,nC=new WeakMap;function nN(e,t){let r=(e,t)=>{let r=t.negate();return e?r:t},n=e=>{if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error(`Wrong window size=${e}, should be [1..${t}]`)},i=e=>(n(e),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,i=t;for(;r>nx;)r&nI&&(n=n.add(i)),i=i.double(),r>>=nI;return n},precomputeWindow(e,t){let{windows:r,windowSize:n}=i(t),s=[],o=e,a=o;for(let e=0;e<r;e++){a=o,s.push(a);for(let e=1;e<n;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,n,s){let{windows:o,windowSize:a}=i(t),l=e.ZERO,u=e.BASE,h=BigInt(2**t-1),c=2**t,d=BigInt(t);for(let e=0;e<o;e++){let t=e*a,i=Number(s&h);s>>=d,i>a&&(i-=c,s+=nI);let o=t+Math.abs(i)-1,f=e%2!=0,p=i<0;0===i?u=u.add(r(f,n[t])):l=l.add(r(p,n[o]))}return{p:l,f:u}},wNAFCached(e,t,r){let n=nC.get(e)||1,i=nB.get(e);return i||(i=this.precomputeWindow(e,n),1!==n&&nB.set(e,r(i))),this.wNAF(n,i,t)},setWindowSize(e,t){n(t),nC.set(e,t),nB.delete(e)}}}function nT(e,t,r,n){if(!Array.isArray(r)||!Array.isArray(n)||n.length!==r.length)throw Error("arrays of points and scalars must have equal length");n.forEach((e,r)=>{if(!t.isValid(e))throw Error(`wrong scalar at index ${r}`)}),r.forEach((t,r)=>{if(!(t instanceof e))throw Error(`wrong point at index ${r}`)});let i=(0,nl.dJ)(BigInt(r.length)),s=i>12?i-3:i>4?i-2:i?2:1,o=(1<<s)-1,a=Array(o+1).fill(e.ZERO),l=Math.floor((t.BITS-1)/s)*s,u=e.ZERO;for(let t=l;t>=0;t-=s){a.fill(e.ZERO);for(let e=0;e<n.length;e++){let i=Number(n[e]>>BigInt(t)&BigInt(o));a[i]=a[i].add(r[e])}let i=e.ZERO;for(let t=a.length-1,r=e.ZERO;t>0;t--)r=r.add(a[t]),i=i.add(r);if(u=u.add(i),0!==t)for(let e=0;e<s;e++)u=u.double()}return u}function n_(e){return!function(e){let t=nv.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});(0,nl.Q5)(e,t)}(e.Fp),(0,nl.Q5)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nE(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}let nL=BigInt(0),nR=BigInt(1),nO=BigInt(2),nP=BigInt(8),nU={zip215:!0},nD=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),nF=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),n$=BigInt(0),nM=BigInt(1),nz=BigInt(2);BigInt(3);let nH=BigInt(5),nV=BigInt(8);function nq(e,t){let r=ny(t*t*t,nD),n=function(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=e*e%nD*e%nD,o=nm(s,nz,nD)*s%nD,a=nm(o,nM,nD)*e%nD,l=nm(a,nH,nD)*a%nD,u=nm(l,t,nD)*l%nD,h=nm(u,r,nD)*u%nD,c=nm(h,n,nD)*h%nD,d=nm(c,i,nD)*c%nD,f=nm(d,i,nD)*c%nD,p=nm(f,t,nD)*l%nD;return{pow_p_5_8:nm(p,nz,nD)*e%nD,b2:s}}(e*ny(r*r*t,nD)).pow_p_5_8,i=ny(e*r*n,nD),s=ny(t*i*i,nD),o=i,a=ny(i*nF,nD),l=s===e,u=s===ny(-e,nD),h=s===ny(-e*nF,nD);return l&&(i=o),(u||h)&&(i=a),nb(i,nD)&&(i=ny(-i,nD)),{isValid:l||u,value:i}}let nj=nS(nD,void 0,!0),nG=function(e){let t=function(e){let t=n_(e);return nl.Q5(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:r,n:n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:l}=t,u=nO<<BigInt(8*a)-nR,h=r.create,c=nS(t.n,t.nBitLength),d=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(e*r.inv(t))}}catch(e){return{isValid:!1,value:nL}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,r)=>{if((0,nl.e8)("phflag",r),t.length||r)throw Error("Contexts/pre-hash are not supported");return e});function g(e,t){nl.aK("coordinate "+e,t,nL,u)}function y(e){if(!(e instanceof b))throw Error("ExtendedPoint expected")}let m=(0,nl.x)((e,t)=>{let{ex:n,ey:i,ez:s}=e,o=e.is0();null==t&&(t=o?nP:r.inv(s));let a=h(n*t),l=h(i*t),u=h(s*t);if(o)return{x:nL,y:nR};if(u!==nR)throw Error("invZ was invalid");return{x:a,y:l}}),w=(0,nl.x)(e=>{let{a:r,d:n}=t;if(e.is0())throw Error("bad point: ZERO");let{ex:i,ey:s,ez:o,et:a}=e,l=h(i*i),u=h(s*s),c=h(o*o),d=h(c*c),f=h(l*r);if(h(c*h(f+u))!==h(d+h(n*h(l*u))))throw Error("bad point: equation left != right (1)");if(h(i*s)!==h(o*a))throw Error("bad point: equation left != right (2)");return!0});class b{constructor(e,t,r,n){this.ex=e,this.ey=t,this.ez=r,this.et=n,g("x",e),g("y",t),g("z",r),g("t",n),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof b)throw Error("extended point not allowed");let{x:t,y:r}=e||{};return g("x",t),g("y",r),new b(t,r,nR,h(t*r))}static normalizeZ(e){let t=r.invertBatch(e.map(e=>e.ez));return e.map((e,r)=>e.toAffine(t[r])).map(b.fromAffine)}static msm(e,t){return nT(b,c,e,t)}_setWindowSize(e){S.setWindowSize(this,e)}assertValidity(){w(this)}equals(e){y(e);let{ex:t,ey:r,ez:n}=this,{ex:i,ey:s,ez:o}=e,a=h(t*o),l=h(i*n),u=h(r*o),c=h(s*n);return a===l&&u===c}is0(){return this.equals(b.ZERO)}negate(){return new b(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){let{a:e}=t,{ex:r,ey:n,ez:i}=this,s=h(r*r),o=h(n*n),a=h(nO*h(i*i)),l=h(e*s),u=r+n,c=h(h(u*u)-s-o),d=l+o,f=d-a,p=l-o,g=h(c*f),y=h(d*p),m=h(c*p);return new b(g,y,h(f*d),m)}add(e){y(e);let{a:r,d:n}=t,{ex:i,ey:s,ez:o,et:a}=this,{ex:l,ey:u,ez:c,et:d}=e;if(r===BigInt(-1)){let e=h((s-i)*(u+l)),t=h((s+i)*(u-l)),r=h(t-e);if(r===nL)return this.double();let n=h(o*nO*d),f=h(a*nO*c),p=f+n,g=t+e,y=f-n,m=h(p*r),w=h(g*y),v=h(p*y);return new b(m,w,h(r*g),v)}let f=h(i*l),p=h(s*u),g=h(a*n*d),m=h(o*c),w=h((i+s)*(l+u)-f-p),v=m-g,E=m+g,S=h(p-r*f),k=h(w*v),A=h(E*S),x=h(w*S);return new b(k,A,h(v*E),x)}subtract(e){return this.add(e.negate())}wNAF(e){return S.wNAFCached(this,e,b.normalizeZ)}multiply(e){nl.aK("scalar",e,nR,n);let{p:t,f:r}=this.wNAF(e);return b.normalizeZ([t,r])[0]}multiplyUnsafe(e){return(nl.aK("scalar",e,nL,n),e===nL)?E:this.equals(E)||e===nR?this:this.equals(v)?this.wNAF(e).p:S.unsafeLadder(this,e)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return S.unsafeLadder(this,n).is0()}toAffine(e){return m(this,e)}clearCofactor(){let{h:e}=t;return e===nR?this:this.multiplyUnsafe(e)}static fromHex(e,n=!1){let{d:i,a:s}=t,o=r.BYTES;e=(0,nl.qj)("pointHex",e,o),(0,nl.e8)("zip215",n);let a=e.slice(),l=e[o-1];a[o-1]=-129&l;let c=nl.lX(a),f=n?u:r.ORDER;nl.aK("pointHex.y",c,nL,f);let p=h(c*c),{isValid:g,value:y}=d(h(p-nR),h(i*p-s));if(!g)throw Error("Point.fromHex: invalid y coordinate");let m=(y&nR)===nR,w=(128&l)!=0;if(!n&&y===nL&&w)throw Error("Point.fromHex: x=0 and x_0=1");return w!==m&&(y=h(-y)),b.fromAffine({x:y,y:c})}static fromPrivateKey(e){return A(e).point}toRawBytes(){let{x:e,y:t}=this.toAffine(),n=nl.z(t,r.BYTES);return n[n.length-1]|=e&nR?128:0,n}toHex(){return nl.My(this.toRawBytes())}}b.BASE=new b(t.Gx,t.Gy,nR,h(t.Gx*t.Gy)),b.ZERO=new b(nL,nR,nR,nL);let{BASE:v,ZERO:E}=b,S=nN(b,8*a);function k(e){return ny(nl.lX(e),n)}function A(e){e=(0,nl.qj)("private key",e,a);let t=(0,nl.qj)("hashed private key",s(e),2*a),r=f(t.slice(0,a)),n=t.slice(a,2*a),i=k(r),o=v.multiply(i),l=o.toRawBytes();return{head:r,prefix:n,scalar:i,point:o,pointBytes:l}}function x(e=new Uint8Array,...t){return k(s(p(nl.Id(...t),(0,nl.qj)("context",e),!!i)))}return v._setWindowSize(8),{CURVE:t,getPublicKey:function(e){return A(e).pointBytes},sign:function(e,t,s={}){e=(0,nl.qj)("message",e),i&&(e=i(e));let{prefix:o,scalar:l,pointBytes:u}=A(t),h=x(s.context,o,e),c=v.multiply(h).toRawBytes(),d=ny(h+x(s.context,c,u,e)*l,n);nl.aK("signature.s",d,nL,n);let f=nl.Id(c,nl.z(d,r.BYTES));return(0,nl.qj)("result",f,2*a)},verify:function(e,t,n,s=nU){let o,a,l;let{context:u,zip215:h}=s,c=r.BYTES;e=(0,nl.qj)("signature",e,2*c),t=(0,nl.qj)("message",t),void 0!==h&&(0,nl.e8)("zip215",h),i&&(t=i(t));let d=nl.lX(e.slice(c,2*c));try{o=b.fromHex(n,h),a=b.fromHex(e.slice(0,c),h),l=v.multiplyUnsafe(d)}catch(e){return!1}if(!h&&o.isSmallOrder())return!1;let f=x(u,a.toRawBytes(),o.toRawBytes(),t);return a.add(o.multiplyUnsafe(f)).subtract(l).clearCofactor().equals(b.ZERO)},ExtendedPoint:b,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute:(e=8,t=b.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}}({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:nj,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:nV,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:na,randomBytes:nt.po,adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e},uvRatio:nq});function nW(e){if(!(e instanceof nZ))throw Error("RistrettoPoint expected")}let nK=e=>nq(nM,e),nY=e=>nG.CURVE.Fp.create(null&bytesToNumberLE(e));function nJ(e){let{d:t}=nG.CURVE,r=nG.CURVE.Fp.ORDER,n=nG.CURVE.Fp.create,i=n(null*e*e),s=n((i+nM)*null),o=BigInt(-1),a=n((o-t*i)*n(i+t)),{isValid:l,value:u}=nq(s,a),h=n(u*e);isNegativeLE(h,r)||(h=n(-h)),l||(u=h),l||(o=i);let c=n(o*(i-nM)*null-a),d=u*u,f=n((u+u)*a),p=n(null*c),g=n(nM-d),y=n(nM+d);return new nG.ExtendedPoint(n(f*y),n(g*p),n(p*y),n(f*g))}class nZ{constructor(e){this.ep=e}static fromAffine(e){return new nZ(nG.ExtendedPoint.fromAffine(e))}static hashToCurve(e){let t=nJ(nY((e=ensureBytes("ristrettoHash",e,64)).slice(0,32))),r=nJ(nY(e.slice(32,64)));return new nZ(t.add(r))}static fromHex(e){e=ensureBytes("ristrettoHex",e,32);let{a:t,d:r}=nG.CURVE,n=nG.CURVE.Fp.ORDER,i=nG.CURVE.Fp.create,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",o=nY(e);if(!equalBytes(numberToBytesLE(o,32),e)||isNegativeLE(o,n))throw Error(s);let a=i(o*o),l=i(nM+t*a),u=i(nM-t*a),h=i(l*l),c=i(u*u),d=i(t*r*h-c),{isValid:f,value:p}=nK(i(d*c)),g=i(p*u),y=i(p*g*d),m=i((o+o)*g);isNegativeLE(m,n)&&(m=i(-m));let w=i(l*y),b=i(m*w);if(!f||isNegativeLE(b,n)||w===n$)throw Error(s);return new nZ(new nG.ExtendedPoint(m,w,nM,b))}toRawBytes(){let e,{ex:t,ey:r,ez:n,et:i}=this.ep,s=nG.CURVE.Fp.ORDER,o=nG.CURVE.Fp.create,a=o(o(n+r)*o(n-r)),l=o(t*r),u=o(l*l),{value:h}=nK(o(a*u)),c=o(h*a),d=o(h*l),f=o(c*d*i);if(isNegativeLE(i*f,s)){let n=o(null*r),i=o(null*t);t=n,r=i,e=o(null*c)}else e=d;isNegativeLE(t*f,s)&&(r=o(-r));let p=o((n-r)*e);return isNegativeLE(p,s)&&(p=o(-p)),numberToBytesLE(p,32)}toHex(){return bytesToHex(this.toRawBytes())}toString(){return this.toHex()}equals(e){nW(e);let{ex:t,ey:r}=this.ep,{ex:n,ey:i}=e.ep,s=nG.CURVE.Fp.create,o=s(t*i)===s(r*n),a=s(r*i)===s(t*n);return o||a}add(e){return nW(e),new nZ(this.ep.add(e.ep))}subtract(e){return nW(e),new nZ(this.ep.subtract(e.ep))}multiply(e){return new nZ(this.ep.multiply(e))}multiplyUnsafe(e){return new nZ(this.ep.multiplyUnsafe(e))}double(){return new nZ(this.ep.double())}negate(){return new nZ(this.ep.negate())}}class nX{type="Ed25519";raw;constructor(e){this.raw=n0(e,32)}toMultihash(){return ez.digest(ot(this))}toCID(){return eJ.createV1(114,this.toMultihash())}toString(){return ey.encode(this.toMultihash().bytes).substring(1)}equals(e){return!!(null!=e&&e.raw instanceof Uint8Array)&&e9(this.raw,e.raw)}verify(e,t){var r;return r=this.raw,nG.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}}function nQ(e){return new nX(e=n0(e,32))}function n0(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new td(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}let n1=new Float32Array([-0]),n2=new Uint8Array(n1.buffer);function n8(e,t,r){n1[0]=e,t[r]=n2[0],t[r+1]=n2[1],t[r+2]=n2[2],t[r+3]=n2[3]}let n6=new Float64Array([-0]),n4=new Uint8Array(n6.buffer);function n3(e,t,r){n6[0]=e,t[r]=n4[0],t[r+1]=n4[1],t[r+2]=n4[2],t[r+3]=n4[3],t[r+4]=n4[4],t[r+5]=n4[5],t[r+6]=n4[6],t[r+7]=n4[7]}let n5=BigInt(Number.MAX_SAFE_INTEGER),n7=BigInt(Number.MIN_SAFE_INTEGER);class n9{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+0x100000000*t)}return this.lo+0x100000000*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(0n===e)return ie;if(e<n5&&e>n7)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let r=e>>32n,n=e-(r<<32n);return t&&(r=0n|~r,n=0n|~n,++n>it&&(n=0n,++r>it&&(r=0n))),new n9(Number(n),Number(r))}static fromNumber(e){if(0===e)return ie;let t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new n9(r,n)}static from(e){return"number"==typeof e?n9.fromNumber(e):"bigint"==typeof e?n9.fromBigInt(e):"string"==typeof e?n9.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new n9(e.low>>>0,e.high>>>0):ie}}let ie=new n9(0,0);ie.toBigInt=function(){return 0n},ie.zzEncode=ie.zzDecode=function(){return this},ie.length=function(){return 1};let it=4294967296n;function ir(e,t,r){let n,i;let s=r;for(let s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(s+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}function ii(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function is(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class io{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=0xffffffff;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ii(this,10);return e}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)|0}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw ii(this,4);return is(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ii(this,4);return 0|is(this.buf,this.pos+=4)}float(){var e,t;if(this.pos+4>this.len)throw ii(this,4);let r=(e=this.buf,t=this.pos,n2[0]=e[t],n2[1]=e[t+1],n2[2]=e[t+2],n2[3]=e[t+3],n1[0]);return this.pos+=4,r}double(){var e,t;if(this.pos+8>this.len)throw ii(this,4);let r=(e=this.buf,t=this.pos,n4[0]=e[t],n4[1]=e[t+1],n4[2]=e[t+2],n4[3]=e[t+3],n4[4]=e[t+4],n4[5]=e[t+5],n4[6]=e[t+6],n4[7]=e[t+7],n6[0]);return this.pos+=8,r}bytes(){let e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw ii(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){let e=this.bytes();return function(e,t,r){let n,i;if(r-t<1)return"";let s=[],o=0;for(;t<r;)(i=e[t++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((n??(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=n?(o>0&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))}(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw ii(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ii(this);while((128&this.buf[this.pos++])!=0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new n9(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw ii(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw ii(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ii(this,8);return new n9(is(this.buf,this.pos+=4),is(this.buf,this.pos+=4))}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=rd(this.buf,this.pos);return this.pos+=rh(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function ia(e,t,r){let n=new io(e instanceof Uint8Array?e:e.subarray());return t.decode(n,void 0,r)}class il{fn;len;next;val;constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}}function iu(){}class ih{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}let ic=function(e){let t;let r=(void 0)??8192,n=r>>>1,i=r;return function(e){if(e<1||e>n)return e8(e);i+e>r&&(t=e8(r),i=0);let s=t.subarray(i,i+=e);return(7&i)!=0&&(i=(7|i)+1),s}}();class id{len;head;tail;states;constructor(){this.len=0,this.head=new il(iu,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new il(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new iy((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this}int32(e){return e<0?this._push(im,10,n9.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=n9.fromBigInt(e);return this._push(im,t.length(),t)}uint64Number(e){return this._push(rc,rh(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=n9.fromBigInt(e).zzEncode();return this._push(im,t.length(),t)}sint64Number(e){let t=n9.fromNumber(e).zzEncode();return this._push(im,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(ip,1,e?1:0)}fixed32(e){return this._push(iw,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=n9.fromBigInt(e);return this._push(iw,4,t.lo)._push(iw,4,t.hi)}fixed64Number(e){let t=n9.fromNumber(e);return this._push(iw,4,t.lo)._push(iw,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(n8,4,e)}double(e){return this._push(n3,8,e)}bytes(e){let t=e.length>>>0;return 0===t?this._push(ip,1,0):this.uint32(t)._push(ib,t,e)}string(e){let t=function(e){let t=0,r=0;for(let n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t}(e);return 0!==t?this.uint32(t)._push(ir,t,e):this._push(ip,1,0)}fork(){return this.states=new ih(this),this.head=this.tail=new il(iu,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new il(iu,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){var e;let t=this.head.next,r=(e=this.len,null!=globalThis.Buffer?e8(e):ic(e)),n=0;for(;null!=t;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}}function ip(e,t,r){t[r]=255&e}function ig(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}class iy extends il{next;constructor(e,t){super(ig,e,t),this.next=void 0}}function im(e,t,r){for(;0!==e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function iw(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function ib(e,t,r){t.set(e,r)}function iv(e,t,r){t.set(e,r)}function iE(e,t,r){e.length<40?ir(e,t,r):null!=t.utf8Write?t.utf8Write(e,r):t.set(e7(e),r)}function iS(e,t){let r=new id;return t.encode(e,r,{lengthDelimited:!1}),r.finish()}function ik(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function iA(e){function t(t){if(null==e[t.toString()])throw Error("Invalid enum value");return e[t]}return ik("enum",s.VARINT,function(e,r){let n=t(e);r.int32(n)},function(e){return t(e.int32())})}function ix(e,t){return ik("message",s.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(id.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(iv,t,e),this},id.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(iE,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(s||(s={})),function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1"}(o||(o={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1"}(a||(a={})),(o||(o={})).codec=()=>iA(a),function(e){let t;e.codec=()=>(null==t&&(t=ix((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),o.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=o.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>iS(t,e.codec()),e.decode=(t,r)=>ia(t,e.codec(),r)}(l||(l={})),function(e){let t;e.codec=()=>(null==t&&(t=ix((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),o.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=o.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>iS(t,e.codec()),e.decode=(t,r)=>ia(t,e.codec(),r)}(u||(u={}));var iI=r(78226),iB=r(50152);function iC(e,t){let r=0;if(1===e.length)return e[0];for(let n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function iN(e,t,r=-1){let n=e,i=0,s=Math.pow(2,t);for(let o=1;o<8;o++){if(e<s){let e;if(r<0)e=new ArrayBuffer(o),i=o;else{if(r<o)return new ArrayBuffer(0);e=new ArrayBuffer(r),i=r}let s=new Uint8Array(e);for(let e=o-1;e>=0;e--){let r=Math.pow(2,e*t);s[i-e-1]=Math.floor(n/r),n-=s[i-e-1]*r}return e}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function iT(...e){let t=0,r=0;for(let r of e)t+=r.length;let n=new Uint8Array(new ArrayBuffer(t));for(let t of e)n.set(t,r),r+=t.length;return n}function i_(){let e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let t=255===e[0]&&128&e[1],r=0===e[0]&&(128&e[1])==0;(t||r)&&this.warnings.push("Needlessly long format")}let t=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let e=0;e<this.valueHex.byteLength;e++)t[e]=0;t[0]=128&e[0];let r=iC(t,8),n=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let t=0;t<this.valueHex.byteLength;t++)n[t]=e[t];return n[0]&=127,iC(n,8)-r}function iL(e,t){let r=e.toString(10);if(t<r.length)return"";let n=t-r.length,i=Array(n);for(let e=0;e<n;e++)i[e]="0";return i.join("").concat(r)}function iR(){if("undefined"==typeof BigInt)throw Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function iO(e){let t=0,r=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let n=new Uint8Array(t);for(let t=0;t<e.length;t++){let i=e[t];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function iP(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class iU{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return iO(this.items)}}let iD=[new Uint8Array([1])],iF="0123456789",i$=new ArrayBuffer(0),iM=new Uint8Array(0),iz="EndOfContent",iH="OCTET STRING",iV="BIT STRING";function iq(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);let r=e[0]||{};this.isHexOnly=null!==(t=r.isHexOnly)&&void 0!==t&&t,this.valueHexView=r.valueHex?iB._H.toUint8Array(r.valueHex):iM}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,r){let n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!iP(this,n,t,r))return -1;let i=t+r;return(this.valueHexView=n.subarray(t,i),this.valueHexView.length)?(this.blockLength=r,i):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",i$)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:iB.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class ij{constructor({blockLength:e=0,error:t="",warnings:r=[],valueBeforeDecode:n=iM}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=iB._H.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:iB.U$.ToHex(this.valueBeforeDecodeView)}}}ij.NAME="baseBlock";class iG extends ij{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}iG.NAME="valueBlock";class iW extends iq(ij){constructor({idBlock:e={}}={}){var t,r,n,i;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?iB._H.toUint8Array(e.valueHex):iM,this.tagClass=null!==(r=e.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(n=e.tagNumber)&&void 0!==n?n:-1,this.isConstructed=null!==(i=e.isConstructed)&&void 0!==i&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",i$}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){let r=iN(this.tagNumber,7),n=new Uint8Array(r),i=r.byteLength,s=new Uint8Array(i+1);if(s[0]=31|t,!e){for(let e=0;e<i-1;e++)s[e+1]=128|n[e];s[i]=n[i-1]}return s.buffer}let r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){let e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){let n=iB._H.toUint8Array(e);if(!iP(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(32&i[0])==32,this.isHexOnly=!1;let s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&i[e];){if(t[e-1]=127&i[e],++e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){let e=new Uint8Array(r+=255);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&i[e];let n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t[r];(t=this.valueHexView=new Uint8Array(e)).set(n),this.blockLength<=9?this.tagNumber=iC(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}iW.NAME="identificationBlock";class iK extends ij{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(r=e.longFormUsed)&&void 0!==r&&r,this.length=null!==(n=e.length)&&void 0!==n?n:0}fromBER(e,t,r){let n=iB._H.toUint8Array(e);if(!iP(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let o=t+1,a=n.subarray(o,o+s);return 0===a[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=iC(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=128),t;if(this.longFormUsed){let n=iN(this.length,8);if(n.byteLength>127)return this.error="Too big length",i$;if(t=new ArrayBuffer(n.byteLength+1),e)return t;let i=new Uint8Array(n);(r=new Uint8Array(t))[0]=128|n.byteLength;for(let e=0;e<n.byteLength;e++)r[e+1]=i[e];return t}return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}iK.NAME="lengthBlock";let iY={};class iJ extends ij{constructor({name:e="",optional:t=!1,primitiveSchema:r,...n}={},i){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new iW(n),this.lenBlock=new iK(n),this.valueBlock=i?new i(n):new iG(n)}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}toBER(e,t){let r=t||new iU;t||function e(t){if(t instanceof iY.Constructed)for(let r of t.valueBlock.value)e(r)&&(t.lenBlock.isIndefiniteForm=!0);return!!t.lenBlock.isIndefiniteForm}(this);let n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{let t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;let n=this.lenBlock.toBER(e);r.write(n),r.write(t)}return t?i$:r.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():iB.U$.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${iB.U$.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){return this===e||e instanceof this.constructor&&function(e,t){if(e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}(this.toBER(),e.toBER())}}iJ.NAME="BaseBlock";class iZ extends iJ{constructor({value:e="",...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}iZ.NAME="BaseStringBlock";class iX extends iq(iG){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}iX.NAME="PrimitiveValueBlock";class iQ extends iJ{constructor(e={}){super(e,iX),this.idBlock.isConstructed=!1}}function i0(e,t=0,r=e.length){let n=t,i=new iJ({},iG),s=new ij;if(!iP(s,e,t,r))return i.error=s.error,{offset:-1,result:i};if(!e.subarray(t,t+r).length)return i.error="Zero buffer length",{offset:-1,result:i};let o=i.idBlock.fromBER(e,t,r);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let a=iJ;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};a=iY.EndOfContent;break;case 1:a=iY.Boolean;break;case 2:a=iY.Integer;break;case 3:a=iY.BitString;break;case 4:a=iY.OctetString;break;case 5:a=iY.Null;break;case 6:a=iY.ObjectIdentifier;break;case 10:a=iY.Enumerated;break;case 12:a=iY.Utf8String;break;case 13:a=iY.RelativeObjectIdentifier;break;case 14:a=iY.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:a=iY.Sequence;break;case 17:a=iY.Set;break;case 18:a=iY.NumericString;break;case 19:a=iY.PrintableString;break;case 20:a=iY.TeletexString;break;case 21:a=iY.VideotexString;break;case 22:a=iY.IA5String;break;case 23:a=iY.UTCTime;break;case 24:a=iY.GeneralizedTime;break;case 25:a=iY.GraphicString;break;case 26:a=iY.VisibleString;break;case 27:a=iY.GeneralString;break;case 28:a=iY.UniversalString;break;case 29:a=iY.CharacterString;break;case 30:a=iY.BmpString;break;case 31:a=iY.DATE;break;case 32:a=iY.TimeOfDay;break;case 33:a=iY.DateTime;break;case 34:a=iY.Duration;break;default:{let e=i.idBlock.isConstructed?new iY.Constructed:new iY.Primitive;e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else a=i.idBlock.isConstructed?iY.Constructed:iY.Primitive;return o=(i=function(e,t){if(e instanceof t)return e;let r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(i,a)).fromBER(e,t,i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(n,n+i.blockLength),{offset:o,result:i}}iY.Primitive=iQ,iQ.NAME="PRIMITIVE";class i1 extends iG{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){var n,i;let s=iB._H.toUint8Array(e);if(!iP(this,s,t,r))return -1;if(this.valueBeforeDecodeView=s.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let o=t;for(;n=this.isIndefiniteForm,i=r,(n?1:i)>0;){let e=i0(s,o,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(o=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===iz)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===iz?this.value.pop():this.warnings.push("No EndOfContent block encoded")),o}toBER(e,t){let r=t||new iU;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?i$:r.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}}i1.NAME="ConstructedValueBlock";class i2 extends iJ{constructor(e={}){super(e,i1),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){let e=[];for(let t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));let t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join("\n")}`:`${t} :`}}iY.Constructed=i2,i2.NAME="CONSTRUCTED";class i8 extends iG{fromBER(e,t,r){return t}toBER(e){return i$}}i8.override="EndOfContentValueBlock";class i6 extends iJ{constructor(e={}){super(e,i8),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}iY.EndOfContent=i6,i6.NAME=iz;class i4 extends iJ{constructor(e={}){super(e,iG),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return(this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength)?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){let r=new ArrayBuffer(2);if(!e){let e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}iY.Null=i4,i4.NAME="NULL";class i3 extends iq(iG){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=iB._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){let n=iB._H.toUint8Array(e);return iP(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,i_.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}i3.NAME="BooleanValueBlock";class i5 extends iJ{constructor(e={}){super(e,i3),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}iY.Boolean=i5,i5.NAME="BOOLEAN";class i7 extends iq(i1){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=i1.prototype.fromBER.call(this,e,t,r)))return n;for(let e=0;e<this.value.length;e++){let t=this.value[e].constructor.NAME;if(t===iz){if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1;break}if(t!==iH)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?i1.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}i7.NAME="OctetStringValueBlock";class i9 extends iJ{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(i=r.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},i7),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){let e=i0(n,0,n.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?i2.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${iB.U$.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof i9&&e.push(t.valueBlock.valueHexView);return iB._H.concat(e)}}iY.OctetString=i9,i9.NAME=iH;class se extends iq(i1){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(-1===(n=i1.prototype.fromBER.call(this,e,t,r)))return n;for(let e of this.value){let t=e.constructor.NAME;if(t===iz){if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1;break}if(t!==iV)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}let i=iB._H.toUint8Array(e);if(!iP(this,i,t,r))return -1;let s=i.subarray(t,t+r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let e=s.subarray(1);try{if(e.byteLength){let t=i0(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+r}toBER(e,t){if(this.isConstructed)return i1.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return i$;let r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}se.NAME="BitStringValueBlock";class st extends iJ{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(i=r.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},se),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return i2.prototype.onAsciiEncoding.call(this);{let e=[];for(let t of this.valueBlock.valueHexView)e.push(t.toString(2).padStart(8,"0"));let t=e.join("");return`${this.constructor.NAME} : ${t.substring(0,t.length-this.valueBlock.unusedBits)}`}}}function sr(e){if(e>=iD.length)for(let t=iD.length;t<=e;t++){let e=new Uint8Array([0]),r=iD[t-1].slice(0);for(let t=r.length-1;t>=0;t--){let n=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=n[0]/10,r[t]=n[0]%10}e[0]>0&&(r=iT(e,r)),iD.push(r)}return iD[e]}iY.BitString=st,st.NAME=iV;class sn extends iq(iG){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=i_.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){let t=e<0?-1*e:e,r=128;for(let n=1;n<8;n++){if(t<=r){if(e<0){let e=iN(r-t,8,n),i=new Uint8Array(e);return i[0]|=128,e}let i=iN(t,8,n),s=new Uint8Array(i);if(128&s[0]){let e=i.slice(0),t=new Uint8Array(e);s=new Uint8Array(i=new ArrayBuffer(i.byteLength+1));for(let r=0;r<e.byteLength;r++)s[r+1]=t[r];s[0]=0}return i}r*=256}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){let i=this.fromBER(e,t,r);if(-1===i)return i;let s=this.valueHexView;return 0===s[0]&&(128&s[1])!=0?this.valueHexView=s.subarray(1):0!==n&&s.length<n&&(n-s.length>1&&(n=s.length+1),this.valueHexView=s.subarray(n-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(128&t[0])!=0:{let e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&(128&t[1])==0:this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){let n=super.fromBER(e,t,r);return -1===n||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e;let t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),n=0,i=this.valueHexView,s="",o=!1;for(let o=i.byteLength-1;o>=0;o--){e=i[o];for(let i=0;i<8;i++)(1&e)==1&&(n===t?(r=function(e,t){let r,n=0,i=new Uint8Array(e),s=new Uint8Array(t),o=i.slice(0),a=o.length-1,l=s.slice(0),u=l.length-1,h=0;for(let e=u;e>=0;e--,h++)!0==(r=o[a-h]-l[u-h]-n)<0?(n=1,o[a-h]=r+10):(n=0,o[a-h]=r);if(n>0)for(let e=a-u+1;e>=0;e--,h++)if((r=o[a-h]-n)<0)n=1,o[a-h]=r+10;else{n=0,o[a-h]=r;break}return o.slice()}(sr(n),r),s="-"):r=function(e,t){let r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),o=s.length-1,a=i.slice(0),l=a.length-1,u=0,h=l<o?o:l,c=0;for(let e=h;e>=0;e--,c++)u=!0==c<a.length?s[o-c]+a[l-c]+r[0]:s[o-c]+r[0],(r[0]=u/10,!0==c>=s.length)?s=iT(new Uint8Array([u%10]),s):s[o-c]=u%10;return r[0]>0&&(s=iT(r,s)),s}(r,sr(n))),n++,e>>=1}for(let e=0;e<r.length;e++)r[e]&&(o=!0),o&&(s+=iF.charAt(r[e]));return!1===o&&(s+=iF.charAt(0)),s}}sn.NAME="IntegerValueBlock",Object.defineProperty(sn.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class si extends iJ{constructor(e={}){super(e,sn),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return iR(),BigInt(this.valueBlock.toString())}static fromBigInt(e){iR();let t=BigInt(e),r=new iU,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(iB.U$.FromHex(n));if(t<0){let e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;let n=BigInt(`0x${iB.U$.ToHex(e)}`)+t,s=iB._H.toUint8Array(iB.U$.FromHex(n.toString(16)));s[0]|=128,r.write(s)}else 128&i[0]&&r.write(new Uint8Array([0])),r.write(i);return new si({valueHex:r.final()})}convertToDER(){let e=new si({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new si({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}iY.Integer=si,si.NAME="INTEGER";class ss extends si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}iY.Enumerated=ss,ss.NAME="ENUMERATED";class so extends iq(iG){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;let n=iB._H.toUint8Array(e);if(!iP(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=iC(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){iR();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=iN(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",i$;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r}toString(){let e="";if(this.isHexOnly)e=iB.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}so.NAME="sidBlock";class sa extends iG{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new so;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e){let t=[];for(let r=0;r<this.value.length;r++){let n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,i$;t.push(n)}return iO(t)}fromString(e){this.value=[];let t=0,r=0,n="",i=!1;do if(n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,i){let e=this.value[0],t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:this.value=[];return}let r=parseInt(n,10);if(isNaN(r))return;e.valueDec=r+t,i=!1}else{let e=new so;if(n>Number.MAX_SAFE_INTEGER){iR();let t=BigInt(n);e.valueBigInt=t}else if(e.valueDec=parseInt(n,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,i=!0),this.value.push(e)}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}sa.NAME="ObjectIdentifierValueBlock";class sl extends iJ{constructor(e={}){super(e,sa),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}iY.ObjectIdentifier=sl,sl.NAME="OBJECT IDENTIFIER";class su extends iq(ij){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;let n=iB._H.toUint8Array(e);if(!iP(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=iC(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=iN(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",i$;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r.buffer}toString(){return this.isHexOnly?iB.U$.ToHex(this.valueHexView):this.valueDec.toString()}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}su.NAME="relativeSidBlock";class sh extends iG{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new su;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e,t){let r=[];for(let t=0;t<this.value.length;t++){let n=this.value[t].toBER(e);if(0===n.byteLength)return this.error=this.value[t].error,i$;r.push(n)}return iO(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;let i=new su;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))break;this.value.push(i)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?e+=n=`{${n}}`:e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}sh.NAME="RelativeObjectIdentifierValueBlock";class sc extends iJ{constructor(e={}){super(e,sh),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}iY.RelativeObjectIdentifier=sc,sc.NAME="RelativeObjectIdentifier";class sd extends i2{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}iY.Sequence=sd,sd.NAME="SEQUENCE";class sf extends i2{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}iY.Set=sf,sf.NAME="SET";class sp extends iq(iG){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=""}toJSON(){return{...super.toJSON(),value:this.value}}}sp.NAME="StringValueBlock";class sg extends sp{}sg.NAME="SimpleStringValueBlock";class sy extends iZ{constructor({...e}={}){super(e,sg)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,iB._H.toUint8Array(e))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}sy.NAME="SIMPLE STRING";class sm extends sy{fromBuffer(e){this.valueBlock.valueHexView=iB._H.toUint8Array(e);try{this.valueBlock.value=iB.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=iB.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(iB.U$.FromUtf8String(e)),this.valueBlock.value=e}}sm.NAME="Utf8StringValueBlock";class sw extends sm{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}iY.Utf8String=sw,sw.NAME="UTF8String";class sb extends sy{fromBuffer(e){this.valueBlock.value=iB.U$.ToUtf16String(e),this.valueBlock.valueHexView=iB._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(iB.U$.FromUtf16String(e))}}sb.NAME="BmpStringValueBlock";class sv extends sb{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}iY.BmpString=sv,sv.NAME="BMPString";class sE extends sy{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let n=0;n<t;n++){let t=new Uint8Array(iN(e.charCodeAt(n),8));if(t.length>4)continue;let i=4-t.length;for(let e=t.length-1;e>=0;e--)r[4*n+e+i]=t[e]}this.valueBlock.value=e}}sE.NAME="UniversalStringValueBlock";class sS extends sE{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}iY.UniversalString=sS,sS.NAME="UniversalString";class sk extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}iY.NumericString=sk,sk.NAME="NumericString";class sA extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}iY.PrintableString=sA,sA.NAME="PrintableString";class sx extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}iY.TeletexString=sx,sx.NAME="TeletexString";class sI extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}iY.VideotexString=sI,sI.NAME="VideotexString";class sB extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}iY.IA5String=sB,sB.NAME="IA5String";class sC extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}iY.GraphicString=sC,sC.NAME="GraphicString";class sN extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}iY.VisibleString=sN,sN.NAME="VisibleString";class sT extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}iY.GeneralString=sT,sT.NAME="GeneralString";class s_ extends sy{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}iY.CharacterString=s_,s_.NAME="CharacterString";class sL extends sN{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,iB._H.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(null===t){this.error="Wrong input string for conversion";return}let r=parseInt(t[1],10);r>=50?this.year=1900+r:this.year=2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){let e=Array(7);return e[0]=iL(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=iL(this.month,2),e[2]=iL(this.day,2),e[3]=iL(this.hour,2),e[4]=iL(this.minute,2),e[5]=iL(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}iY.UTCTime=sL,sL.NAME="UTCTime";class sR extends sL{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,n="",i="",s=0,o=0,a=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{if(isNaN(new Number(e[e.length-1]).valueOf()))throw Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+")||-1!==n.indexOf("-"))throw Error("Wrong input string for conversion")}else{let e=1,t=n.indexOf("+"),r="";if(-1===t&&(t=n.indexOf("-"),e=-1),-1!==t){if(r=n.substring(t+1),n=n.substring(0,t),2!==r.length&&4!==r.length)throw Error("Wrong input string for conversion");let i=parseInt(r.substring(0,2),10);if(isNaN(i.valueOf()))throw Error("Wrong input string for conversion");if(o=e*i,4===r.length){if(isNaN((i=parseInt(r.substring(2,4),10)).valueOf()))throw Error("Wrong input string for conversion");a=e*i}}}let l=n.indexOf(".");if(-1===l&&(l=n.indexOf(",")),-1!==l){let e=new Number(`0${n.substring(l)}`);if(isNaN(e.valueOf()))throw Error("Wrong input string for conversion");s=e.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/ig,-1!==l)throw Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=1e3*s;this.millisecond=Math.floor(e)}break;default:throw Error("Wrong input string for conversion")}let u=t.exec(i);if(null===u)throw Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+o;break;case 5:this.minute=parseInt(u[e],10)+a;break;case 6:this.second=parseInt(u[e],10);break;default:throw Error("Wrong input string for conversion")}if(!1===r){let e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){let e=[];return e.push(iL(this.year,4)),e.push(iL(this.month,2)),e.push(iL(this.day,2)),e.push(iL(this.hour,2)),e.push(iL(this.minute,2)),e.push(iL(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(iL(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}iY.GeneralizedTime=sR,sR.NAME="GeneralizedTime";class sO extends sw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}iY.DATE=sO,sO.NAME="DATE";class sP extends sw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}iY.TimeOfDay=sP,sP.NAME="TimeOfDay";class sU extends sw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}iY.DateTime=sU,sU.NAME="DateTime";class sD extends sw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}iY.Duration=sD,sD.NAME="Duration";class sF extends sw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}iY.TIME=sF,sF.NAME="TIME";class s$ extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class sM extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}let sz={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new sM("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};async function sH(e,t,r){let n=await sz.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return sz.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r instanceof Uint8Array?r:r.subarray())}class sV{type="RSA";_key;_raw;_multihash;constructor(e,t){this._key=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=function(e){if(null==e.n||null==e.e)throw new td("JWK was missing components");let t=new sd({value:[new sd({value:[new sl({value:"1.2.840.113549.1.1.1"}),new i4]}),new st({valueHex:new sd({value:[si.fromBigInt(sj(e7(e.n,"base64url"))),si.fromBigInt(sj(e7(e.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return eJ.createV1(114,this._multihash)}toString(){return ey.encode(this.toMultihash().bytes).substring(1)}equals(e){return!!(null!=e&&e.raw instanceof Uint8Array)&&e9(this.raw,e.raw)}verify(e,t){return sH(this._key,t,e)}}function sq(e){let t=e.valueBlock.valueHexView;for(;0===t[0];)t=t.subarray(1);return ru(t,"base64url")}function sj(e){let t=[];return e.forEach(function(e){let r=e.toString(16);r.length%2>0&&(r=`0${r}`),t.push(r)}),BigInt("0x"+t.join(""))}var sG=r(89190);class sW extends nt.Vw{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,sG.tW)(e);let r=(0,nt.ZJ)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return(0,sG.t2)(this),this.iHash.update(e),this}digestInto(e){(0,sG.t2)(this),(0,sG.ee)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let sK=(e,t,r)=>new sW(e,t).update(r).digest();function sY(e){void 0!==e.lowS&&(0,nl.e8)("lowS",e.lowS),void 0!==e.prehash&&(0,nl.e8)("prehash",e.prehash)}sK.create=(e,t)=>new sW(e,t);let{Ph:sJ,aT:sZ}=nl,sX={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=sX;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let n=t.length/2,i=nl.zW(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?nl.zW(i.length/2|128):"";return`${nl.zW(e)}${s}${i}${t}`},decode(e,t){let{Err:r}=sX,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let i=t[n++],s=0;if(128&i){let e=127&i;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of o)s=s<<8|e;if(n+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=i;let o=t.subarray(n,n+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+s)}}},_int:{encode(e){let{Err:t}=sX;if(e<sQ)throw new t("integer: negative integers are not allowed");let r=nl.zW(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected assertion");return r},decode(e){let{Err:t}=sX;if(128&e[0])throw new t("Invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("Invalid signature integer: unnecessary leading zero");return sJ(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=sX,i="string"==typeof e?sZ(e):e;nl.DO(i);let{v:s,l:o}=n.decode(48,i);if(o.length)throw new t("Invalid signature: left bytes after parsing");let{v:a,l:l}=n.decode(2,s),{v:u,l:h}=n.decode(2,l);if(h.length)throw new t("Invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=sX,n=`${t.encode(2,r.encode(e.r))}${t.encode(2,r.encode(e.s))}`;return t.encode(48,n)}},sQ=BigInt(0),s0=BigInt(1),s1=(BigInt(2),BigInt(3)),s2=(BigInt(4),BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f")),s8=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),s6=BigInt(1),s4=BigInt(2),s3=(e,t)=>(e+t/s4)/t,s5=nS(s2,void 0,void 0,{sqrt:function(e){let t=BigInt(3),r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),l=e*e*e%s2,u=l*l*e%s2,h=nm(u,t,s2)*u%s2,c=nm(h,t,s2)*u%s2,d=nm(c,s4,s2)*l%s2,f=nm(d,n,s2)*d%s2,p=nm(f,i,s2)*f%s2,g=nm(p,o,s2)*p%s2,y=nm(g,a,s2)*g%s2,m=nm(y,o,s2)*p%s2,w=nm(m,t,s2)*u%s2,b=nm(w,s,s2)*f%s2,v=nm(b,r,s2)*l%s2,E=nm(v,s4,s2);if(!s5.eql(s5.sqr(E),e))throw Error("Cannot find square root");return E}}),s7=function(e,t){let r=t=>(function(e){let t=function(e){let t=n_(e);return nl.Q5(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:r,n:n}=t,i=r.BYTES+1,s=2*r.BYTES+1;function o(e){return ny(e,n)}let{ProjectivePoint:a,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=function(e){let t=function(e){let t=n_(e);nl.Q5(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:r}=t,n=nS(t.n,t.nBitLength),i=t.toBytes||((e,t,n)=>{let i=t.toAffine();return nl.Id(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),s=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function o(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),o(t.Gx)))throw Error("bad generator point: equation left != right");function a(e){let r;let{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:s,n:o}=t;if(n&&"bigint"!=typeof e){if(nl.aY(e)&&(e=nl.My(e)),"string"!=typeof e||!n.includes(e.length))throw Error("Invalid key");e=e.padStart(2*i,"0")}try{r="bigint"==typeof e?e:nl.Ph((0,nl.qj)("private key",e,i))}catch(t){throw Error(`private key must be ${i} bytes, hex or bigint, not ${typeof e}`)}return s&&(r=ny(r,o)),nl.aK("private key",r,s0,o),r}function l(e){if(!(e instanceof c))throw Error("ProjectivePoint expected")}let u=(0,nl.x)((e,t)=>{let{px:n,py:i,pz:s}=e;if(r.eql(s,r.ONE))return{x:n,y:i};let o=e.is0();null==t&&(t=o?r.ONE:r.inv(s));let a=r.mul(n,t),l=r.mul(i,t),u=r.mul(s,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(u,r.ONE))throw Error("invZ was invalid");return{x:a,y:l}}),h=(0,nl.x)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw Error("bad point: ZERO")}let{x:n,y:i}=e.toAffine();if(!r.isValid(n)||!r.isValid(i))throw Error("bad point: x or y not FE");let s=r.sqr(i),a=o(n);if(!r.eql(s,a))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class c{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required");Object.freeze(this)}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof c)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?c.ZERO:new c(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(c.fromAffine)}static fromHex(e){let t=c.fromAffine(s((0,nl.qj)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return c.BASE.multiply(a(e))}static msm(e,t){return nT(c,n,e,t)}_setWindowSize(e){f.setWindowSize(this,e)}assertValidity(){h(this)}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){l(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,u=r.eql(r.mul(t,a),r.mul(s,i)),h=r.eql(r.mul(n,a),r.mul(o,i));return u&&h}negate(){return new c(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,s1),{px:s,py:o,pz:a}=this,l=r.ZERO,u=r.ZERO,h=r.ZERO,d=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),h=r.mul(s,a),h=r.add(h,h),l=r.mul(e,h),u=r.mul(i,p),u=r.add(l,u),l=r.sub(f,u),u=r.add(f,u),u=r.mul(l,u),l=r.mul(g,l),h=r.mul(i,h),p=r.mul(e,p),g=r.sub(d,p),g=r.mul(e,g),g=r.add(g,h),h=r.add(d,d),d=r.add(h,d),d=r.add(d,p),d=r.mul(d,g),u=r.add(u,d),p=r.mul(o,a),p=r.add(p,p),d=r.mul(p,g),l=r.sub(l,d),h=r.mul(p,f),h=r.add(h,h),new c(l,u,h=r.add(h,h))}add(e){l(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:u}=e,h=r.ZERO,d=r.ZERO,f=r.ZERO,p=t.a,g=r.mul(t.b,s1),y=r.mul(n,o),m=r.mul(i,a),w=r.mul(s,u),b=r.add(n,i),v=r.add(o,a);b=r.mul(b,v),v=r.add(y,m),b=r.sub(b,v),v=r.add(n,s);let E=r.add(o,u);return v=r.mul(v,E),E=r.add(y,w),v=r.sub(v,E),E=r.add(i,s),h=r.add(a,u),E=r.mul(E,h),h=r.add(m,w),E=r.sub(E,h),f=r.mul(p,v),h=r.mul(g,w),f=r.add(h,f),h=r.sub(m,f),f=r.add(m,f),d=r.mul(h,f),m=r.add(y,y),m=r.add(m,y),w=r.mul(p,w),v=r.mul(g,v),m=r.add(m,w),w=r.sub(y,w),w=r.mul(p,w),v=r.add(v,w),y=r.mul(m,v),d=r.add(d,y),y=r.mul(E,v),h=r.mul(b,h),h=r.sub(h,y),y=r.mul(b,m),f=r.mul(E,f),new c(h,d,f=r.add(f,y))}subtract(e){return this.add(e.negate())}is0(){return this.equals(c.ZERO)}wNAF(e){return f.wNAFCached(this,e,c.normalizeZ)}multiplyUnsafe(e){nl.aK("scalar",e,sQ,t.n);let n=c.ZERO;if(e===sQ)return n;if(e===s0)return this;let{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:a,k2:l}=i.splitScalar(e),u=n,h=n,d=this;for(;o>sQ||l>sQ;)o&s0&&(u=u.add(d)),l&s0&&(h=h.add(d)),d=d.double(),o>>=s0,l>>=s0;return s&&(u=u.negate()),a&&(h=h.negate()),h=new c(r.mul(h.px,i.beta),h.py,h.pz),u.add(h)}multiply(e){let n,i;let{endo:s,n:o}=t;if(nl.aK("scalar",e,s0,o),s){let{k1neg:t,k1:o,k2neg:a,k2:l}=s.splitScalar(e),{p:u,f:h}=this.wNAF(o),{p:d,f:p}=this.wNAF(l);u=f.constTimeNegate(t,u),d=f.constTimeNegate(a,d),d=new c(r.mul(d.px,s.beta),d.py,d.pz),n=u.add(d),i=h.add(p)}else{let{p:t,f:r}=this.wNAF(e);n=t,i=r}return c.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=c.BASE,i=(e,t)=>t!==sQ&&t!==s0&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){return u(this,e)}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===s0)return!0;if(r)return r(c,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===s0?this:r?r(c,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return(0,nl.e8)("isCompressed",e),this.assertValidity(),i(c,this,e)}toHex(e=!0){return(0,nl.e8)("isCompressed",e),nl.My(this.toRawBytes(e))}}c.BASE=new c(t.Gx,t.Gy,r.ONE),c.ZERO=new c(r.ZERO,r.ONE,r.ZERO);let d=t.nBitLength,f=nN(c,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:c,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:function(e){return nl.r4(e,s0,t.n)}}}({...t,toBytes(e,t,n){let i=t.toAffine(),s=r.toBytes(i.x),o=nl.Id;return((0,nl.e8)("isCompressed",n),n)?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){let t=e.length,n=e[0],o=e.subarray(1);if(t===i&&(2===n||3===n)){let e;let t=nl.Ph(o);if(!nl.r4(t,s0,r.ORDER))throw Error("Point is not on curve");let i=u(t);try{e=r.sqrt(i)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&n)==1!=((e&s0)===s0)&&(e=r.neg(e)),{x:t,y:e}}if(t===s&&4===n)return{x:r.fromBytes(o.subarray(0,r.BYTES)),y:r.fromBytes(o.subarray(r.BYTES,2*r.BYTES))};throw Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),c=e=>nl.My(nl.lq(e,t.nByteLength)),d=(e,t,r)=>nl.Ph(e.slice(t,r));class f{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let r=t.nByteLength;return new f(d(e=(0,nl.qj)("compactSignature",e,2*r),0,r),d(e,r,2*r))}static fromDER(e){let{r:t,s:r}=sX.toSig((0,nl.qj)("DER",e));return new f(t,r)}assertValidity(){nl.aK("r",this.r,s0,n),nl.aK("s",this.s,s0,n)}addRecoveryBit(e){return new f(this.r,this.s,e)}recoverPublicKey(e){let{r:i,s,recovery:l}=this,u=y((0,nl.qj)("msgHash",e));if(null==l||![0,1,2,3].includes(l))throw Error("recovery id invalid");let h=2===l||3===l?i+t.n:i;if(h>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let d=(1&l)==0?"02":"03",f=a.fromHex(d+c(h)),p=nw(h,n),g=o(-u*p),m=o(s*p),w=a.BASE.multiplyAndAddUnsafe(f,g,m);if(!w)throw Error("point at infinify");return w.assertValidity(),w}hasHighS(){return this.s>n>>s0}normalizeS(){return this.hasHighS()?new f(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return nl.aT(this.toDERHex())}toDERHex(){return sX.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return nl.aT(this.toCompactHex())}toCompactHex(){return c(this.r)+c(this.s)}}function p(e){let t=nl.aY(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===i||n===s:r?n===2*i||n===2*s:e instanceof a}let g=t.bits2int||function(e){let r=nl.Ph(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},y=t.bits2int_modN||function(e){return o(g(e))},m=nl.OG(t.nBitLength);function w(e){return nl.aK(`num < 2^${t.nBitLength}`,e,sQ,m),nl.lq(e,t.nByteLength)}let b={lowS:t.lowS,prehash:!1},v={lowS:t.lowS,prehash:!1};return a.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return a.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(p(e))throw Error("first arg must be private key");if(!p(t))throw Error("second arg must be public key");return a.fromHex(t).multiply(l(e)).toRawBytes(r)},sign:function(e,i,s=b){let{seed:u,k2sig:c}=function(e,i,s=b){if(["recovered","canonical"].some(e=>e in s))throw Error("sign() legacy options not supported");let{hash:u,randomBytes:c}=t,{lowS:d,prehash:p,extraEntropy:m}=s;null==d&&(d=!0),e=(0,nl.qj)("msgHash",e),sY(s),p&&(e=(0,nl.qj)("prehashed msgHash",u(e)));let v=y(e),E=l(i),S=[w(E),w(v)];if(null!=m&&!1!==m){let e=!0===m?c(r.BYTES):m;S.push((0,nl.qj)("extraEntropy",e))}return{seed:nl.Id(...S),k2sig:function(e){let t=g(e);if(!h(t))return;let r=nw(t,n),i=a.BASE.multiply(t).toAffine(),s=o(i.x);if(s===sQ)return;let l=o(r*o(v+s*E));if(l===sQ)return;let u=(i.x===s?0:2)|Number(i.y&s0),c=l;if(d&&l>n>>s0)c=l>n>>s0?o(-l):l,u^=1;return new f(s,c,u)}}}(e,i,s);return nl.fg(t.hash.outputLen,t.nByteLength,t.hmac)(u,c)},verify:function(e,r,i,s=v){let l,u;if(r=(0,nl.qj)("msgHash",r),i=(0,nl.qj)("publicKey",i),"strict"in s)throw Error("options.strict was renamed to lowS");sY(s);let{lowS:h,prehash:c}=s;try{if("string"==typeof e||nl.aY(e))try{u=f.fromDER(e)}catch(t){if(!(t instanceof sX.Err))throw t;u=f.fromCompact(e)}else if("object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s){let{r:t,s:r}=e;u=new f(t,r)}else throw Error("PARSE");l=a.fromHex(i)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;c&&(r=t.hash(r));let{r:d,s:p}=u,g=y(r),m=nw(p,n),w=o(g*m),b=o(d*m),E=a.BASE.multiplyAndAddUnsafe(l,w,b)?.toAffine();return!!E&&o(E.x)===d},ProjectivePoint:a,Signature:f,utils:{isValidPrivateKey(e){try{return l(e),!0}catch(e){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let e=nA(t.n);return function(e,t,r=!1){let n=e.length,i=nk(t),s=nA(t);if(n<16||n<s||n>1024)throw Error(`expected ${s}-1024 bytes of input, got ${n}`);let o=ny(r?(0,nl.Ph)(e):(0,nl.lX)(e),t-nh)+nh;return r?(0,nl.z)(o,i):(0,nl.lq)(o,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=a.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}})({...e,hash:t,hmac:(e,...r)=>sK(t,e,(0,nt.Id)(...r)),randomBytes:nt.po});return Object.freeze({...r(t),create:r})}({a:BigInt(0),b:BigInt(7),Fp:s5,n:s8,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-s6*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=BigInt("0x100000000000000000000000000000000"),s=s3(t*e,s8),o=s3(-r*e,s8),a=ny(e-s*t-o*n,s8),l=ny(-s*r-o*t,s8),u=a>i,h=l>i;if(u&&(a=s8-a),h&&(l=s8-l),a>i||l>i)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:a,k2neg:h,k2:l}}}},iI.sc);BigInt(0),s7.ProjectivePoint;class s9{type="secp256k1";raw;_key;constructor(e){var t;this._key=function(e){try{return s7.ProjectivePoint.fromHex(e),e}catch(e){throw new tf(String(e))}}(e),this.raw=(t=this._key,s7.ProjectivePoint.fromHex(t).toRawBytes(!0))}toMultihash(){return ez.digest(ot(this))}toCID(){return eJ.createV1(114,this.toMultihash())}toString(){return ey.encode(this.toMultihash().bytes).substring(1)}equals(e){return!!(null!=e&&e.raw instanceof Uint8Array)&&e9(this.raw,e.raw)}verify(e,t){return function(e,t,r){let n=ej.digest(r instanceof Uint8Array?r:r.subarray());if(null!=n&&"function"==typeof n.then&&"function"==typeof n.catch&&"function"==typeof n.finally)return n.then(({digest:r})=>s7.verify(t,r,e)).catch(e=>{throw new s$(String(e))});try{return s7.verify(t,n.digest,e)}catch(e){throw new s$(String(e))}}(this._key,t,e)}}function oe(e){let{Type:t,Data:r}=l.decode(e.digest),n=r??new Uint8Array;switch(t){case o.Ed25519:return nQ(n);case o.secp256k1:return new s9(n);default:throw new tm}}function ot(e){return l.encode({Type:o[e.type],Data:e.raw})}let or=Symbol.for("@libp2p/peer-id"),on=Symbol.for("nodejs.util.inspect.custom");class oi{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[or]=!0;toString(){return null==this.string&&(this.string=ey.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return eJ.createV1(114,this.multihash)}toJSON(){return this.toString()}equals(e){if(null==e)return!1;if(e instanceof Uint8Array)return e9(this.multihash.bytes,e);if("string"==typeof e)return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return e9(this.multihash.bytes,e.toMultihash().bytes);throw Error("not valid Id")}[on](){return`PeerId(${this.toString()})`}}class os extends oi{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class oo extends oi{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class oa extends oi{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}class ol{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=ez.digest(e7(this.url))}[on](){return`PeerId(${this.url})`}[or]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return eJ.createV1(2336,this.toMultihash())}toJSON(){return this.toString()}equals(e){return null!=e&&(e instanceof Uint8Array&&(e=ru(e)),e.toString()===this.toString())}}function ou(e,t){let r;if("1"===e.charAt(0)||"Q"===e.charAt(0))r=e$(ey.decode(`z${e}`));else{if(null==t)throw new td('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=e$(t.decode(e))}return oh(r)}function oh(e){if(e.code===ej.code)return new os({multihash:e});if(e.code===ez.code)try{let t=oe(e);if("Ed25519"===t.type)return new oo({multihash:e,publicKey:t});if("secp256k1"===t.type)return new oa({multihash:e,publicKey:t})}catch(t){return new ol(new URL(ru(e.digest)))}throw new ty("Supplied PeerID Multihash is invalid")}function oc(e){if(e?.multihash==null||null==e.version||1===e.version&&114!==e.code&&2336!==e.code)throw new tg("Supplied PeerID CID is invalid");return 2336===e.code?new ol(new URL(ru(e.multihash.digest))):oh(e.multihash)}function od(e){let t=new globalThis.AbortController;function r(){for(let n of(t.abort(),e))n?.removeEventListener!=null&&n.removeEventListener("abort",r)}for(let t of e){if(t?.aborted===!0){r();break}t?.addEventListener!=null&&t.addEventListener("abort",r)}let n=t.signal;return n.clear=function(){for(let t of e)t?.removeEventListener!=null&&t.removeEventListener("abort",r)},n}async function*of(e,t={}){let r=e.getReader();try{for(;;){let e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}let op=["string","number","bigint","symbol"],og=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class oy{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}oy.uint=new oy(0,"uint",!0),oy.negint=new oy(1,"negint",!0),oy.bytes=new oy(2,"bytes",!0),oy.string=new oy(3,"string",!0),oy.array=new oy(4,"array",!1),oy.map=new oy(5,"map",!1),oy.tag=new oy(6,"tag",!1),oy.float=new oy(7,"float",!0),oy.false=new oy(7,"false",!0),oy.true=new oy(7,"true",!0),oy.null=new oy(7,"null",!0),oy.undefined=new oy(7,"undefined",!0),oy.break=new oy(7,"break",!0);class om{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let ow=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,ob=new TextDecoder,ov=new TextEncoder;function oE(e){return ow&&globalThis.Buffer.isBuffer(e)}function oS(e){return e instanceof Uint8Array?oE(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}let ok=ow?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):oT(e,t,r):(e,t,r)=>r-t>64?ob.decode(e.subarray(t,r)):oT(e,t,r),oA=ow?e=>e.length>64?globalThis.Buffer.from(e):oN(e):e=>e.length>64?ov.encode(e):oN(e),ox=e=>Uint8Array.from(e),oI=ow?(e,t,r)=>oE(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),oB=ow?(e,t)=>(e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),oS(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},oC=ow?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function oN(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t}function oT(e,t,r){let n=[];for(;t<r;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,l;switch(o){case 1:i<128&&(s=i);break;case 2:(192&(r=e[t+1]))==128&&(l=(31&i)<<6|63&r)>127&&(s=l);break;case 3:r=e[t+1],n=e[t+2],(192&r)==128&&(192&n)==128&&(l=(15&i)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return o_(n)}function o_(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}class oL{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=oC(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=oI(r,0,this.cursor)}else t=oB(this.chunks,this.cursor);return e&&this.reset(),t}}let oR="CBOR decode error:",oO="CBOR encode error:",oP=[];function oU(e,t,r){if(e.length-t<r)throw Error(`${oR} not enough data for type`)}oP[23]=1,oP[24]=2,oP[25]=3,oP[26]=5,oP[27]=9;let oD=[24,256,65536,0x100000000,BigInt("18446744073709551616")];function oF(e,t,r){oU(e,t,1);let n=e[t];if(!0===r.strict&&n<oD[0])throw Error(`${oR} integer encoded in more bytes than necessary (strict decode)`);return n}function o$(e,t,r){oU(e,t,2);let n=e[t]<<8|e[t+1];if(!0===r.strict&&n<oD[1])throw Error(`${oR} integer encoded in more bytes than necessary (strict decode)`);return n}function oM(e,t,r){oU(e,t,4);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<oD[2])throw Error(`${oR} integer encoded in more bytes than necessary (strict decode)`);return n}function oz(e,t,r){oU(e,t,8);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=0x1000000*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(!0===r.strict&&s<oD[3])throw Error(`${oR} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw Error(`${oR} integers outside of the safe integer range are not supported`)}function oH(e,t){return oV(e,0,t.value)}function oV(e,t,r){if(r<oD[0]){let n=Number(r);e.push([t|n])}else if(r<oD[1]){let n=Number(r);e.push([24|t,n])}else if(r<oD[2]){let n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<oD[3]){let n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{let n=BigInt(r);if(n<oD[4]){let r=[27|t,0,0,0,0,0,0,0],i=Number(n&BigInt(0xffffffff)),s=Number(n>>BigInt(32)&BigInt(0xffffffff));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}else throw Error(`${oR} encountered BigInt larger than allowable range`)}}oH.encodedSize=function(e){return oV.encodedSize(e.value)},oV.encodedSize=function(e){return e<oD[0]?1:e<oD[1]?2:e<oD[2]?3:e<oD[3]?5:9},oH.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};let oq=BigInt(-1),oj=BigInt(1);function oG(e,t){let r=t.value;oV(e,t.type.majorEncoded,"bigint"==typeof r?r*oq-oj:-1*r-1)}function oW(e,t,r,n){oU(e,t,r+n);let i=oI(e,t+r,t+r+n);return new om(oy.bytes,i,r+n)}function oK(e,t,r,n){return oW(e,t,1,r)}function oY(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===oy.string?oA(e.value):e.value),e.encodedBytes}function oJ(e,t){let r=oY(t);oV(e,t.type.majorEncoded,r.length),e.push(r)}function oZ(e,t,r,n,i){let s=r+n;oU(e,t,s);let o=new om(oy.string,ok(e,t+r,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=oI(e,t+r,t+s)),o}function oX(e,t,r,n){return oZ(e,t,1,r,n)}function oQ(e,t,r,n){return new om(oy.array,n,r)}function o0(e,t,r,n){return oQ(e,t,1,r)}function o1(e,t){oV(e,oy.array.majorEncoded,t.value)}function o2(e,t,r,n){return new om(oy.map,n,r)}function o8(e,t,r,n){return o2(e,t,1,r)}function o6(e,t){oV(e,oy.map.majorEncoded,t.value)}function o4(e,t,r,n){return new om(oy.tag,r,1)}function o3(e,t){oV(e,oy.tag.majorEncoded,t.value)}function o5(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw Error(`${oR} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw Error(`${oR} Infinity values are not supported`)}return new om(oy.float,e,t)}function o7(e,t,r){let n=t.value;if(!1===n)e.push([20|oy.float.majorEncoded]);else if(!0===n)e.push([21|oy.float.majorEncoded]);else if(null===n)e.push([22|oy.float.majorEncoded]);else if(void 0===n)e.push([23|oy.float.majorEncoded]);else{let t=!1;r&&!0===r.float64||(ar(n),n===an(at,1)||Number.isNaN(n)?(at[0]=249,e.push(at.slice(0,3)),t=!0):(ai(n),n!==as(at,1)||(at[0]=250,e.push(at.slice(0,5)),t=!0))),t||(ae.setFloat64(0,n,!1),ao(at,1),at[0]=251,e.push(at.slice(0,9)))}}oG.encodedSize=function(e){let t=e.value,r="bigint"==typeof t?t*oq-oj:-1*t-1;return r<oD[0]?1:r<oD[1]?2:r<oD[2]?3:r<oD[3]?5:9},oG.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},oJ.encodedSize=function(e){let t=oY(e);return oV.encodedSize(t.length)+t.length},oJ.compareTokens=function(e,t){var r,n;return r=oY(e),n=oY(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(oE(e)&&oE(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n)},o1.compareTokens=oH.compareTokens,o1.encodedSize=function(e){return oV.encodedSize(e.value)},o6.compareTokens=oH.compareTokens,o6.encodedSize=function(e){return oV.encodedSize(e.value)},o3.compareTokens=oH.compareTokens,o3.encodedSize=function(e){return oV.encodedSize(e.value)},o7.encodedSize=function(e,t){let r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){ar(r);let e=an(at,1);if(r===e||Number.isNaN(r))return 3;if(ai(r),r===(e=as(at,1)))return 5}return 9};let o9=new ArrayBuffer(9),ae=new DataView(o9,1),at=new Uint8Array(o9,0);function ar(e){if(e===1/0)ae.setUint16(0,31744,!1);else if(e===-1/0)ae.setUint16(0,64512,!1);else if(Number.isNaN(e))ae.setUint16(0,32256,!1);else{ae.setFloat32(0,e);let t=ae.getUint32(0),r=(0x7f800000&t)>>23,n=8388607&t;if(255===r)ae.setUint16(0,31744,!1);else if(0===r)ae.setUint16(0,(0x80000000&e)>>16|n>>13,!1);else{let e=r-127;e<-24?ae.setUint16(0,0):e<-14?ae.setUint16(0,(0x80000000&t)>>16|1<<24+e,!1):ae.setUint16(0,(0x80000000&t)>>16|e+15<<10|n>>13,!1)}}}function an(e,t){let r;if(e.length-t<2)throw Error(`${oR} not enough data for float16`);let n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;let i=n>>10&31,s=1023&n;return r=0===i?5960464477539063e-23*s:31!==i?(s+1024)*2**(i-25):0===s?1/0:NaN,32768&n?-r:r}function ai(e){ae.setFloat32(0,e,!1)}function as(e,t){if(e.length-t<4)throw Error(`${oR} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function ao(e,t){if(e.length-t<8)throw Error(`${oR} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function aa(e,t,r){throw Error(`${oR} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function al(e){return()=>{throw Error(`${oR} ${e}`)}}o7.compareTokens=oH.compareTokens;let au=[];for(let e=0;e<=23;e++)au[e]=aa;au[24]=function(e,t,r,n){return new om(oy.uint,oF(e,t+1,n),2)},au[25]=function(e,t,r,n){return new om(oy.uint,o$(e,t+1,n),3)},au[26]=function(e,t,r,n){return new om(oy.uint,oM(e,t+1,n),5)},au[27]=function(e,t,r,n){return new om(oy.uint,oz(e,t+1,n),9)},au[28]=aa,au[29]=aa,au[30]=aa,au[31]=aa;for(let e=32;e<=55;e++)au[e]=aa;au[56]=function(e,t,r,n){return new om(oy.negint,-1-oF(e,t+1,n),2)},au[57]=function(e,t,r,n){return new om(oy.negint,-1-o$(e,t+1,n),3)},au[58]=function(e,t,r,n){return new om(oy.negint,-1-oM(e,t+1,n),5)},au[59]=function(e,t,r,n){let i=oz(e,t+1,n);if("bigint"!=typeof i){let e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new om(oy.negint,e,9)}if(!0!==n.allowBigInt)throw Error(`${oR} integers outside of the safe integer range are not supported`);return new om(oy.negint,oq-BigInt(i),9)},au[60]=aa,au[61]=aa,au[62]=aa,au[63]=aa;for(let e=64;e<=87;e++)au[e]=oK;au[88]=function(e,t,r,n){return oW(e,t,2,oF(e,t+1,n))},au[89]=function(e,t,r,n){return oW(e,t,3,o$(e,t+1,n))},au[90]=function(e,t,r,n){return oW(e,t,5,oM(e,t+1,n))},au[91]=function(e,t,r,n){let i=oz(e,t+1,n);if("bigint"==typeof i)throw Error(`${oR} 64-bit integer bytes lengths not supported`);return oW(e,t,9,i)},au[92]=aa,au[93]=aa,au[94]=aa,au[95]=al("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)au[e]=oX;au[120]=function(e,t,r,n){return oZ(e,t,2,oF(e,t+1,n),n)},au[121]=function(e,t,r,n){return oZ(e,t,3,o$(e,t+1,n),n)},au[122]=function(e,t,r,n){return oZ(e,t,5,oM(e,t+1,n),n)},au[123]=function(e,t,r,n){let i=oz(e,t+1,n);if("bigint"==typeof i)throw Error(`${oR} 64-bit integer string lengths not supported`);return oZ(e,t,9,i,n)},au[124]=aa,au[125]=aa,au[126]=aa,au[127]=al("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)au[e]=o0;au[152]=function(e,t,r,n){return oQ(e,t,2,oF(e,t+1,n))},au[153]=function(e,t,r,n){return oQ(e,t,3,o$(e,t+1,n))},au[154]=function(e,t,r,n){return oQ(e,t,5,oM(e,t+1,n))},au[155]=function(e,t,r,n){let i=oz(e,t+1,n);if("bigint"==typeof i)throw Error(`${oR} 64-bit integer array lengths not supported`);return oQ(e,t,9,i)},au[156]=aa,au[157]=aa,au[158]=aa,au[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${oR} indefinite length items not allowed`);return oQ(e,t,1,1/0)};for(let e=160;e<=183;e++)au[e]=o8;au[184]=function(e,t,r,n){return o2(e,t,2,oF(e,t+1,n))},au[185]=function(e,t,r,n){return o2(e,t,3,o$(e,t+1,n))},au[186]=function(e,t,r,n){return o2(e,t,5,oM(e,t+1,n))},au[187]=function(e,t,r,n){let i=oz(e,t+1,n);if("bigint"==typeof i)throw Error(`${oR} 64-bit integer map lengths not supported`);return o2(e,t,9,i)},au[188]=aa,au[189]=aa,au[190]=aa,au[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${oR} indefinite length items not allowed`);return o2(e,t,1,1/0)};for(let e=192;e<=215;e++)au[e]=o4;au[216]=function(e,t,r,n){return new om(oy.tag,oF(e,t+1,n),2)},au[217]=function(e,t,r,n){return new om(oy.tag,o$(e,t+1,n),3)},au[218]=function(e,t,r,n){return new om(oy.tag,oM(e,t+1,n),5)},au[219]=function(e,t,r,n){return new om(oy.tag,oz(e,t+1,n),9)},au[220]=aa,au[221]=aa,au[222]=aa,au[223]=aa;for(let e=224;e<=243;e++)au[e]=al("simple values are not supported");au[244]=aa,au[245]=aa,au[246]=aa,au[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw Error(`${oR} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new om(oy.null,null,1):new om(oy.undefined,void 0,1)},au[248]=al("simple values are not supported"),au[249]=function(e,t,r,n){return o5(an(e,t+1),3,n)},au[250]=function(e,t,r,n){return o5(as(e,t+1),5,n)},au[251]=function(e,t,r,n){return o5(ao(e,t+1),9,n)},au[252]=aa,au[253]=aa,au[254]=aa,au[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${oR} indefinite length items not allowed`);return new om(oy.break,void 0,1)};let ah=[];for(let e=0;e<24;e++)ah[e]=new om(oy.uint,e,1);for(let e=-1;e>=-24;e--)ah[31-e]=new om(oy.negint,e,1);ah[64]=new om(oy.bytes,new Uint8Array(0),1),ah[96]=new om(oy.string,"",1),ah[128]=new om(oy.array,0,1),ah[160]=new om(oy.map,0,1),ah[244]=new om(oy.false,!1,1),ah[245]=new om(oy.true,!0,1),ah[246]=new om(oy.null,null,1);let ac={float64:!1,mapSorter:function(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=af[r.type.major].compareTokens(r,n);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i},quickEncodeToken:function(e){switch(e.type){case oy.false:return ox([244]);case oy.true:return ox([245]);case oy.null:return ox([246]);case oy.bytes:if(!e.value.length)return ox([64]);return;case oy.string:if(""===e.value)return ox([96]);return;case oy.array:if(0===e.value)return ox([128]);return;case oy.map:if(0===e.value)return ox([160]);return;case oy.uint:if(e.value<24)return ox([Number(e.value)]);return;case oy.negint:if(e.value>=-24)return ox([31-Number(e.value)])}}};function ad(){let e=[];return e[oy.uint.major]=oH,e[oy.negint.major]=oG,e[oy.bytes.major]=oJ,e[oy.string.major]=oJ,e[oy.array.major]=o1,e[oy.map.major]=o6,e[oy.tag.major]=o3,e[oy.float.major]=o7,e}let af=ad(),ap=new oL;class ag{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw Error(`${oO} object contains circular references`);return new ag(t,e)}}let ay={null:new om(oy.null,null),undefined:new om(oy.undefined,void 0),true:new om(oy.true,!0),false:new om(oy.false,!1),emptyArray:new om(oy.array,0),emptyMap:new om(oy.map,0)},am={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new om(oy.uint,e):new om(oy.negint,e):new om(oy.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new om(oy.uint,e):new om(oy.negint,e),Uint8Array:(e,t,r,n)=>new om(oy.bytes,e),string:(e,t,r,n)=>new om(oy.string,e),boolean:(e,t,r,n)=>e?ay.true:ay.false,null:(e,t,r,n)=>ay.null,undefined:(e,t,r,n)=>ay.undefined,ArrayBuffer:(e,t,r,n)=>new om(oy.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new om(oy.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[ay.emptyArray,new om(oy.break)]:ay.emptyArray;n=ag.createCheck(n,e);let i=[],s=0;for(let t of e)i[s++]=aw(t,r,n);return r.addBreakTokens?[new om(oy.array,e.length),i,new om(oy.break)]:[new om(oy.array,e.length),i]},Object(e,t,r,n){let i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===r.addBreakTokens?[ay.emptyMap,new om(oy.break)]:ay.emptyMap;n=ag.createCheck(n,e);let a=[],l=0;for(let t of s)a[l++]=[aw(t,r,n),aw(i?e.get(t):e[t],r,n)];return(r.mapSorter&&a.sort(r.mapSorter),r.addBreakTokens)?[new om(oy.map,o),a,new om(oy.break)]:[new om(oy.map,o),a]}};for(let e of(am.Map=am.Object,am.Buffer=am.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))am[`${e}Array`]=am.DataView;function aw(e,t={},r){let n=function(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";let t=typeof e;return op.includes(t)?t:"function"===t?"Function":Array.isArray(e)?"Array":e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)?"Buffer":function(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(og.includes(t))return t}(e)||"Object"}(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||am[n];if("function"==typeof i){let s=i(e,n,t,r);if(null!=s)return s}let s=am[n];if(!s)throw Error(`${oO} unsupported type: ${n}`);return s(e,n,t,r)}function ab(e,t,r){let n=aw(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let e=r.quickEncodeToken(n);if(e)return e;let i=t[n.type.major];if(i.encodedSize){let e=new oL(i.encodedSize(n,r));if(i(e,n,r),1!==e.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return oS(e.chunks[0])}}return ap.reset(),!function e(t,r,n,i){if(Array.isArray(r))for(let s of r)e(t,s,n,i);else n[r.type.major](t,r,i)}(ap,n,t,r),ap.toBytes(!0)}function av(e,t){return ab(e,af,t=Object.assign({},ac,t))}let aE={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class aS{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=ah[e];if(void 0===t){let r=au[e];if(!r)throw Error(`${oR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}let ak=Symbol.for("DONE"),aA=Symbol.for("BREAK");function ax(e,t){let[r,n]=function(e,t){if(!(e instanceof Uint8Array))throw Error(`${oR} data to decode must be a Uint8Array`);let r=(t=Object.assign({},aE,t)).tokenizer||new aS(e,t),n=function e(t,r){if(t.done())return ak;let n=t.next();if(n.type===oy.break)return aA;if(n.type.terminal)return n.value;if(n.type===oy.array)return function(t,r,n){let i=[];for(let s=0;s<t.value;s++){let o=e(r,n);if(o===aA){if(t.value===1/0)break;throw Error(`${oR} got unexpected break to lengthed array`)}if(o===ak)throw Error(`${oR} found array but not enough entries (got ${s}, expected ${t.value})`);i[s]=o}return i}(n,t,r);if(n.type===oy.map)return function(t,r,n){let i=!0===n.useMaps,s=i?void 0:{},o=i?new Map:void 0;for(let a=0;a<t.value;a++){let l=e(r,n);if(l===aA){if(t.value===1/0)break;throw Error(`${oR} got unexpected break to lengthed map`)}if(l===ak)throw Error(`${oR} found map but not enough entries (got ${a} [no key], expected ${t.value})`);if(!0!==i&&"string"!=typeof l)throw Error(`${oR} non-string keys not supported (got ${typeof l})`);if(!0===n.rejectDuplicateMapKeys&&(i&&o.has(l)||!i&&l in s))throw Error(`${oR} found repeat map key "${l}"`);let u=e(r,n);if(u===ak)throw Error(`${oR} found map but not enough entries (got ${a} [no value], expected ${t.value})`);i?o.set(l,u):s[l]=u}return i?o:s}(n,t,r);if(n.type===oy.tag){if(r.tags&&"function"==typeof r.tags[n.value]){let i=e(t,r);return r.tags[n.value](i)}throw Error(`${oR} tag not supported (${n.value})`)}throw Error("unsupported")}(r,t);if(n===ak)throw Error(`${oR} did not find any content to decode`);if(n===aA)throw Error(`${oR} got unexpected break`);return[n,e.subarray(r.pos())]}(e,t);if(n.length>0)throw Error(`${oR} too many terminals, data makes no sense`);return r}class aI extends Error{static name="SignatureCreationError";constructor(e="Record signature creation failed"){super(e),this.name="SignatureCreationError"}}class aB extends Error{static name="SignatureVerificationError";constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}class aC extends Error{static name="RecordExpiredError";constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}class aN extends Error{static name="UnsupportedValidityError";constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}class aT extends Error{static name="RecordTooLargeError";constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}class a_ extends Error{static name="InvalidValueError";constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}class aL extends Error{static name="InvalidRecordDataError";constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}class aR extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}!function(e){var t;let r,n;(e.ValidityType||(e.ValidityType={})).EOL="EOL",(t=r||(r={}))[t.EOL=0]="EOL",(e.ValidityType||(e.ValidityType={})).codec=()=>iA(r),e.codec=()=>(null==n&&(n=ix((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.value=t.bytes();break;case 2:i.signatureV1=t.bytes();break;case 3:i.validityType=e.ValidityType.codec().decode(t);break;case 4:i.validity=t.bytes();break;case 5:i.sequence=t.uint64();break;case 6:i.ttl=t.uint64();break;case 7:i.pubKey=t.bytes();break;case 8:i.signatureV2=t.bytes();break;case 9:i.data=t.bytes();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>iS(t,e.codec()),e.decode=(t,r)=>ia(t,e.codec(),r)}(h||(h={}));let aO=r5("ipns:utils"),aP=e7("/ipns/");function aU(e){return rg([e7("ipns-signature:"),e])}function aD(e){return"signatureV1"in e?h.encode({value:e7(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:e7(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):h.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data})}function aF(e){let t=h.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw new aB("Missing data or signatureV2");let r=az(t.data),n=function(e){let t=ru(e).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${eJ.decode(e).toV1().toString()}`}catch{}try{return`/ipfs/${eJ.parse(t).toV1().toString()}`}catch{}throw new a_("Value must be a valid content path starting with /")}(r.Value),i=ru(r.Validity);if(null!=t.value&&null!=t.signatureV1)return function(e){if(null==e.data)throw new aL("Record data is missing");let t=az(e.data);if(!e9(t.Value,e.value??new Uint8Array(0)))throw new aB('Field "value" did not match between protobuf and CBOR');if(!e9(t.Validity,e.validity??new Uint8Array(0)))throw new aB('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==e.validityType)throw new aB('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==e.sequence)throw new aB('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==e.ttl)throw new aB('Field "ttl" did not match between protobuf and CBOR')}(t),{value:n,validityType:h.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:h.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw Error("invalid record: does not include signatureV1 or signatureV2")}function a$(e){return rg([aP,e.bytes])}function aM(e){let t=e$(e.slice(aP.length));if(0!==t.code&&18!==t.code)throw new ty("Multihash in IPNS key was not identity or sha2-256");return t}function az(e){let t=ax(e);if(0===t.ValidityType)t.ValidityType=h.ValidityType.EOL;else throw new aN("The validity type is unsupported");return Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}var aH=r(5454);let aV=r5("ipns:validator"),aq=async(e,t)=>{let r;let n=aF(t);try{let t=aU(n.data);r=await e.verify(t,n.signatureV2)}catch(e){r=!1}if(!r)throw aV.error("record signature verification failed"),new aB("Record signature verification failed");if(n.validityType===h.ValidityType.EOL){if(aH.fromString(n.validity).toDate().getTime()<Date.now())throw aV.error("record has expired"),new aC("record has expired")}else if(null!=n.validityType)throw aV.error("the validity type is unsupported"),new aN("The validity type is unsupported");aV("ipns record for %s is valid",n.value)};async function aj(e,t){let r;if(t.byteLength>10240)throw new aT("The record is too large");let n=aM(e);0===n.code&&(r=oe(n));let i=function(e){let t;if(null!=e.pubKey)try{t=function(e){let{Type:t,Data:r}=l.decode(e),n=r??new Uint8Array;switch(t){case o.RSA:return function(e){let t=function(e){let{result:t}=function(e){if(!e.byteLength){let e=new iJ({},iG);return e.error="Input buffer has zero length",{offset:-1,result:e}}return i0(iB._H.toUint8Array(e).slice(),0,e.byteLength)}(e),r=t.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:sq(r[0]),e:sq(r[1])}}(e);if(function(e){if("RSA"!==e.kty)throw new td("invalid key type");if(null==e.n)throw new td("invalid key modulus");return 8*e7(e.n,"base64url").length}(t)>8192)throw new tf("Key size is too large");return new sV(t,eF(18,(0,iI.sc)(l.encode({Type:o.RSA,Data:e}))))}(n);case o.Ed25519:return nQ(n);case o.secp256k1:return new s9(n);default:throw new tm}}(e.pubKey)}catch(e){throw aO.error(e),e}if(null!=t)return t}(aF(t))??r;if(null==i)throw new aR("Could not extract public key from IPNS record or routing key");if(!e9(e,a$(i.toMultihash())))throw new aR("Embedded public key did not match routing key");await aq(i,t)}async function*aG(e){let t=/\r?\n/,r=new TextDecoder("utf8"),n="";for await(let i of e){"string"==typeof i&&(i=new TextEncoder().encode(i));let e=(n+=r.decode(i,{stream:!0})).split(t);n=e.pop()??"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}""!==(n+=r.decode())&&(yield JSON.parse(n))}var aW=r(74486);class aK extends Error{constructor(e){super(e),this.name="TimeoutError"}}class aY extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}let aJ=e=>void 0===globalThis.DOMException?new aY(e):new DOMException(e),aZ=e=>{let t=void 0===e.reason?aJ("This operation was aborted."):e.reason;return t instanceof Error?t:aJ(t)};function aX(e,t){let r;let{milliseconds:n,fallback:i,message:s,customTimers:o={setTimeout,clearTimeout}}=t,a=new Promise((a,l)=>{if("number"!=typeof n||1!==Math.sign(n))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(t.signal){let{signal:r}=t;r.aborted&&l(aZ(r));let n=()=>{l(aZ(r))};r.addEventListener("abort",n,{once:!0}),e.finally(()=>{r.removeEventListener("abort",n)})}if(n===Number.POSITIVE_INFINITY){e.then(a,l);return}let u=new aK;r=o.setTimeout.call(void 0,()=>{if(i){try{a(i())}catch(e){l(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===s?a():s instanceof Error?l(s):(u.message=s??`Promise timed out after ${n} milliseconds`,l(u))},n),(async()=>{try{a(await e)}catch(e){l(e)}})()}).finally(()=>{a.clear()});return a.clear=()=>{o.clearTimeout.call(void 0,r),r=void 0},a}class aQ{#c=[];enqueue(e,t){let r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&this.#c[this.size-1].priority>=t.priority){this.#c.push(r);return}let n=function(e,t,r){let n=0,i=e.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;0>=r(e[o],t)?(n=++o,i-=s+1):i=s}return n}(this.#c,r,(e,t)=>t.priority-e.priority);this.#c.splice(n,0,r)}dequeue(){let e=this.#c.shift();return e?.run}filter(e){return this.#c.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#c.length}}class a0 extends aW.b{#d;#f;#p=0;#g;#y;#m=0;#w;#b;#c;#v;#E=0;#S;#k;#A;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:aQ,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#d=e.carryoverConcurrencyCount,this.#f=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#g=e.intervalCap,this.#y=e.interval,this.#c=new e.queueClass,this.#v=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#A=!0===e.throwOnTimeout,this.#k=!1===e.autoStart}get #x(){return this.#f||this.#p<this.#g}get #I(){return this.#E<this.#S}#B(){this.#E--,this.#C(),this.emit("next")}#N(){this.#T(),this.#_(),this.#b=void 0}get #L(){let e=Date.now();if(void 0===this.#w){let t=this.#m-e;if(!(t<0))return void 0===this.#b&&(this.#b=setTimeout(()=>{this.#N()},t)),!0;this.#p=this.#d?this.#E:0}return!1}#C(){if(0===this.#c.size)return this.#w&&clearInterval(this.#w),this.#w=void 0,this.emit("empty"),0===this.#E&&this.emit("idle"),!1;if(!this.#k){let e=!this.#L;if(this.#x&&this.#I){let t=this.#c.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#_(),!0)}}return!1}#_(){this.#f||void 0!==this.#w||(this.#w=setInterval(()=>{this.#T()},this.#y),this.#m=Date.now()+this.#y)}#T(){0===this.#p&&0===this.#E&&this.#w&&(clearInterval(this.#w),this.#w=void 0),this.#p=this.#d?this.#E:0,this.#R()}#R(){for(;this.#C(););}get concurrency(){return this.#S}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#S=e,this.#R()}async #O(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(e.reason)},{once:!0})})}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:this.#A,...t},new Promise((r,n)=>{this.#c.enqueue(async()=>{this.#E++,this.#p++;try{t.signal?.throwIfAborted();let n=e({signal:t.signal});t.timeout&&(n=aX(Promise.resolve(n),{milliseconds:t.timeout})),t.signal&&(n=Promise.race([n,this.#O(t.signal)]));let i=await n;r(i),this.emit("completed",i)}catch(e){if(e instanceof aK&&!t.throwOnTimeout){r();return}n(e),this.emit("error",e)}finally{this.#B()}},t),this.emit("add"),this.#C()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#k&&(this.#k=!1,this.#R()),this}pause(){this.#k=!0}clear(){this.#c=new this.#v}async onEmpty(){0!==this.#c.size&&await this.#P("empty")}async onSizeLessThan(e){this.#c.size<e||await this.#P("next",()=>this.#c.size<e)}async onIdle(){(0!==this.#E||0!==this.#c.size)&&await this.#P("idle")}async #P(e,t){return new Promise(r=>{let n=()=>{(!t||t())&&(this.off(e,n),r())};this.on(e,n)})}get size(){return this.#c.size}sizeBy(e){return this.#c.filter(e).length}get pending(){return this.#E}get isPaused(){return this.#k}}class a1 extends Error{static name="InvalidRequestError";constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}class a2 extends Error{static name="BadResponseError";constructor(e="Bad response"){super(e),this.name="BadResponseError"}}let a8=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(let t of e)return t})();for(let t of e)return t},a6=function(e){let[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}},a4=function(e,t){let r=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(let n of e)yield t(n,r++)}();let n=a6(e),{value:i,done:s}=n.next();if(!0===s)return function*(){}();let o=t(i,r++);return"function"==typeof o.then?async function*(){for await(let e of(yield await o,n))yield t(e,r++)}():function*(){for(let e of(yield o,n))yield t(e,r++)}()},a3=e7("/ipns/");function a5(e){return e9(e.subarray(0,a3.byteLength),a3)}class a7{client;constructor(e){this.client=e}async *findProviders(e,t={}){yield*a4(this.client.getProviders(e,t),e=>({id:e.ID,multiaddrs:e.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,r){if(!a5(e))return;let n=aM(e),i=eJ.createV1(114,n),s=aF(t);await this.client.putIPNS(i,s,r)}async get(e,t){if(!a5(e))throw new tp("Not found");let r=aM(e),n=eJ.createV1(114,r);try{let e=await this.client.getIPNS(n,t);return aD(e)}catch(e){if("BadResponseError"===e.name)throw new tp("Not found");throw e}}}class a9{client;constructor(e){this.client=e}async findPeer(e,t={}){let r=await a8(this.client.getPeers(e,t));if(null!=r)return{id:r.ID,multiaddrs:r.Addrs??[]};throw new tp("Not found")}async *getClosestPeers(e,t={}){}}let le=r5("delegated-routing-v1-http-api-client"),lt={concurrentRequests:4,timeout:3e4};class lr{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,D(1/0,this.shutDownController.signal),this.httpQueue=new a0({concurrency:t.concurrentRequests??lt.concurrentRequests}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??lt.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new a7(this),this.peerRouting=new a9(this)}get[r1](){return this.contentRouting}get[r2](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async *getProviders(e,t={}){le("getProviders starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=od([this.shutDownController.signal,r,t.signal]);D(1/0,r,n);let i=tw(),s=tw();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#U(r,t.filterAddrs,t.filterProtocols);let s=await fetch(r,{headers:{Accept:"application/x-ndjson"},signal:n});if(404===s.status)throw new tp("No matching records found");if(422===s.status)throw new a1("Request does not conform to schema or semantic constraints");if(null==s.body)throw new a2("Routing response had no body");let o=s.headers.get("Content-Type");if("application/json"===o)for(let e of(await s.json()).Providers){let t=this.#D(e);null!=t&&(yield t)}else for await(let e of aG(of(s.body))){let t=this.#D(e);null!=t&&(yield t)}}catch(e){le.error("getProviders errored:",e)}finally{n.clear(),s.resolve(),le("getProviders finished: %c",e)}}async *getPeers(e,t={}){le("getPeers starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=od([this.shutDownController.signal,r,t.signal]);D(1/0,r,n);let i=tw(),s=tw();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#U(r,t.filterAddrs,t.filterProtocols);let s=await fetch(r,{headers:{Accept:"application/x-ndjson"},signal:n});if(404===s.status)throw new tp("No matching records found");if(422===s.status)throw new a1("Request does not conform to schema or semantic constraints");if(null==s.body)throw new a2("Routing response had no body");let o=s.headers.get("Content-Type");if("application/json"===o)for(let e of(await s.json()).Peers){let t=this.#D(e);null!=t&&(yield t)}else for await(let e of aG(of(s.body))){let t=this.#D(e);null!=t&&(yield t)}}catch(e){le.error("getPeers errored:",e)}finally{n.clear(),s.resolve(),le("getPeers finished: %c",e)}}async getIPNS(e,t={}){le("getIPNS starts: %s",e);let r=AbortSignal.timeout(this.timeout),n=od([this.shutDownController.signal,r,t.signal]);D(1/0,r,n);let i=tw(),s=tw();this.httpQueue.add(async()=>(i.resolve(),s.promise));let o=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;let r=await fetch(o,{headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:n});if(le("getIPNS GET %s %d",o,r.status),404===r.status)throw new tp("No matching records found");if(422===r.status)throw new a1("Request does not conform to schema or semantic constraints");if(null==r.body)throw new a2("GET ipns response had no body");let s=await r.arrayBuffer(),a=new Uint8Array(s,0,s.byteLength);return!1!==t.validate&&await aj(a$(e.multihash),a),aF(a)}catch(e){throw le.error("getIPNS GET %s error:",o,e),e}finally{n.clear(),s.resolve(),le("getIPNS finished: %s",e)}}async putIPNS(e,t,r={}){le("putIPNS starts: %c",e);let n=AbortSignal.timeout(this.timeout),i=od([this.shutDownController.signal,n,r.signal]);D(1/0,n,i);let s=tw(),o=tw();this.httpQueue.add(async()=>(s.resolve(),o.promise));let a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;let e=aD(t),r=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:e,signal:i});if(le("putIPNS PUT %s %d",a,r.status),200!==r.status)throw new a2("PUT ipns response had status other than 200")}catch(e){throw le.error("putIPNS PUT %s error:",a,e.stack),e}finally{i.clear(),o.resolve(),le("putIPNS finished: %c",e)}}#D(e){try{let t=[],r=e.Addrs?.map(rM)??[];return null!=e.Protocols&&t.push(...e.Protocols),null!=e.Protocol&&(t.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:ou(e.ID),Addrs:r,Protocols:t}}catch(e){le.error("could not conform record to peer schema",e)}}#U(e,t,r){if(null!=t||null!=this.filterAddrs){let r=t?.join(",")??this.filterAddrs?.join(",")??"";""!==r&&e.searchParams.set("filter-addrs",r)}if(null!=r||null!=this.filterProtocols){let t=r?.join(",")??this.filterProtocols?.join(",")??"";""!==t&&e.searchParams.set("filter-protocols",t)}}}let ln=e7("/ipns/");function li(e){return e9(e.subarray(0,ln.byteLength),ln)}class ls{client;constructor(e,t={}){this.client=function(e,t={}){return new lr(new URL(e),t)}(e,t)}async provide(e,t){}async *findProviders(e,t){yield*a4(this.client.getProviders(e,t),e=>({id:e.ID,multiaddrs:e.Addrs,protocols:e.Protocols}))}async put(e,t,r){if(!li(e))return;let n=aM(e),i=eJ.createV1(114,n),s=aF(t);await this.client.putIPNS(i,s,r)}async get(e,t){if(!li(e))throw new tp("Not found");let r=aM(e),n=eJ.createV1(114,r);try{let e=await this.client.getIPNS(n,t);return aD(e)}catch(e){if("BadResponseError"===e.name)throw new tp("Not found");throw e}}async findPeer(e,t){let r=await a8(this.client.getPeers(e,t));if(null!=r)return{id:r.ID,multiaddrs:r.Addrs??[]};throw new tp("Not found")}async *getClosestPeers(e,t){}}function lo(e,t){return new ls(new URL(e),t??{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss"]})}let la="[a-fA-F\\d:]",ll=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${la})|(?<=${la})(?=\\s|$))`:"",lu="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",lh="[a-fA-F\\d]{1,4}",lc=`
(?:
(?:${lh}:){7}(?:${lh}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${lh}:){6}(?:${lu}|:${lh}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${lh}:){5}(?::${lu}|(?::${lh}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${lh}:){4}(?:(?::${lh}){0,1}:${lu}|(?::${lh}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${lh}:){3}(?:(?::${lh}){0,2}:${lu}|(?::${lh}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${lh}:){2}(?:(?::${lh}){0,3}:${lu}|(?::${lh}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${lh}:){1}(?:(?::${lh}){0,4}:${lu}|(?::${lh}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${lh}){0,5}:${lu}|(?::${lh}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),ld=RegExp(`(?:^${lu}$)|(?:^${lc}$)`),lf=RegExp(`^${lu}$`),lp=RegExp(`^${lc}$`),lg=e=>e&&e.exact?ld:RegExp(`(?:${ll(e)}${lu}${ll(e)})|(?:${ll(e)}${lc}${ll(e)})`,"g");lg.v4=e=>e&&e.exact?lf:RegExp(`${ll(e)}${lu}${ll(e)}`,"g"),lg.v6=e=>e&&e.exact?lp:RegExp(`${ll(e)}${lc}${ll(e)}`,"g");let{toString:ly}=Object.prototype,lm={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function lw(e,t,{timeout:r}={}){try{return(function(e){let t=(...t)=>e(...t);return Object.defineProperty(t,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),t})(()=>(function(e,t={}){if("[object RegExp]"!==ly.call(e))throw TypeError("Expected a RegExp instance");let r=Object.keys(lm).map(r=>("boolean"==typeof t[r]?t[r]:e[r])?lm[r]:"").join(""),n=new RegExp(t.source||e.source,r);return n.lastIndex="number"==typeof t.lastIndex?t.lastIndex:e.lastIndex,n})(e).test(t),{timeout:r})()}catch(e){throw e}}let lb={timeout:400};function lv(e){return!(e.length>45)&&lw(lg.v6({exact:!0}),e,lb)}let lE={http:"80",https:"443",ws:"80",wss:"443"},lS=["http","https","ws","wss"],lk=["https://trustless-gateway.link","https://4everland.io"];class lA{gateways;constructor(e={}){this.gateways=(e.gateways??lk).map(e=>(function(e){return e=e.toString(),{id:oc(eJ.createV1(2336,ez.digest(e7(e)))),multiaddrs:[function(e,t){let r=(t=t??{}).defaultDnsType??"dns4",{scheme:n,hostname:i,port:s}=function(e){let[t]=e.split(":");lS.includes(t)||(e="http"+e.substring(t.length));let{protocol:r,hostname:n,port:i}=new URL(e);if(null==i||""===i){let e=function(e){if(null!=e&&""!==e&&null!=lE[e])return lE[e]}(t);null!=e&&(i=e),null==e&&"http:"===r&&(i="80")}return{scheme:t,hostname:n,port:i}}(e);return rM("/"+[function(e,t){if(null!=e&&""!==e){if(!(e.length>15)&&lw(lg.v4({exact:!0}),e,lb))return["ip4",e];if(lv(e))return["ip6",e];if("["===e[0]){let t=e.substring(1,e.length-1);if(lv(t))return["ip6",t]}return[t,e]}}(i,r),null==s||""===s?void 0:"udp"===n?["udp",s]:["tcp",s],function(e){if(null==e.match(/^tcp$|^udp$/))return[e]}(n)].filter(e=>!!e).reduce((e,t)=>e.concat(t),[]).join("/"))}(e)]}})(e))}async *findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(e=>({...e,protocols:["transport-ipfs-gateway-http"]}))}}function lx(e={}){return new lA(e)}function lI(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function lB(...e){let t=[];for(let r of e)lI(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStart&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{null!=e.afterStart&&await e.afterStart()}))}async function lC(...e){let t=[];for(let r of e)lI(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStop&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{null!=e.afterStop&&await e.afterStop()}))}class lN extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}function lT(e){let t=[c.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}function l_(e){return{Status:e.Status??0,TC:e.TC??e.flag_tc??!1,RD:e.RD??e.flag_rd??!1,RA:e.RA??e.flag_ra??!1,AD:e.AD??e.flag_ad??!1,CD:e.CD??e.flag_cd??!1,Question:(e.Question??e.questions??[]).map(e=>({name:e.name,type:c[e.type]})),Answer:(e.Answer??e.answers??[]).map(e=>({name:e.name,type:c[e.type],TTL:e.TTL??e.ttl??60,data:e.data instanceof Uint8Array?ru(e.data):e.data}))}}function lL(e,t={}){let r=new a0({concurrency:t.queryConcurrency??4});return async(t,n={})=>{let i=new URLSearchParams;i.set("name",t),lT(n.types).forEach(e=>{i.append("type",c[e])}),n.onProgress?.(new lN("dns:query",{detail:t}));let s=await r.add(async()=>{let t=await fetch(`${e}?${i}`,{headers:{accept:"application/dns-json"},signal:n?.signal});if(200!==t.status)throw Error(`Unexpected HTTP status: ${t.status} - ${t.statusText}`);let r=l_(await t.json());return n.onProgress?.(new lN("dns:response",{detail:r})),r},{signal:n.signal});if(null==s)throw Error("No DNS response received");return s}}var lR=r(40194);class lO{lru;constructor(e){this.lru=lR(e)}get(e,t){let r=!0,n=[];for(let i of t){let t=this.getAnswers(e,i);if(0===t.length){r=!1;break}n.push(...t)}if(r)return l_({answers:n})}getAnswers(e,t){let r=`${e.toLowerCase()}-${t}`,n=this.lru.get(r);if(null!=n){let e=n.filter(e=>e.expires>Date.now()).map(({expires:e,value:t})=>({...t,TTL:Math.round((e-Date.now())/1e3),type:c[t.type]}));return 0===e.length&&this.lru.remove(r),e}return[]}add(e,t){let r=`${e.toLowerCase()}-${t.type}`,n=this.lru.get(r)??[];n.push({expires:Date.now()+(t.TTL??60)*1e3,value:t}),this.lru.set(r,n)}remove(e,t){let r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}class lP{resolvers;cache;constructor(e){this.resolvers={},this.cache=new lO(e.cacheSize??1e3),Object.entries(e.resolvers??{}).forEach(([e,t])=>{Array.isArray(t)||(t=[t]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=t}),null==this.resolvers["."]&&(this.resolvers["."]=[lL("https://cloudflare-dns.com/dns-query"),lL("https://dns.google/resolve")])}async query(e,t={}){let r=lT(t.types),n=!1!==t.cached?this.cache.get(e,r):void 0;if(null!=n)return t.onProgress?.(new lN("dns:cache",{detail:n})),n;let i=`${e.split(".").pop()}.`,s=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),o=[];for(let n of s){if(t.signal?.aborted===!0)break;try{let i=await n(e,{...t,types:r});for(let t of i.Answer)this.cache.add(e,t);return i}catch(e){o.push(e),t.onProgress?.(new lN("dns:error",{detail:e}))}}if(1===o.length)throw o[0];throw AggregateError(o,`DNS lookup of ${e} ${r} failed`)}}function lU(e={}){return new lP(e)}!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(c||(c={}));let lD=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(let t of e);})();for(let t of e);},lF=new TextEncoder().encode("/"),l$=lF[0];class lM{_buf;constructor(e,t){if("string"==typeof e)this._buf=e7(e);else if(e instanceof Uint8Array)this._buf=e;else throw Error("Invalid key, should be String of Uint8Array");if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==l$)throw Error("Invalid key")}toString(e="utf8"){return ru(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new lM(e.join("/"))}static random(){return new lM(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new lM(e):"function"==typeof e.uint8Array?new lM(e.uint8Array()):null}clean(){if((null==this._buf||0===this._buf.byteLength)&&(this._buf=lF),this._buf[0]!==l$){let e=new Uint8Array(this._buf.byteLength+1);e.fill(l$,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===l$;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;let n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return lM.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split("/").slice(1)}type(){return function(e){let t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){let t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new lM(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith("/")||(e+="/"),new lM(e+=this.type())}parent(){let e=this.list();return new lM(1===e.length?"/":e.slice(0,-1).join("/"))}child(e){return"/"===this.toString()?e:"/"===e.toString()?this:new lM(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return lM.withNamespaces([...this.namespaces(),...[].concat(...e.map(e=>e.namespaces()))])}}function lz({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}class lH{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:r}){if(null==e||null==t||void 0===r)throw Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:lz(),bytes:lz(),value:lz(),asBlock:lz()})}links(){return function* e(t,r){if(null==t||t instanceof Uint8Array)return;let n=eJ.asCID(t);for(let[i,s]of(null!=n&&(yield[r.join("/"),n]),Object.entries(t))){let t=[...r,i];yield*function*(t,r){if(null!=r&&"object"==typeof r){if(Array.isArray(r))for(let[n,i]of r.entries()){let r=[...t,n],s=eJ.asCID(i);null!=s?yield[r.join("/"),s]:"object"==typeof i&&(yield*e(i,r))}else{let n=eJ.asCID(r);null!=n?yield[t.join("/"),n]:yield*e(r,t)}}}(t,s)}}(this.value,[])}tree(){return function* e(t,r){if(null!=t&&"object"==typeof t)for(let[n,i]of Object.entries(t)){let t=[...r,n];yield t.join("/"),null==i||i instanceof Uint8Array||"object"!=typeof i||null!=eJ.asCID(i)||(yield*function*(t,r){if(Array.isArray(r))for(let[n,i]of r.entries()){let r=[...t,n];yield r.join("/"),"object"==typeof i&&null==eJ.asCID(i)&&(yield*e(i,r))}else yield*e(r,t)}(t,i))}}(this.value,[])}get(e="/"){return function(e,t){let r=e;for(let[e,n]of t.entries()){if(null==(r=r[n]))throw Error(`Object has no property at ${t.slice(0,e+1).map(e=>`[${JSON.stringify(e)}]`).join("")}`);let i=eJ.asCID(r);if(null!=i)return{value:i,remaining:t.slice(e+1).join("/")}}return{value:r}}(this.value,e.split("/").filter(Boolean))}}function lV({bytes:e,cid:t,value:r,codec:n}){let i=void 0!==r?r:n?.decode(e);if(void 0===i)throw Error('Missing required argument, must either provide "value" or "codec"');return new lH({cid:t,bytes:e,value:i})}let lq="/pin/",lj="/pinned-block/";function lG(e){return 0===e.version&&(e=e.toV1()),new lM(`${lq}${e.toString(ep)}`)}class lW{datastore;blockstore;getCodec;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.getCodec=r}async *add(e,t={}){let r=lG(e);if(await this.datastore.has(r))throw Error("Already pinned");let n=Math.round(t.depth??1/0);if(n<0)throw Error("Depth must be greater than or equal to 0");let i=new tT({concurrency:1});for await(let r of this.#F(e,i,{...t,depth:n}))await this.#$(r,t=>null==t.pinnedBy.find(t=>e9(t,e.bytes))&&(t.pinCount++,t.pinnedBy.push(e.bytes),!0),t),yield r;let s={depth:n,metadata:t.metadata??{}};await this.datastore.put(r,av(s),t)}async *#F(e,t,r){if(-1===r.depth)return;let n=await this.getCodec(e.code),i=lV({bytes:await this.blockstore.get(e,r),cid:e,codec:n});for await(let[,n]of(yield e,i.links()))yield*await t.add(async()=>this.#F(n,t,{...r,depth:r.depth-1}))}async #$(e,t,r){let n=new lM(`${lj}${ep.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=ax(await this.datastore.get(n,r))}catch(e){if("NotFoundError"!==e.name)throw e}if(t(i)){if(0===i.pinCount&&await this.datastore.has(n)){await this.datastore.delete(n);return}await this.datastore.put(n,av(i),r),r.onProgress?.(new lN("helia:pin:add",e))}}async *rm(e,t={}){let r=lG(e),n=ax(await this.datastore.get(r,t));await this.datastore.delete(r,t);let i=new tT({concurrency:1});for await(let r of this.#F(e,i,{...t,depth:n.depth}))await this.#$(r,t=>(t.pinCount--,t.pinnedBy=t.pinnedBy.filter(t=>e9(t,e.bytes)),!0),{...t,depth:n.depth}),yield r}async *ls(e={}){for await(let{key:t,value:r}of this.datastore.query({prefix:lq+(null!=e.cid?`${e.cid.toString(ep)}`:"")},e)){let e=eJ.parse(t.toString().substring(5),ep),n=ax(r);yield{cid:e,...n}}}async isPinned(e,t={}){let r=new lM(`${lj}${ep.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}async get(e,t){let r=lG(e);return ax(await this.datastore.get(r,t))}async setMetadata(e,t,r){let n=lG(e),i=ax(await this.datastore.get(n,r));i.metadata=t??{},await this.datastore.put(n,av(i),r)}}class lK extends tT{has(e){return null!=this.find(e)}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}let lY=function(...e){let t=[];for(let r of e)null!=r[Symbol.asyncIterator]||t.push(r);return t.length===e.length?function*(){for(let e of t)yield*e}():async function*(){let t=tS({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(e.map(async e=>{for await(let r of e)t.push(r)})),t.end()}catch(e){t.end(e)}}),yield*t}()};class lJ{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??5}async start(){await lB(...this.routers)}async stop(){await lC(...this.routers)}async *findProviders(e,t={}){if(0===this.routers.length)throw new O("No content routers available");let r=new lK({concurrency:this.providerLookupConcurrency});for await(let n of(r.addEventListener("error",()=>{}),lY(r.toGenerator(),...lZ(this.routers,"findProviders").map(r=>r.findProviders(e,t)))))if(null!=n){if(0===n.multiaddrs.length){if(null!=r.find(n.id))continue;r.add(async()=>{try{let e=await this.findPeer(n.id,t);if(0===e.multiaddrs.length)return null;return e}catch(e){return this.log.error("could not load multiaddrs for peer %p",n.id,e),null}},{peerId:n.id,signal:t.signal}).catch(e=>{this.log.error("could not load multiaddrs for peer %p",n.id,e)})}yield n}}async provide(e,t={}){if(0===this.routers.length)throw new O("No content routers available");await Promise.all(lZ(this.routers,"provide").map(async r=>{await r.provide(e,t)}))}async put(e,t,r){await Promise.all(lZ(this.routers,"put").map(async n=>{await n.put(e,t,r)}))}async get(e,t){return Promise.any(lZ(this.routers,"get").map(async r=>r.get(e,t)))}async findPeer(e,t){if(0===this.routers.length)throw new O("No peer routers available");let r=this;for await(let n of lY(...lZ(this.routers,"findPeer").map(n=>(async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}})())))if(null!=n)return n;throw new tp("Could not find peer in routing")}async *getClosestPeers(e,t={}){if(0===this.routers.length)throw new O("No peer routers available");for await(let r of lY(...lZ(this.routers,"getClosestPeers").map(r=>r.getClosestPeers(e,t))))null!=r&&(yield r)}}function lZ(e,t){return e.filter(e=>null!=e[t])}let lX={},lQ=e=>{e.addEventListener("message",t=>{lQ.dispatchEvent("message",e,t)}),null!=e.port&&e.port.addEventListener("message",t=>{lQ.dispatchEvent("message",e,t)})};lQ.addEventListener=(e,t)=>{null==lX[e]&&(lX[e]=[]),lX[e].push(t)},lQ.removeEventListener=(e,t)=>{null!=lX[e]&&(lX[e]=lX[e].filter(e=>e===t))},lQ.dispatchEvent=function(e,t,r){null!=lX[e]&&lX[e].forEach(e=>e(t,r))};let l0="lock:worker:request-read",l1="lock:worker:release-read",l2="lock:master:grant-read",l8="lock:worker:request-write",l6="lock:worker:release-write",l4="lock:master:grant-write",l3=(e=21)=>Math.random().toString().substring(2),l5=(e,t,r,n,i)=>(s,o)=>{if(o.data.type!==r)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(e=>{let t=r=>{if(r?.data==null)return;let i={type:r.data.type,name:r.data.name,identifier:r.data.identifier};i.type===n&&i.identifier===a.identifier&&(s.removeEventListener("message",t),e())};s.addEventListener("message",t)})}}}))},l7=(e,t,r,n)=>async()=>{let i=l3();return globalThis.postMessage({type:t,identifier:i,name:e}),new Promise(t=>{let s=o=>{if(o?.data==null)return;let a={type:o.data.type,identifier:o.data.identifier};a.type===r&&a.identifier===i&&(globalThis.removeEventListener("message",s),t(()=>{globalThis.postMessage({type:n,identifier:i,name:e})}))};globalThis.addEventListener("message",s)})},l9={singleProcess:!1},ue=e=>{if(e=Object.assign({},l9,e),globalThis.document||e.singleProcess){let e=new EventTarget;return lQ.addEventListener("message",l5(e,"requestReadLock",l0,l1,l2)),lQ.addEventListener("message",l5(e,"requestWriteLock",l8,l6,l4)),e}return{isWorker:!0,readLock:e=>l7(e,l0,l2,l1),writeLock:e=>l7(e,l8,l4,l6)}},ut={};async function ur(e,t){let r;let n=new Promise(e=>{r=e});return e.add(async()=>aX((async()=>{await new Promise(e=>{r(()=>{e()})})})(),{milliseconds:t.timeout})),n}let un=(e,t)=>{let r;if(!0===n.isWorker)return{readLock:n.readLock(e,t),writeLock:n.writeLock(e,t)};let i=new a0({concurrency:1});return{async readLock(){if(null!=r)return ur(r,t);let e=r=new a0({concurrency:t.concurrency,autoStart:!1}),n=ur(r,t);return i.add(async()=>{e.start(),await e.onIdle().then(()=>{r===e&&(r=null)})}),n},writeLock:async()=>(r=null,ur(i,t))}},ui={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};class us{lock;child;pins;started;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=function(e){let t=Object.assign({},ui,e);return null==n&&!0!==(n=ue(t)).isWorker&&(n.addEventListener("requestReadLock",e=>{null!=ut[e.data.name]&&ut[e.data.name].readLock().then(async t=>e.data.handler().finally(()=>{t()}))}),n.addEventListener("requestWriteLock",async e=>{null!=ut[e.data.name]&&ut[e.data.name].writeLock().then(async t=>e.data.handler().finally(()=>{t()}))})),null==ut[t.name]&&(ut[t.name]=un(t.name,t)),ut[t.name]}({singleProcess:r.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await lB(this.child),this.started=!0}async stop(){await lC(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,r={}){r?.signal?.throwIfAborted();let n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async *putMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async *getMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async *deleteMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{let r=this;yield*this.child.deleteMany(async function*(){for await(let t of e){if(await r.pins.isPinned(t))throw Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async *getAll(e={}){e?.signal?.throwIfAborted();let t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}}let uo=new lM("/version");async function ua(e){if(!await e.has(uo)){await e.put(uo,e7("1"));return}if(1!==parseInt(ru(await e.get(uo)),10))throw Error("Unknown datastore version, a datastore migration may be required")}function ul(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}let uu={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=eJ.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new om(oy.tag,42),new om(oy.bytes,r)]},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}},uh={...uu,typeEncoders:{...uu.typeEncoders}},uc={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};uc.tags[42]=function(e){if(0!==e[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");return eJ.decode(e.subarray(1))};let ud={...uc,tags:uc.tags.slice()},uf="dag-cbor",up=113,ug=e=>av(e,uu),uy=e=>ax(ul(e),uc);class um extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===oy.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===oy.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[oy.uint.major](e,t){this.prefix(e);let r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[oy.negint.major](e,t){this[oy.uint.major](e,t)}[oy.bytes.major](e,t){throw Error(`${oO} unsupported type: Uint8Array`)}[oy.string.major](e,t){this.prefix(e);let r=oA(JSON.stringify(t.value));e.push(r.length>32?oS(r):r)}[oy.array.major](e,t){this.prefix(e),this.inRecursive.push({type:oy.array,elements:0}),e.push([91])}[oy.map.major](e,t){this.prefix(e),this.inRecursive.push({type:oy.map,elements:0}),e.push([123])}[oy.tag.major](e,t){}[oy.float.major](e,t){if("break"===t.type.name){let t=this.inRecursive.pop();if(t){if(t.type===oy.array)e.push([93]);else if(t.type===oy.map)e.push([125]);else throw Error("Unexpected recursive type; this should not happen!");return}throw Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw Error(`${oO} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name){e.push([116,114,117,101]);return}if("false"===t.type.name){e.push([102,97,108,115,101]);return}if("null"===t.type.name){e.push([110,117,108,108]);return}let r=String(t.value),n=[],i=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),i||46!==n[e]&&101!==n[e]&&69!==n[e]||(i=!0);i||(n.push(46),n.push(48)),e.push(n)}}let uw={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw Error(`${oO} complex map keys are not supported`);let r=e[0],n=t[0];if(r.type!==oy.string||n.type!==oy.string)throw Error(`${oO} non-string map keys are not supported`);if(r<n)return -1;if(r>n)return 1;throw Error(`${oO} unexpected duplicate map keys, this is not supported`)}};function ub(e,t){return t=Object.assign({},uw,t),ab(e,new um,t)}class uv{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw Error(`${oR} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw Error(`${oR} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,r=!1,n=e=>{for(;!this.done();){let t=this.ch();if(e.includes(t))this._pos++;else break}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new om(oy.uint,0,this._pos-e);this._pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw Error(`${oR} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(r)throw Error(`${oR} unexpected token at position ${this._pos}`);r=!0,this._pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this._pos++,!this.done()&&(43===this.ch()||45===this.ch())&&this._pos++,n([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return r?new om(oy.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new om(s>=0?oy.uint:oy.negint,s,this._pos-e):new om(s>=0?oy.uint:oy.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw Error(`${oR} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){let r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){let r=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new om(oy.string,r,t)}}let e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw Error(`${oR} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else if(t>=65&&t<=70)t=t-65+10;else throw Error(`${oR} unexpected unicode escape character at position ${this._pos}`);e=16*e+t,this._pos++}return e},n=()=>{let e,r,n,i;let s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw Error(`${oR} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:s<128&&(o=s);break;case 2:(192&(e=this.data[this._pos+1]))==128&&(i=(31&s)<<6|63&e)>127&&(o=i);break;case 3:e=this.data[this._pos+1],r=this.data[this._pos+2],(192&e)==128&&(192&r)==128&&(i=(15&s)<<12|(63&e)<<6|63&r)>2047&&(i<55296||i>57343)&&(o=i);break;case 4:e=this.data[this._pos+1],r=this.data[this._pos+2],n=this.data[this._pos+3],(192&e)==128&&(192&r)==128&&(192&n)==128&&(i=(15&s)<<18|(63&e)<<12|(63&r)<<6|63&n)>65535&&i<1114112&&(o=i)}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){let i;let s=this.ch();switch(s){case 92:if(this._pos++,this.done())throw Error(`${oR} unexpected string termination at position ${this._pos}`);switch(i=this.ch(),this._pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw Error(`${oR} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new om(oy.string,o_(t),this._pos-e);default:if(s<32)throw Error(`${oR} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):n()}}throw Error(`${oR} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new om(oy.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new om(oy.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new om(oy.null,null,4);case 102:return this.expect([102,97,108,115,101]),new om(oy.false,!1,5);case 116:return this.expect([116,114,117,101]),new om(oy.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw Error(`${oR} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new om(oy.break,void 0,1);if(44!==this.ch())throw Error(`${oR} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new om(oy.break,void 0,1);return this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new om(oy.break,void 0,1);if(44!==this.ch())throw Error(`${oR} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new om(oy.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw Error(`${oR} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw Error(`${oR} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function uE(e){let t=ew.encode(e).slice(1);return[new om(oy.map,1/0,1),new om(oy.string,"/",1),new om(oy.map,1/0,1),new om(oy.string,"bytes",5),new om(oy.string,t,t.length),new om(oy.break,void 0,1),new om(oy.break,void 0,1)]}function uS(e){return uE(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}let uk={typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=eJ.asCID(e);if(!t)return null;let r=t.toString();return[new om(oy.map,1/0,1),new om(oy.string,"/",1),new om(oy.string,r,r.length),new om(oy.break,void 0,1)]},Buffer:uE,Uint8Array:uE,Int8Array:uS,Uint16Array:uS,Int16Array:uS,Uint32Array:uS,Int32Array:uS,Float32Array:uS,Float64Array:uS,Uint8ClampedArray:uS,BigInt64Array:uS,BigUint64Array:uS,DataView:uS,ArrayBuffer:function(e){return uE(new Uint8Array(e))},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};class uA extends uv{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===oy.map){let e=this._next();if(e.type===oy.string&&"/"===e.value){let e=this._next();if(e.type===oy.string){if(this._next().type!==oy.break)throw Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new om(oy.tag,42,0)}if(e.type===oy.map){let e=this._next();if(e.type===oy.string&&"bytes"===e.value){let e=this._next();if(e.type===oy.string){for(let e=0;e<2;e++)if(this._next().type!==oy.break)throw Error("Invalid encoded Bytes form");let t=ew.decode(`m${e.value}`);return new om(oy.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}let ux={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ux.tags[42]=eJ.parse;let uI="dag-json",uB=297,uC=e=>ub(e,uk),uN=e=>{let t=function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e),r=Object.assign(ux,{tokenizer:new uA(t,ux)});return function(e,t){return t=Object.assign({tokenizer:new uv(e,t)},t),ax(e,t)}(t,r)},uT=e=>u_.decode(uC(e)),u_=new TextDecoder,uL=e=>uN(uR.encode(e)),uR=new TextEncoder,uO=new TextDecoder;function uP(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw Error("protobuf: varint overflow");if(t>=e.length)throw Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function uU(e,t){let r;[r,t]=uP(e,t);let n=t+r;if(r<0||n<0)throw Error("protobuf: invalid length");if(n>e.length)throw Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function uD(e,t){let r;return[r,t]=uP(e,t),[7&r,r>>3,t]}let uF=new TextEncoder;function u$(e,t,r){let n=t-=uM(r);for(;r>=0x80000000;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function uM(e){var t;let r;return e%2==0&&e++,Math.floor((r=0,(t=e)>=0x100000000&&(t=Math.floor(t/0x100000000),r=32),t>=65536&&(t>>>=16,r+=16),t>=256&&(t>>>=8,r+=8),(r+uz[t]+6)/7))}let uz=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],uH=["Data","Links"],uV=["Hash","Name","Tsize"],uq=new TextEncoder;function uj(e,t){if(e===t)return 0;let r=e.Name?uq.encode(e.Name):[],n=t.Name?uq.encode(t.Name):[],i=r.length,s=n.length;for(let e=0,t=Math.min(i,s);e<t;++e)if(r[e]!==n[e]){i=r[e],s=n[e];break}return i<s?-1:s<i?1:0}function uG(e,t){return!Object.keys(e).some(e=>!t.includes(e))}function uW(e){if("object"==typeof e.asCID){let t=eJ.asCID(e);if(!t)throw TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=eJ.asCID(e.Hash);try{!r&&("string"==typeof e.Hash?r=eJ.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=eJ.decode(e.Hash)))}catch(e){throw TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function uK(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(void 0!==e.Data){if("string"==typeof e.Data)t.Data=uq.encode(e.Data);else if(e.Data instanceof Uint8Array)t.Data=e.Data;else throw TypeError("Invalid DAG-PB form")}if(void 0!==e.Links){if(Array.isArray(e.Links))t.Links=e.Links.map(uW),t.Links.sort(uj);else throw TypeError("Invalid DAG-PB form")}else t.Links=[];return t}function uY(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw TypeError("Invalid DAG-PB form");if(!uG(e,uH))throw TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw TypeError("Invalid DAG-PB form (bad link)");if(!uG(r,uV))throw TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===r.Hash)throw TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==r.Hash||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize){if("number"!=typeof r.Tsize||r.Tsize%1!=0)throw TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===uj(r,e.Links[t-1]))throw TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function uJ(e,t=[]){return uK({Data:e,Links:t})}function uZ(e,t,r){return uW({Hash:r,Name:e,Tsize:t})}let uX="dag-pb",uQ=112;function u0(e){uY(e);let t={};return e.Links&&(t.Links=e.Links.map(e=>{let t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),e.Data&&(t.Data=e.Data),function(e){let t=function(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+uM(r)}if(e.Links)for(let r of e.Links){let e=function(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+uM(r)}if("string"==typeof e.Name){let r=uF.encode(e.Name).length;t+=1+r+uM(r)}return"number"==typeof e.Tsize&&(t+=1+uM(e.Tsize)),t}(r);t+=1+e+uM(e)}return t}(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=u$(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){let i=function(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw Error("Tsize too large for encoding");r=u$(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){let n=uF.encode(e.Name);r-=n.length,t.set(n,r),r=u$(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=u$(t,r,e.Hash.length)-1,t[r]=10),t.length-r}(e.Links[t],r.subarray(0,n));n-=i,n=u$(r,n,i)-1,r[n]=18}return r}(t)}function u1(e){let t=function(e){let t,r;let n=e.length,i=0,s=!1;for(;i<n;){let n,o;if([n,o,i]=uD(e,i),2!==n)throw Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${n}`);if(1===o){if(r)throw Error("protobuf: (PBNode) duplicate Data section");[r,i]=uU(e,i),t&&(s=!0)}else if(2===o){let r;if(s)throw Error("protobuf: (PBNode) duplicate Links section");t||(t=[]),[r,i]=uU(e,i),t.push(function(e){let t={},r=e.length,n=0;for(;n<r;){let r,i;if([r,i,n]=uD(e,n),1===i){if(t.Hash)throw Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=uU(e,n)}else if(2===i){let i;if(void 0!==t.Name)throw Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Name");[i,n]=uU(e,n),t.Name=uO.decode(i)}else if(3===i){if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=uP(e,n)}else throw Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>r)throw Error("protobuf: (PBLink) unexpected end of data");return t}(r))}else throw Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`)}if(i>n)throw Error("protobuf: (PBNode) unexpected end of data");let o={};return r&&(o.Data=r),o.Links=t||[],o}(e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(e=>{let t={};try{t.Hash=eJ.decode(e.Hash)}catch(e){}if(!t.Hash)throw Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),r}function u2(e){return e?.then!=null}class u8 extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=u8.name;code=u8.code;constructor(e="Open failed"){super(e)}}class u6 extends Error{static name="CloseFailedError";static code="ERR_CLOSE_FAILED";name=u6.name;code=u6.code;constructor(e="Close failed"){super(e)}}class u4 extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=u4.name;code=u4.code;constructor(e="Put failed"){super(e)}}class u3 extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=u3.name;code=u3.code;constructor(e="Get failed"){super(e)}}class u5 extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=u5.name;code=u5.code;constructor(e="Delete failed"){super(e)}}class u7 extends Error{static name="HasFailedError";static code="ERR_HAS_FAILED";name=u7.name;code=u7.code;constructor(e="Has failed"){super(e)}}class u9 extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=u9.name;code=u9.code;constructor(e="Not Found"){super(e)}}class he extends Error{static name="AbortError";static code="ERR_ABORTED";name=he.name;code=he.code;constructor(e="Aborted"){super(e)}}class ht{has(e,t){return Promise.reject(Error(".has is not implemented"))}put(e,t,r){return Promise.reject(Error(".put is not implemented"))}async *putMany(e,t){for await(let{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(Error(".get is not implemented"))}async *getMany(e,t){for await(let r of e)yield{cid:r,block:await this.get(r,t)}}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *deleteMany(e,t){for await(let r of e)await this.delete(r,t),yield r}async *getAll(e){throw Error(".getAll is not implemented")}}class hr extends ht{child;constructor(e){super(),this.child=e}put(e,t){return 0===e.multihash.code||null==this.child?e:this.child.put(e,t)}get(e){if(0===e.multihash.code)return e.multihash.digest;if(null==this.child)throw new u9;return this.child.get(e)}has(e){return 0===e.multihash.code||null!=this.child&&this.child.has(e)}delete(e){if(0!==e.code&&null!=this.child)return this.child.delete(e)}getAll(e){return null!=this.child?this.child.getAll(e):[]}}let hn=function(e,t){let r=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(let n of e)await t(n,r++)&&(yield n)}();let n=a6(e),{value:i,done:s}=n.next();if(!0===s)return function*(){}();let o=t(i,r++);return"function"==typeof o.then?async function*(){for await(let e of(await o&&(yield i),n))await t(e,r++)&&(yield e)}():function*(){for(let e of(!0===o&&(yield i),n))t(e,r++)&&(yield e)}()};function hi(e){return e?.then!=null}let hs=function(e,t){let r=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(let n of e){let e=t(n,r++);hi(e)&&await e,yield n}}();let n=a6(e),{value:i,done:s}=n.next();if(!0===s)return function*(){}();let o=t(i,r++);return"function"==typeof o?.then?async function*(){for await(let e of(yield i,n)){let n=t(e,r++);hi(n)&&await n,yield e}}():function*(){for(let e of(yield i,n))t(e,r++),yield e}()};class ho{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new hr(e.blockstore),this.getHasher=e.getHasher}async put(e,t,r={}){return await this.child.has(e,r)?(r.onProgress?.(new lN("blocks:put:duplicate",e)),e):(r.onProgress?.(new lN("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,t,r))),r.onProgress?.(new lN("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async *putMany(e,t={}){let r=hs(hn(e,async({cid:e})=>{let r=await this.child.has(e,t);return r&&t.onProgress?.(new lN("blocks:put-many:duplicate",e)),!r}),async({cid:e,block:r})=>{t.onProgress?.(new lN("blocks:put-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,r,t)))});t.onProgress?.(new lN("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(r,t)}async get(e,t={}){if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new lN("blocks:get:providers:get",e));let n=await hh(e,this.components.blockBrokers,r,{...t,log:this.log});return t.onProgress?.(new lN("blocks:get:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new lN("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t))),n}return t.onProgress?.(new lN("blocks:get:blockstore:get",e)),this.child.get(e,t)}async *getMany(e,t={}){t.onProgress?.(new lN("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(hs(e,async e=>{if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new lN("blocks:get-many:providers:get",e));let n=await hh(e,this.components.blockBrokers,r,{...t,log:this.log});t.onProgress?.(new lN("blocks:get-many:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new lN("blocks:get-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t)))}}))}async delete(e,t={}){t.onProgress?.(new lN("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async *deleteMany(e,t={}){t.onProgress?.(new lN("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async *getAll(e={}){e.onProgress?.(new lN("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class ha extends ho{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}async start(){await lB(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await lC(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(e,t){let r=this.components.blockBrokers.map(e=>null==e.createSession?e:e.createSession(t));return new hl({blockstore:this.child,blockBrokers:r,getHasher:this.getHasher,logger:this.logger},{root:e})}}class hl extends ho{closeController;constructor(e,t){super(e),this.closeController=new AbortController,D(1/0,this.closeController.signal),this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}async put(e,t,r={}){let n=od([this.closeController.signal,r.signal]);D(1/0,n);try{return await super.put(e,t,{...r,signal:n})}finally{n.clear()}}async *putMany(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{yield*super.putMany(e,{...t,signal:r})}finally{r.clear()}}async get(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{return await super.get(e,{...t,signal:r})}finally{r.clear()}}async *getMany(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{yield*super.getMany(e,{...t,signal:r})}finally{r.clear()}}async delete(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{await super.delete(e,{...t,signal:r})}finally{r.clear()}}async *deleteMany(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{yield*super.deleteMany(e,{...t,signal:r})}finally{r.clear()}}async has(e,t={}){let r=od([this.closeController.signal,t.signal]);D(1/0,r);try{return await super.has(e,{...t,signal:r})}finally{r.clear()}}async *getAll(e={}){let t=od([this.closeController.signal,e.signal]);D(1/0,t);try{yield*super.getAll({...e,signal:t})}finally{t.clear()}}}let hu=(e,t)=>{if(null==t)throw new td(`No hasher configured for multihash code 0x${e.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async r=>{let n=t.digest(r);if(!e9((u2(n)?await n:n).digest,e.multihash.digest))throw new ty("Hash of downloaded block did not match multihash from passed CID")}};async function hh(e,t,r,n){let i=hu(e,r),s=new AbortController,o=od([s.signal,n.signal]);D(1/0,s.signal,o);let a=[];for(let e of t)"function"==typeof e.retrieve&&a.push(e);try{return await Promise.any(a.map(async t=>{try{let r=!1,s=await t.retrieve(e,{...n,signal:o,validateFn:async e=>{await i(e),r=!0}});return r||await i(s),s}catch(t){throw n.log.error("could not retrieve verified block for %c",e,t),t}}))}finally{s.abort(),o.clear()}}class hc{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??{forComponent:e=>r5(e)},this.log=this.logger.forComponent("helia"),this.getHasher=function(e=[],t){let r={[ej.code]:ej,[eG.code]:eG,[ez.code]:ez};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=u2(i)?await i:i).code]=n}if(null!=n)return n;throw new P(`No hasher configured for multihash code 0x${e.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}(e.hashers,e.loadHasher),this.getCodec=function(e=[],t){let r={[uQ]:L,[e_]:B,[up]:T,[uB]:_,[eB]:I};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=u2(i)?await i:i).code]=n}if(null!=n)return n;throw new U(`Could not load codec for ${e}`)}}(e.codecs,e.loadCodec),this.dns=e.dns??lU(),this.metrics=e.metrics;let t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new lJ(t,{routers:(e.routers??[]).flatMap(e=>{let t=[e];return null!=e[r1]&&t.push(e[r1]),null!=e[r2]&&t.push(e[r2]),t}),providerLookupConcurrency:e.providerLookupConcurrency});let r=new ha(t);this.pins=new lW(e.datastore,r,this.getCodec),this.blockstore=new us(r,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(e=>e(t))}async start(){await ua(this.datastore),await lB(this.blockstore,this.datastore,this.routing)}async stop(){await lC(this.blockstore,this.datastore,this.routing)}async gc(e={}){let t=await this.blockstore.lock.writeLock();try{let t=this,r=this.blockstore.unwrap();this.log("gc start"),await lD(r.deleteMany(async function*(){for await(let{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new lN("helia:gc:deleted",n))}catch(r){t.log.error("Error during gc",r),e.onProgress?.(new lN("helia:gc:error",r))}}()))}finally{t()}this.log("gc finished")}}class hd extends ht{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(es.encode(e.multihash.bytes),t),e}get(e){let t=this.data.get(es.encode(e.multihash.bytes));if(null==t)throw new u9;return t}has(e){return this.data.has(es.encode(e.multihash.bytes))}async delete(e){this.data.delete(es.encode(e.multihash.bytes))}async *getAll(){for(let[e,t]of this.data.entries())yield{cid:eJ.createV1(e_,e$(es.decode(e))),block:t}}}r5("blockstore:core:tiered");let hf=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t=[];for await(let r of e)t.push(r);return t})();let t=[];for(let r of e)t.push(r);return t},hp=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=await hf(e);yield*r.sort(t)}():function*(){let r=hf(e);yield*r.sort(t)}()},hg=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1)){for await(let n of e)if(yield n,++r===t)return}}():function*(){let r=0;if(!(t<1)){for(let n of e)if(yield n,++r===t)return}}()};class hy{put(e,t,r){return Promise.reject(Error(".put is not implemented"))}get(e,t){return Promise.reject(Error(".get is not implemented"))}has(e,t){return Promise.reject(Error(".has is not implemented"))}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *putMany(e,t={}){for await(let{key:r,value:n}of e)await this.put(r,n,t),yield r}async *getMany(e,t={}){for await(let r of e)yield{key:r,value:await this.get(r,t)}}async *deleteMany(e,t={}){for await(let r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await lD(this.putMany(e,r)),e=[],await lD(this.deleteMany(t,r)),t=[]}}}async *_all(e,t){throw Error("._all is not implemented")}async *_allKeys(e,t){throw Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){let t=e.prefix;r=hn(r,e=>e.key.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>hn(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>hp(e,t),r)),null!=e.offset){let t=0,n=e.offset;r=hn(r,()=>t++>=n)}return null!=e.limit&&(r=hg(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){let t=e.prefix;r=hn(r,e=>e.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>hn(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>hp(e,t),r)),null!=e.offset){let t=e.offset,n=0;r=hn(r,()=>n++>=t)}return null!=e.limit&&(r=hg(r,e.limit)),r}}class hm extends hy{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){let t=this.data.get(e.toString());if(null==t)throw new u9;return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(let[e,t]of this.data.entries())yield{key:new lM(e),value:t}}*_allKeys(){for(let e of this.data.keys())yield new lM(e)}}function hw(e,...t){if(null==e)throw Error("Empty pipeline");if(hS(e)){let t=e;e=()=>t.source}else if(hE(e)||hv(e)){let t=e;e=()=>t}let r=[e,...t];if(r.length>1&&hS(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)hS(r[e])&&(r[e]=hk(r[e]));return hb(...r)}let hb=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},hv=e=>e?.[Symbol.asyncIterator]!=null,hE=e=>e?.[Symbol.iterator]!=null,hS=e=>null!=e&&null!=e.sink&&null!=e.source,hk=e=>t=>{let r=e.sink(t);if(r?.then!=null){let t;let n=tS({objectMode:!0});r.then(()=>{n.end()},e=>{n.end(e)});let i=e.source;if(hv(i))t=async function*(){yield*i,n.end()};else if(hE(i))t=function*(){yield*i,n.end()};else throw Error("Unknown duplex source type - must be Iterable or AsyncIterable");return lY(n,t())}return e.source};async function hA(e={}){let t=e.datastore??new hm,r=e.blockstore??new hd,n=new hc({...e,datastore:t,blockstore:r,blockBrokers:e.blockBrokers??[r0()],routers:e.routers??[lo("https://delegated-ipfs.dev"),lx()]});return!1!==e.start&&await n.start(),n}new lM("SHARDING"),r5("datastore:core:tiered");var hx=r(61203);let hI={SHA2_256:18,LENGTH:32,DAG_PB:112};function hB(e,t){if(!e.length)throw Error("Unexpected end of data");let r=hx.decode(e);return t.seek(hx.decode.bytes),r}let hC={Int:e=>Number.isInteger(e)?e:void 0,Link:e=>null!==e&&"object"==typeof e&&e.asCID===e?e:void 0,List:e=>Array.isArray(e)?e:void 0,Map:e=>null===e||"object"!=typeof e||e.asCID===e||Array.isArray(e)||e instanceof Uint8Array?void 0:e},hN={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":hC.Link,"CarV1HeaderOrV2Pragma > roots (anon)":e=>{if(void 0!==hC.List(e)){for(let t=0;t<e.length;t++){let r=e[t];if(void 0===(r=hN["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](r)))return;if(r!==e[t]){let r=e.slice(0,t);for(let n=t;n<e.length;n++){let t=e[n];if(void 0===(t=hN["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t)))return;r.push(t)}return r}}return e}},Int:hC.Int,CarV1HeaderOrV2Pragma:e=>{if(void 0===hC.Map(e))return;let t=Object.entries(e),r=e,n=1;for(let i=0;i<t.length;i++){let[s,o]=t[i];switch(s){case"roots":{let n=hN["CarV1HeaderOrV2Pragma > roots (anon)"](e[s]);if(void 0===n)return;if(n!==o||r!==e){if(r===e){r={};for(let e=0;e<i;e++)r[t[e][0]]=t[e][1]}r.roots=n}}break;case"version":{n--;let a=hN.Int(e[s]);if(void 0===a)return;if(a!==o||r!==e){if(r===e){r={};for(let e=0;e<i;e++)r[t[e][0]]=t[e][1]}r.version=a}}break;default:return}}if(!(n>0))return r}},hT={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":hC.Link,"CarV1HeaderOrV2Pragma > roots (anon)":e=>{if(void 0!==hC.List(e)){for(let t=0;t<e.length;t++){let r=e[t];if(void 0===(r=hT["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](r)))return;if(r!==e[t]){let r=e.slice(0,t);for(let n=t;n<e.length;n++){let t=e[n];if(void 0===(t=hT["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t)))return;r.push(t)}return r}}return e}},Int:hC.Int,CarV1HeaderOrV2Pragma:e=>{if(void 0===hC.Map(e))return;let t=Object.entries(e),r=e,n=1;for(let i=0;i<t.length;i++){let[s,o]=t[i];switch(s){case"roots":{let n=hT["CarV1HeaderOrV2Pragma > roots (anon)"](o);if(void 0===n)return;if(n!==o||r!==e){if(r===e){r={};for(let e=0;e<i;e++)r[t[e][0]]=t[e][1]}r.roots=n}}break;case"version":{n--;let s=hT.Int(o);if(void 0===s)return;if(s!==o||r!==e){if(r===e){r={};for(let e=0;e<i;e++)r[t[e][0]]=t[e][1]}r.version=s}}break;default:return}}if(!(n>0))return r}},h_={toTyped:hN.CarV1HeaderOrV2Pragma,toRepresentation:hT.CarV1HeaderOrV2Pragma};async function hL(e,t){let r=hB(await e.upTo(8),e);if(0===r)throw Error("Invalid CAR header (zero length)");let n=uy(await e.exactly(r,!0));if(void 0===h_.toTyped(n))throw Error("Invalid CAR header format");if(1!==n.version&&2!==n.version||void 0!==t&&n.version!==t)throw Error(`Invalid CAR version: ${n.version}${void 0!==t?` (expected ${t})`:""}`);if(1===n.version){if(!Array.isArray(n.roots))throw Error("Invalid CAR header format");return n}if(void 0!==n.roots)throw Error("Invalid CAR header format");let i=function(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=0;return{version:2,characteristics:[t.getBigUint64(r,!0),t.getBigUint64(r+=8,!0)],dataOffset:Number(t.getBigUint64(r+=8,!0)),dataSize:Number(t.getBigUint64(r+=8,!0)),indexOffset:Number(t.getBigUint64(r+=8,!0))}}(await e.exactly(40,!0));return e.seek(i.dataOffset-e.pos),Object.assign(await hL(e,1),i)}async function hR(e){let t=await e.exactly(2,!1);if(t[0]===hI.SHA2_256&&t[1]===hI.LENGTH){let t=e$(await e.exactly(34,!0));return eJ.create(0,hI.DAG_PB,t)}let r=hB(await e.upTo(8),e);if(1!==r)throw Error(`Unexpected CID version (${r})`);let n=hB(await e.upTo(8),e),i=e$(await e.exactly(function(e){hx.decode(e);let t=hx.decode.bytes,r=hx.decode(e.subarray(hx.decode.bytes));return t+hx.decode.bytes+r}(await e.upTo(8)),!0));return eJ.create(r,n,i)}async function hO(e){let t=e.pos,r=hB(await e.upTo(8),e);if(0===r)throw Error("Invalid CAR section (zero length)");r+=e.pos-t;let n=await hR(e),i=r-Number(e.pos-t);return{cid:n,length:r,blockLength:i}}async function hP(e){let{cid:t,blockLength:r}=await hO(e);return{bytes:await e.exactly(r,!0),cid:t}}async function hU(e){let t=e.pos,{cid:r,length:n,blockLength:i}=await hO(e),s={cid:r,length:n,blockLength:i,offset:t,blockOffset:e.pos};return e.seek(s.blockLength),s}function hD(e){let t=(async()=>{let t=await hL(e);if(2===t.version){var r,n;let i;let s=e.pos-t.dataOffset;r=e,n=t.dataSize-s,i=0,e={async upTo(e){let t=await r.upTo(e);return t.length+i>n&&(t=t.subarray(0,n-i)),t},async exactly(e,t=!1){let s=await r.exactly(e,t);if(s.length+i>n)throw Error("Unexpected end of data");return t&&(i+=e),s},seek(e){i+=e,r.seek(e)},get pos(){return r.pos}}}return t})();return{header:()=>t,async *blocks(){for(await t;(await e.upTo(8)).length>0;)yield await hP(e)},async *blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await hU(e)}}}function hF(e){let t=0;return{upTo:async r=>e.subarray(t,t+Math.min(r,e.length-t)),async exactly(r,n=!1){if(r>e.length-t)throw Error("Unexpected end of data");let i=e.subarray(t,t+r);return n&&(t+=r),i},seek(e){t+=e},get pos(){return t}}}function h$(e){let t=e[Symbol.asyncIterator]();return function(e){let t=0,r=0,n=0,i=new Uint8Array(0),s=async t=>{r=i.length-n;let s=[i.subarray(n)];for(;r<t;){let t=await e();if(null==t)break;r<0?t.length>r&&s.push(t.subarray(-r)):s.push(t),r+=t.length}i=new Uint8Array(s.reduce((e,t)=>e+t.length,0));let o=0;for(let e of s)i.set(e,o),o+=e.length;n=0};return{upTo:async e=>(i.length-n<e&&await s(e),i.subarray(n,n+Math.min(i.length-n,e))),async exactly(e,r=!1){if(i.length-n<e&&await s(e),i.length-n<e)throw Error("Unexpected end of data");let o=i.subarray(n,n+e);return r&&(t+=e,n+=e),o},seek(e){t+=e,n+=e},get pos(){return t}}}(async function(){let e=await t.next();return e.done?null:e.value})}ad(),new om(oy.map,2),new om(oy.string,"version"),new om(oy.uint,1),new om(oy.string,"roots"),new om(oy.tag,42);class hM{constructor(e,t,r){this._version=e,this._roots=t,this._iterator=r}get version(){return this._version}async getRoots(){return this._roots}[Symbol.asyncIterator](){return this._iterator}static async fromBytes(e){if(!(e instanceof Uint8Array))throw TypeError("fromBytes() requires a Uint8Array");return hz(hF(e))}static async fromIterable(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw TypeError("fromIterable() requires an async iterable");return hz(h$(e))}}async function hz(e){let t=hD(e),{version:r,roots:n}=await t.header();return new hM(r,n,t.blocksIndex())}class hH{constructor(e,t,r){this._version=e,this._roots=t,this._iterable=r,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class hV extends hH{[Symbol.asyncIterator](){if(this._decoded)throw Error("Cannot decode more than once");if(!this._iterable)throw Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){let{version:t,roots:r,iterator:n}=await hj(e);return new hV(t,r,n)}static async fromIterable(e){let{version:t,roots:r,iterator:n}=await hG(e);return new hV(t,r,n)}}class hq extends hH{[Symbol.asyncIterator](){if(this._decoded)throw Error("Cannot decode more than once");if(!this._iterable)throw Error("Block iterable not found");this._decoded=!0;let e=this._iterable[Symbol.asyncIterator]();return{async next(){let t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){let{version:t,roots:r,iterator:n}=await hj(e);return new hq(t,r,n)}static async fromIterable(e){let{version:t,roots:r,iterator:n}=await hG(e);return new hq(t,r,n)}}async function hj(e){if(!(e instanceof Uint8Array))throw TypeError("fromBytes() requires a Uint8Array");return hW(hF(e))}async function hG(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw TypeError("fromIterable() requires an async iterable");return hW(h$(e))}async function hW(e){let t=hD(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}function hK(e){let t=ug({version:1,roots:e}),r=hx.encode(t.length),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n}function hY(){}class hJ{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw TypeError("Can only write {cid, bytes} objects");if(this._ended)throw Error("Already closed");let t=eJ.asCID(e.cid);if(!t)throw TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}version(){return this._encoder.version()}static create(e){e=function(e){if(void 0===e)return[];if(!Array.isArray(e)){let t=eJ.asCID(e);if(!t)throw TypeError("roots must be a single CID or an array of CIDs");return[t]}let t=[];for(let r of e){let e=eJ.asCID(r);if(!e)throw TypeError("roots must be a single CID or an array of CIDs");t.push(e)}return t}(e);let{encoder:t,iterator:r}=hX();return{writer:new hJ(e,t),out:new hZ(r)}}static createAppender(){let{encoder:e,iterator:t}=hX();return e.setRoots=()=>Promise.resolve(),{writer:new hJ([],e),out:new hZ(t)}}static async updateRootsInBytes(e,t){let r=hF(e);await hL(r);let n=hK(t);if(Number(r.pos)!==n.length)throw Error(`updateRoots() can only overwrite a header of the same length (old header is ${r.pos} bytes, new header is ${n.length} bytes)`);return e.set(n,0),e}}class hZ{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function hX(){let{writer:e,iterator:t}=function(){let e=[],t=null,r=hY,n=!1,i=null,s=hY,o=()=>(t||(t=new Promise(e=>{r=()=>{t=null,r=hY,e()}})),t),a={async next(){let t=e.shift();return t?(0===e.length&&r(),{done:!1,value:t}):n?(r(),{done:!0,value:void 0}):(i||(i=new Promise(e=>{s=()=>(i=null,s=hY,e(a.next()))})),i)}};return{writer:{write(t){e.push(t);let r=o();return s(),r},async end(){n=!0;let e=o();s(),await e}},iterator:a}}();return{encoder:{async setRoots(t){let r=hK(t);await e.write(r)},async writeBlock(t){let{cid:r,bytes:n}=t;await e.write(new Uint8Array(hx.encode(r.bytes.length+n.length))),await e.write(r.bytes),n.length&&await e.write(n)},async close(){await e.end()},version:()=>1},iterator:t}}class hQ{components;constructor(e,t){this.components=e}async import(e,t){await lD(this.components.blockstore.putMany(a4(e.blocks(),({cid:e,bytes:t})=>({cid:e,block:t})),t))}async export(e,t,r){let n=tw(),i=Array.isArray(e)?e:[e],s=new a0({concurrency:1});for(let e of(s.on("idle",()=>{n.resolve()}),s.on("error",e=>{s.clear(),n.reject(e)}),i))s.add(async()=>{await this.#F(e,s,async(e,n)=>{r?.blockFilter?.has(e.multihash.bytes)!==!0&&(r?.blockFilter?.add(e.multihash.bytes),await t.put({cid:e,bytes:n}))},r)}).catch(()=>{});try{await n.promise}finally{await t.close()}}async *stream(e,t){let{writer:r,out:n}=hJ.create(e);for await(let i of(this.export(e,r,t).catch(()=>{}),n))yield i}async #F(e,t,r,n){let i=await this.components.getCodec(e.code),s=await this.components.blockstore.get(e,n);for await(let[,o]of(await r(e,s),lV({bytes:s,cid:e,codec:i}).links()))t.add(async()=>{await this.#F(o,t,r,n)})}}let h0=r5("ipns"),h1=3600*1e9,h2={v1Compatible:!0,ttlNs:3600*1e9};async function h8(e,t,r,n,i=h2){let s=new aH(Date.now()+Number(n)),o=h.ValidityType.EOL,a=BigInt(i.ttlNs??h1);return h6(e,t,r,o,s.toString(),a,i)}let h6=async(e,t,r,n,i,s,o=h2)=>{let a;r=BigInt(r);let l=e7(i),u=function(e){if(null!=e){let t=function(e){if("function"==typeof e?.toCID)return e.toCID();try{return eJ.parse(e)}catch{}return eJ.asCID(e)}(e);if(null!=t)return 114===t.code?`/ipns/${t.toString(ep)}`:`/ipfs/${t.toV1().toString()}`;if(e.bytes instanceof Uint8Array)return`/ipns/${ep.encode(e.bytes)}`;let r=e.toString().trim();if(r.startsWith("/")&&r.length>1)return r}throw new a_("Value must be a valid content path starting with /")}(t),c=e7(u),d=function(e,t,r,n,i){let s;if(t===h.ValidityType.EOL)s=0;else throw new aN("The validity type is unsupported");return av({Value:e,Validity:r,ValidityType:s,Sequence:n,TTL:i})}(c,n,l,r,s),f=aU(d),p=await e.sign(f);if("RSA"===e.type&&(a=ot(e.publicKey)),!0===o.v1Compatible){let t={value:u,signatureV1:await h4(e,c,n,l),validity:i,validityType:n,sequence:r,ttl:s,signatureV2:p,data:d};return null!=a&&(t.pubKey=a),t}{let e={value:u,validity:i,validityType:n,sequence:r,ttl:s,signatureV2:p,data:d};return null!=a&&(e.pubKey=a),e}},h4=async(e,t,r,n)=>{try{let i=rg([t,n,e7(r)]);return await e.sign(i)}catch(e){throw h0.error("record signature creation failed",e),new aI("Record signature creation failed")}};class h3 extends Error{static name="DNSLinkNotFoundError";constructor(e="DNSLink not found"){super(e),this.name="DNSLinkNotFoundError"}}class h5 extends Error{static name="RecordsFailedValidationError";constructor(e="Records failed validation"){super(e),this.name="RecordsFailedValidationError"}}class h7 extends Error{static name="UnsupportedMultibasePrefixError";constructor(e="Unsupported multibase prefix"){super(e),this.name="UnsupportedMultibasePrefixError"}}class h9 extends Error{static name="UnsupportedMultihashCodecError";constructor(e="Unsupported multihash codec"){super(e),this.name="UnsupportedMultihashCodecError"}}class ce extends Error{static name="InvalidValueError";constructor(e="Invalid value"){super(e),this.name="InvalidValueError"}}async function ct(e,t,r,n,i={}){if(0===t)throw Error("recursion limit exceeded");n("query %s for TXT and CNAME records",e);let s=await r.query(e,{...i,types:[c.TXT]}),o=(s?.Answer??[]).sort((e,t)=>e.data.localeCompare(t.data));for(let s of(n("found %d TXT records for %s",o.length,e),o))try{let o=s.data;if(o.startsWith('"')&&o.endsWith('"')&&(o=o.substring(1,o.length-1)),!o.startsWith("dnslink="))continue;n("%s TXT %s",s.name,o);let[,a,l,...u]=(o=o.replace("dnslink=","")).split("/");if("ipfs"===a)try{let e=eJ.parse(l);return{value:`/ipfs/${e}${u.length>0?`/${u.join("/")}`:""}`,answer:s}}catch{}else if("ipns"===a){try{let e=ou(l);return{value:`/ipns/${e}${u.length>0?`/${u.join("/")}`:""}`,answer:s}}catch{}return await cr(l,t-1,r,n,i)}else{if("dnslink"===a)return await cr(l,t-1,r,n,i);n('unknown protocol "%s" in DNSLink record for domain: %s',a,e);continue}}catch(t){n.error("could not parse DNS link record for domain %s, %s",e,s.data,t)}n("no DNSLink records found for %s, falling back to CNAME",e);let a=await r.query(e,{...i,types:[c.CNAME]}),l=(a?.Answer??[]).sort((e,t)=>e.data.localeCompare(t.data));for(let s of(n("found %d CNAME records for %s",l.length,e),l))try{return await cr(s.data,t-1,r,n,i)}catch(t){n.error("domain %s cname %s had no DNSLink records",e,s.data,t)}throw new h3(`No DNSLink records found for domain: ${e}`)}async function cr(e,t,r,n,i={}){if(0===t)throw Error("recursion limit exceeded");e.startsWith("_dnslink.")||(e=`_dnslink.${e}`);try{return await ct(e,t,r,n,i)}catch(s){if("ENOTFOUND"!==s.code&&"ENODATA"!==s.code&&"DNSLinkNotFoundError"!==s.name&&"NotFoundError"!==s.name)throw s;return ct(e=e.startsWith("_dnslink.")?e.replace("_dnslink.",""):`_dnslink.${e}`,t,r,n,i)}}async function cn(e,t,r,n={}){return cr(e,n.maxRecursiveDepth??32,t,r,n)}class ci{routing;constructor(e){this.routing=e}async put(e,t,r={}){try{await this.routing.put(e,t,r)}catch(e){r.onProgress?.(new lN("ipns:routing:helia:error",e))}}async get(e,t={}){try{return await this.routing.get(e,t)}catch(e){t.onProgress?.(new lN("ipns:routing:helia:error",e))}throw Error("Not found")}}!function(e){let t;e.codec=()=>(null==t&&(t=ix((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:e2(0),value:e2(0),timeReceived:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>iS(t,e.codec()),e.decode=(t,r)=>ia(t,e.codec(),r)}(d||(d={}));class cs{key;value;timeReceived;constructor(e,t,r){if(!(e instanceof Uint8Array))throw Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return d.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:function(e){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),s=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=String(1e6*e.getUTCMilliseconds()).padStart(9,"0");return`${t}-${r}-${n}T${i}:${s}:${o}.${a}Z`}(this.timeReceived)}}static deserialize(e){let t=d.decode(e);return new cs(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=function(e){let t=RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw Error("Invalid format");let n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10);return new Date(Date.UTC(n,i,s,o,parseInt(r[5],10),parseInt(r[6],10),parseInt(r[7].slice(0,-6),10)))}(e.timeReceived);if(null==e.key)throw Error("key missing from deserialized object");if(null==e.value)throw Error("value missing from deserialized object");return new cs(e.key,e.value,t)}}function co(e){return new lM("/dht/record/"+ru(e,"base32"),!1)}let ca=r5("helia:ipns"),cl=1000000n*BigInt(36e5),cu={[ep.prefix]:ep,[ey.prefix]:ey};class ch{routers;localStore;timeout;dns;log;constructor(e,t=[]){this.routers=[new ci(e.routing),...t],this.localStore=function(e){return{async put(t,r,n={}){try{let i=co(t);try{let t=await e.get(i),n=cs.deserialize(t);if(e9(n.value,r))return}catch(e){if("NotFoundError"!==e.name)throw e}let s=new cs(t,r,new Date);n.onProgress?.(new lN("ipns:routing:datastore:put")),await e.put(i,s.serialize(),n)}catch(e){throw n.onProgress?.(new lN("ipns:routing:datastore:error",e)),e}},async get(t,r={}){try{let n=co(t);r.onProgress?.(new lN("ipns:routing:datastore:get"));let i=await e.get(n,r),s=cs.deserialize(i);return{record:s.value,created:s.timeReceived}}catch(e){throw r.onProgress?.(new lN("ipns:routing:datastore:error",e)),e}},async has(t,r={}){let n=co(t);return e.has(n,r)},async delete(t,r){let n=co(t);return e.delete(n,r)}}}(e.datastore),this.dns=e.dns,this.log=e.logger.forComponent("helia:ipns")}async publish(e,t,r={}){try{let n=1n,i=a$(e.publicKey.toMultihash());if(await this.localStore.has(i,r)){let{record:e}=await this.localStore.get(i,r);n=aF(e).sequence+1n}let s=await h8(e,t,n,r.lifetime??864e5,r),o=aD(s);return await this.localStore.put(i,o,r),!0!==r.offline&&await Promise.all(this.routers.map(async e=>{await e.put(i,o,r)})),s}catch(e){throw r.onProgress?.(new lN("ipns:publish:error",e)),e}}async resolve(e,t={}){let r=a$(null!=e&&("RSA"===e.type||"Ed25519"===e.type||"secp256k1"===e.type)&&e.raw instanceof Uint8Array&&"function"==typeof e.equals&&"function"==typeof e.toMultihash&&"function"==typeof e.toCID&&"function"==typeof e.verify?e.toMultihash():e),n=await this.#M(r,t);return{...await this.#z(n.value,t),record:n}}async resolveDNSLink(e,t={}){let r=await cn(e,this.dns,this.log,t);return{...await this.#z(r.value,t),answer:r.answer}}republish(e={}){if(null!=this.timeout)throw Error("Republish is already running");async function t(){let r=Date.now();e.onProgress?.(new lN("ipns:republish:start"));let n=828e5-(Date.now()-r);n<0&&(n=e.interval??828e5),setTimeout(()=>{t().catch(e=>{ca.error("error republishing",e)})},n)}e.signal?.addEventListener("abort",()=>{clearTimeout(this.timeout)}),this.timeout=setTimeout(()=>{t().catch(e=>{ca.error("error republishing",e)})},e.interval??828e5)}async #z(e,t={}){let r=e.split("/");try{let e=r[1];if("ipns"===e){let e,n;let i=r[2],s=i.substring(0,1);if("1"===s||"Q"===s)e=ey.decode(`z${i}`);else if(null!=cu[s])e=cu[s].decode(i);else throw new h7(`Unsupported multibase prefix "${s}"`);try{n=e$(e)}catch{n=eJ.decode(e).multihash}if(0!==n.code&&18!==n.code)throw new h9(`Unsupported multihash codec "${n.code}"`);let{cid:o}=await this.resolve(n,t),a=r.slice(3).join("/");return{cid:o,path:a}}if("ipfs"===e){let e=eJ.parse(r[2]),t=r.slice(3).join("/");return{cid:e,path:t}}}catch(e){ca.error("error parsing ipfs path",e)}throw ca.error("invalid ipfs path %s",e),new ce("Invalid value")}async #M(e,t={}){let r=[];if(await this.localStore.has(e,t)){if(ca("record is present in the cache"),!0!==t.nocache)try{let{record:n,created:i}=await this.localStore.get(e,t);this.log("record retrieved from cache"),await aj(e,n),this.log("record was valid");let s=aF(n),o=Number((s.ttl??cl)/1000000n);if(i.getTime()+o>Date.now())return this.log("record TTL was valid"),s;if(!0===t.offline)return this.log("record TTL has been reached but we are resolving offline-only, returning record"),s;this.log("record TTL has been reached, searching routing for updates"),r.push(n)}catch(r){this.log("cached record was invalid",r),await this.localStore.delete(e,t)}else ca("ignoring local cache due to nocache=true option")}if(!0===t.offline)throw new tp("Record was not present in the cache or has expired");ca("did not have record locally");let n=0;if(await Promise.all(this.routers.map(async i=>{let s;try{s=await i.get(e,{...t,validate:!1})}catch(e){ca.error("error finding IPNS record",e);return}try{await aj(e,s),r.push(s)}catch(e){n++,ca.error("error finding IPNS record",e)}})),0===r.length){if(n>0)throw new h5(`${n>1?`${n} records`:"Record"} found for routing key ${n>1?"were":"was"} invalid`);throw new tp("Could not find record for routing key")}let i=r[function(e,t){let r=t.map((e,t)=>({record:aF(e),index:t}));return r.sort((e,t)=>{let r=e.record.sequence,n=t.record.sequence;if(r>n)return -1;if(r<n)return 1;if(e.record.validityType===h.ValidityType.EOL&&t.record.validityType===h.ValidityType.EOL){let r=aH.fromString(e.record.validity).toDate(),n=aH.fromString(t.record.validity).toDate();if(r.getTime()>n.getTime())return -1;if(r.getTime()<n.getTime())return 1}return 0}),r[0].index}(0,r)];return await this.localStore.put(e,i,t),aF(i)}}let cc=function(e){let t;if(null!=e[Symbol.asyncIterator])return(async()=>{let t;for await(let r of e)t=r;return t})();for(let r of e)t=r;return t};class cd extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=cd.name;code=cd.code;constructor(e="Bad path"){super(e)}}class cf extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=cf.name;code=cf.code;constructor(e="Not found"){super(e)}}class cp extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=cp.name;code=cp.code;constructor(e="No resolver"){super(e)}}class cg extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=cg.name;code=cg.code;constructor(e="Not UnixFS"){super(e)}}class cy extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=cy.name;code=cy.code;constructor(e="Over read"){super(e)}}class cm extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=cm.name;code=cm.code;constructor(e="Under read"){super(e)}}class cw extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=cw.name;code=cw.code;constructor(e="No Property found"){super(e)}}class cb extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=cb.name;code=cb.code;constructor(e="Invalid parameters"){super(e)}}function cv(e,t,r,n,i,s,o){let a=e,l=i;for(;s.length>0;){let u=s[0];if(u in a){s.shift(),l=`${l}/${u}`;let h=eJ.asCID(a[u]);if(null!=h)return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}},next:{cid:h,name:u,path:l,toResolve:s}};a=a[u]}else throw new cw(`No property named ${u} found in node ${r}`)}return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}}}}let cE=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return cv(uy(l),l,e,t,r,n,s)},cS=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return cv(uN(l),l,e,t,r,n,s)},ck=function(e,t,r,n){let i=BigInt(t+BigInt(e.length));return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.subarray(0,Number(n-t))),r>=t&&r<i&&(e=e.subarray(Number(r-t))),e)},cA=(e,t=0,r=e)=>{let n=BigInt(e),i=BigInt(t??0),s=BigInt(r);if(s!==n&&(s=i+s),s>n&&(s=n),i<0n)throw new cb("Offset must be greater than or equal to 0");if(i>n)throw new cb("Offset must be less than the file size");if(s<0n)throw new cb("Length must be greater than or equal to 0");if(s>n)throw new cb("Length must be less than the file size");return{start:i,end:s}},cx=e=>async function*(t={}){let{start:r,end:n}=cA(e.length,t.offset,t.length),i=ck(e,0n,r,n);t.onProgress?.(new lN("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},cI=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new cf(`No link named ${r} found in raw node ${e}`);let l=e$(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:cx(l.digest),depth:s,size:BigInt(l.digest.length),node:l.digest}}},cB=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return cv(eN(l),l,e,t,r,n,s)},cC=e=>async function*(t={}){let{start:r,end:n}=cA(e.length,t.offset,t.length),i=ck(e,0n,r,n);t.onProgress?.(new lN("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},cN=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new cf(`No link named ${r} found in raw node ${e}`);let l=await o.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:cC(l),depth:s,size:BigInt(l.length),node:l}}};class cT extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=cT.name;code=cT.code;constructor(e="Invalid type"){super(e)}}!function(e){var t,r;let n,i;(t=e.DataType||(e.DataType={})).Raw="Raw",t.Directory="Directory",t.File="File",t.Metadata="Metadata",t.Symlink="Symlink",t.HAMTShard="HAMTShard",(r=n||(n={}))[r.Raw=0]="Raw",r[r.Directory=1]="Directory",r[r.File=2]="File",r[r.Metadata=3]="Metadata",r[r.Symlink=4]="Symlink",r[r.HAMTShard=5]="HAMTShard",(e.DataType||(e.DataType={})).codec=()=>iA(n),e.codec=()=>(null==i&&(i=ix((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(let e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),p.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r)=>{let n={blocksizes:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){let r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=p.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n})),i),e.encode=t=>iS(t,e.codec()),e.decode=t=>ia(t,e.codec())}(f||(f={})),function(e){let t;e.codec=()=>(null==t&&(t=ix((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r})),t),e.encode=t=>iS(t,e.codec()),e.decode=t=>ia(t,e.codec())}(p||(p={})),function(e){let t;e.codec=()=>(null==t&&(t=ix((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();t>>>3==1?r.MimeType=e.string():e.skipType(7&t)}return r})),t),e.encode=t=>iS(t,e.codec()),e.decode=t=>ia(t,e.codec())}(g||(g={}));let c_={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},cL=["directory","hamt-sharded-directory"],cR=parseInt("0644",8),cO=parseInt("0755",8);class cP{static unmarshal(e){let t=f.decode(e),r=new cP({type:c_[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:r,blockSizes:n,hashType:i,fanout:s,mtime:o,mode:a}=e;if(null!=t&&!Object.values(c_).includes(t))throw new cT("Type: "+t+" is not valid");this.type=t??"file",this.data=r,this.hashType=i,this.fanout=s,this.blockSizes=n??[],this._originalMode=0,this.mode=a,this.mtime=o}set mode(e){null==e?this._mode=this.isDirectory()?cO:cR:this._mode=4095&e}get mode(){return this._mode}isDirectory(){return cL.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e,t,r;switch(this.type){case"raw":e=f.DataType.Raw;break;case"directory":e=f.DataType.Directory;break;case"file":e=f.DataType.File;break;case"metadata":e=f.DataType.Metadata;break;case"symlink":e=f.DataType.Symlink;break;case"hamt-sharded-directory":e=f.DataType.HAMTShard;break;default:throw new cT(`Type: ${e} is not valid`)}let n=this.data;return(null==this.data||0===this.data.length)&&(n=void 0),null!=this.mode&&((t=0xfffff000&this._originalMode|(this.mode??0))!==cR||this.isDirectory()||(t=void 0),t===cO&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),f.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}eH({name:"murmur3-32",code:35,encode:e=>(function(e){let t=[,,,,];for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)})(to.x86.hash32(e))});let cU=eH({name:"murmur3-128",code:34,encode:e=>M(to.x64.hash128(e))});eH({name:"murmur3-x64-64",code:34,encode:e=>M(to.x64.hash128(e)).subarray(0,8)});var cD=r(52669);class cF{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new cD,this.key=null}async put(e,t){let r=await this._findNewBucketAndPos(e);r.bucket._putAt(r,e,t)}async get(e){let t=await this._findChild(e);if(null!=t)return t.value}async del(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((e,t)=>t instanceof cF?e+t.leafCount():e+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){for(let e of this._children.compactArray())e instanceof cF?yield*e.eachLeafSeries():yield e}serialize(e,t){return t(this._children.reduce((r,n,i)=>(null!=n&&(n instanceof cF?r.push(n.serialize(e,t)):r.push(e(n,i))),r),[]))}async asyncTransform(e,t){return cH(this,e,t)}toJSON(){return this.serialize(cM,cz)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof cF)&&null!=r&&r.key===e)return r}async _findPlace(e){let t=this._options.hash("string"==typeof e?e7(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof cF?n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){let e=new cF(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);let r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1){if(1===this._popCount){let e=this._children.find(c$);if(null!=e&&!(e instanceof cF)){let t=e.hash;t.untake(this._options.bits);let r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}}_at(e){return this._children.get(e)}}function c$(e){return!!e}function cM(e,t){return e.key}function cz(e){return e}async function cH(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof cF)await cH(i,t,r);else{let r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return r(n)}let cV=[255,254,252,248,240,224,192,128],cq=[1,3,7,15,31,63,127,255];class cj{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t),s=function(e,t,r){return(e&(cV[t]&cq[Math.min(r+t-1,7)]))>>>t}(e,n-i,i);r=(r<<i)+s,t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}class cG{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t),i=e.take(n);r=(r<<n)+i,t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?rg([this._value,Uint8Array.from([this._depth])]):this._value,t=new cj(await this._hashFn(e));this._buffers.push(t),this._availableBits+=t.availableBits()}}let cW=async function(e){return(await cU.encode(e)).slice(0,8).reverse()},cK=async(e,t,r)=>{let n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map(async e=>{if(null==e.Name)throw Error("Unexpected Link without a Name");if(e.Name.length===n){let n=parseInt(e.Name,16);t._putObjectAt(n,new cF({hash:r._options.hash,bits:r._options.bits},t,n));return}await r.put(e.Name.substring(2),!0)}))},cY=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),cJ=e=>{let t=e.bucket,r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()},cZ=async(e,t,r,n,i)=>{if(null==n){let t;if(null==e.Data)throw new cg("no data in PBNode");try{t=cP.unmarshal(e.Data)}catch(e){throw new cg(e.message)}if("hamt-sharded-directory"!==t.type)throw new cg("not a HAMT");if(null==t.fanout)throw new cg("missing fanout");let r=function(e){var t;if(null==e||null==e.hashFn)throw Error("please define an options.hashFn");return new cF({bits:e.bits??8,hash:(t=e.hashFn,function(e){return e instanceof cG?e:new cG(e,t)})})}({hashFn:cW,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}let s=(n.lastBucket.tableSize()-1).toString(16).length;await cK(e.Links,n.lastBucket,n.rootBucket);let o=await n.rootBucket._findNewBucketAndPos(t),a=cY(o.pos,s),l=cJ(o);l.length>n.hamtDepth&&(n.lastBucket=l[n.hamtDepth],a=cY(n.lastBucket._posAtParent,s));let u=e.Links.find(e=>{if(null==e.Name)return!1;let r=e.Name.substring(0,s),n=e.Name.substring(s);return r===a&&(""===n||n===t)});return null==u?void 0:null!=u.Name&&u.Name.substring(s)===t?u.Hash:(n.hamtDepth++,cZ(e=u1(await r.get(u.Hash,i)),t,r,n,i))},cX=globalThis.CustomEvent??Event;async function*cQ(e,t={}){let r,n=t.concurrency??1/0;n<1&&(n=1/0);let i=null!=t.ordered&&t.ordered,s=new EventTarget,o=[],a=tw(),l=tw(),u=!1,h=!1;function c(){return i?o[0]?.done:!!o.find(e=>e.done)}for(s.addEventListener("task-complete",()=>{l.resolve()}),Promise.resolve().then(async()=>{try{for await(let t of e){if(o.length===n&&(a=tw(),await a.promise),h)break;let e={done:!1};o.push(e),t().then(t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new cX("task-complete"))},t=>{e.done=!0,e.err=t,s.dispatchEvent(new cX("task-complete"))})}u=!0,s.dispatchEvent(new cX("task-complete"))}catch(e){r=e,s.dispatchEvent(new cX("task-complete"))}});;){if(c()||(l=tw(),await l.promise),null!=r)throw r;if(i?yield*function*(){for(;o.length>0&&o[0].done;){let e=o[0];if(o.shift(),e.ok)yield e.value;else throw h=!0,a.resolve(),e.err;a.resolve()}}():yield*function*(){for(;c();)for(let e=0;e<o.length;e++)if(o[e].done){let t=o[e];if(o.splice(e,1),e--,t.ok)yield t.value;else throw h=!0,a.resolve(),t.err;a.resolve()}}(),u&&0===o.length)break}}async function c0(e,t,r,n,i,s,o){let a;if(t instanceof Uint8Array){let e=ck(t,n,i,s);r.push(e);return}if(null==t.Data)throw new cg("no data in PBNode");try{a=cP.unmarshal(t.Data)}catch(e){throw new cg(e.message)}if(null!=a.data){let e=ck(a.data,n,i,s);r.push(e),n+=BigInt(e.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw new cg("Inconsistent block sizes and dag links");for(let e=0;e<t.Links.length;e++){let r=t.Links[e],o=n,u=o+a.blockSizes[e];if((i>=o&&i<u||s>=o&&s<=u||i<o&&s>u)&&l.push({link:r,blockStart:n}),(n=u)>s)break}await hw(l,t=>a4(t,t=>async()=>{let r=await e.get(t.link.Hash,o);return{...t,block:r}}),e=>cQ(e,{ordered:!0,concurrency:o.blockReadConcurrency}),async t=>{for await(let{link:n,block:a,blockStart:l}of t){let t;switch(n.Hash.code){case uQ:t=u1(a);break;case e_:t=a;break;default:r.end(new cg(`Unsupported codec: ${n.Hash.code}`));return}let u=new a0({concurrency:1});u.on("error",e=>{r.end(e)}),u.add(async()=>{o.onProgress?.(new lN("unixfs:exporter:walk:file",{cid:n.Hash})),await c0(e,t,r,l,i,s,o)}),await u.onIdle()}}),n>=s&&r.end()}let c1=(e,t,r,n,i,s,o)=>async function*(n={}){let i=r.fileSize();if(void 0===i)throw Error("File was a directory");let{start:s,end:a}=cA(i,n.offset,n.length);if(0n===a)return;let l=0n,u=a-s,h=tS();for await(let r of(n.onProgress?.(new lN("unixfs:exporter:walk:file",{cid:e})),c0(o,t,h,0n,s,a,n).catch(e=>{h.end(e)}),h))if(null!=r){if((l+=BigInt(r.byteLength))>u)throw h.end(),new cy("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");l===u&&h.end(),n.onProgress?.(new lN("unixfs:exporter:progress:unixfs:file",{bytesRead:l,totalBytes:u,fileSize:i})),yield r}if(l<u)throw new cm("Traversed entire DAG but did not read enough bytes")};async function*c2(e,t,r,n,i,s){let o;let a=e.Links;if(null==e.Data)throw new cg("no data in PBNode");try{o=cP.unmarshal(e.Data)}catch(e){throw new cg(e.message)}if(null==o.fanout)throw new cg("missing fanout");let l=(o.fanout-1n).toString(16).length;for await(let{entries:o}of hw(a,o=>a4(o,o=>async()=>{let a=null!=o.Name?o.Name.substring(l):null;if(null==a||""===a)return e=u1(await i.get(o.Hash,s)),s.onProgress?.(new lN("unixfs:exporter:walk:hamt-sharded-directory",{cid:o.Hash})),{entries:c2(e,t,r,n,i,s)};{let e=await r(o.Hash,a,`${t}/${a}`,[],n+1,i,s);return{entries:null==e.entry?[]:[e.entry]}}}),e=>cQ(e,{ordered:!0,concurrency:s.blockReadConcurrency})))yield*o}let c8=(e,t)=>{let r=e.Links.find(e=>e.Name===t);return r?.Hash},c6={raw:c1,file:c1,directory:(e,t,r,n,i,s,o)=>async function*(r={}){let a=r.offset??0,l=r.length??t.Links.length,u=t.Links.slice(a,l);r.onProgress?.(new lN("unixfs:exporter:walk:directory",{cid:e})),yield*hw(u,e=>a4(e,e=>async()=>{let t=e.Name??"",a=`${n}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,r)).entry}),e=>cQ(e,{ordered:!0,concurrency:r.blockReadConcurrency}),e=>hn(e,e=>null!=e))},"hamt-sharded-directory":(e,t,r,n,i,s,o)=>function(r={}){return r.onProgress?.(new lN("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),c2(t,n,i,s,o,r)},metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]},c4={[uQ]:async(e,t,r,n,i,s,o,a)=>{let l,u;let h=u1(await o.get(e,a));if(null==t&&(t=e.toString()),null==h.Data)throw new cg("no data in PBNode");try{l=cP.unmarshal(h.Data)}catch(e){throw new cg(e.message)}if(null==r&&(r=t),n.length>0){let e;if(null==(e=l?.type==="hamt-sharded-directory"?await cZ(h,n[0],o):c8(h,n[0])))throw new cf("file does not exist");let t=n.shift(),i=`${r}/${t}`;u={cid:e,toResolve:n,name:t??"",path:i}}let c=c6[l.type](e,h,l,r,i,s,o);if(null==c)throw new cf("could not find content exporter");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:c,unixfs:l,depth:s,node:h,size:l.fileSize()},next:u}:{entry:{type:"file",name:t,path:r,cid:e,content:c,unixfs:l,depth:s,node:h,size:l.fileSize()},next:u}},[e_]:cN,[up]:cE,[uB]:cS,[ez.code]:cI,[eB]:cB},c3=async(e,t,r,n,i,s,o)=>{let a=c4[e.code];if(null==a)throw new cp(`No resolver for code ${e.code}`);return a(e,t,r,n,c3,i,s,o)},c5=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),c7=e=>{if(e instanceof Uint8Array)return{cid:eJ.decode(e),toResolve:[]};let t=eJ.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));let t=c5(e);return{cid:eJ.parse(t[0]),toResolve:t.slice(1)}}throw new cd(`Unknown path type ${e}`)};async function*c9(e,t,r={}){let{cid:n,toResolve:i}=c7(e),s=n.toString(),o=s,a=i.length;for(;;){let l=await c3(n,s,o,i,a,t,r);if(null==l.entry&&null==l.next)throw new cf(`Could not resolve ${e}`);if(null!=l.entry&&(yield l.entry),null==l.next)return;i=l.next.toResolve,n=l.next.cid,s=l.next.name,o=l.next.path}}async function de(e,t,r={}){let n=await cc(c9(e,t,r));if(null==n)throw new cf(`Could not resolve ${e}`);return n}async function*dt(e,t,r={}){let n=await de(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(let e of i(n,r))yield e;async function*i(e,t){for await(let r of e.content(t))yield r,r instanceof Uint8Array||"directory"!==r.type||(yield*i(r,t))}}function dr(e,t={}){let r=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw Error("argument is not an iterator or iterable")}(e);return new globalThis.ReadableStream({_cancelled:!1,async start(){this._cancelled=!1},async pull(e){try{let{value:t,done:n}=await r.next();if(this._cancelled)return;if(!0===n){e.close();return}e.enqueue(t)}catch(t){e.error(t)}},cancel(){this._cancelled=!0}},t)}var dn=r(65606);let di="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,ds=new Set,da="object"==typeof dn&&dn?dn:{},dl=(e,t,r,n)=>{"function"==typeof da.emitWarning?da.emitWarning(e,t,r,n):console.error(`[${r}] ${t}: ${e}`)},du=globalThis.AbortController,dh=globalThis.AbortSignal;if(void 0===du){dh=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},du=class{constructor(){t()}signal=new dh;abort(e){if(!this.signal.aborted){for(let t of(this.signal.reason=e,this.signal.aborted=!0,this.signal._onabort))t(e);this.signal.onabort?.(e)}}};let e=da.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{e&&(e=!1,dl("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}let dc=e=>!ds.has(e);Symbol("type");let dd=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),df=e=>dd(e)?e<=256?Uint8Array:e<=65536?Uint16Array:e<=0x100000000?Uint32Array:e<=Number.MAX_SAFE_INTEGER?dp:null:null;class dp extends Array{constructor(e){super(e),this.fill(0)}}class dg{heap;length;static #H=!1;static create(e){let t=df(e);if(!t)return[];dg.#H=!0;let r=new dg(e,t);return dg.#H=!1,r}constructor(e,t){if(!dg.#H)throw TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class dy{#V;#q;#j;#G;#W;#K;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#Y;#J;#Z;#X;#Q;#B;#ee;#et;#er;#en;#ei;#es;#eo;#ea;#el;#eu;#eh;static unsafeExposeInternals(e){return{starts:e.#eo,ttls:e.#ea,sizes:e.#es,keyMap:e.#Z,keyList:e.#X,valList:e.#Q,next:e.#B,prev:e.#ee,get head(){return e.#et},get tail(){return e.#er},free:e.#en,isBackgroundFetch:t=>e.#ec(t),backgroundFetch:(t,r,n,i)=>e.#ed(t,r,n,i),moveToTail:t=>e.#ef(t),indexes:t=>e.#ep(t),rindexes:t=>e.#eg(t),isStale:t=>e.#ey(t)}}get max(){return this.#V}get maxSize(){return this.#q}get calculatedSize(){return this.#J}get size(){return this.#Y}get fetchMethod(){return this.#W}get memoMethod(){return this.#K}get dispose(){return this.#j}get disposeAfter(){return this.#G}constructor(e){let{max:t=0,ttl:r,ttlResolution:n=1,ttlAutopurge:i,updateAgeOnGet:s,updateAgeOnHas:o,allowStale:a,dispose:l,disposeAfter:u,noDisposeOnSet:h,noUpdateTTL:c,maxSize:d=0,maxEntrySize:f=0,sizeCalculation:p,fetchMethod:g,memoMethod:y,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:b,allowStaleOnFetchAbort:v,ignoreFetchAbort:E}=e;if(0!==t&&!dd(t))throw TypeError("max option must be a nonnegative integer");let S=t?df(t):Array;if(!S)throw Error("invalid max value: "+t);if(this.#V=t,this.#q=d,this.maxEntrySize=f||this.#q,this.sizeCalculation=p,this.sizeCalculation){if(!this.#q&&!this.maxEntrySize)throw TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw TypeError("sizeCalculation set to non-function")}if(void 0!==y&&"function"!=typeof y)throw TypeError("memoMethod must be a function if defined");if(this.#K=y,void 0!==g&&"function"!=typeof g)throw TypeError("fetchMethod must be a function if specified");if(this.#W=g,this.#eu=!!g,this.#Z=new Map,this.#X=Array(t).fill(void 0),this.#Q=Array(t).fill(void 0),this.#B=new S(t),this.#ee=new S(t),this.#et=0,this.#er=0,this.#en=dg.create(t),this.#Y=0,this.#J=0,"function"==typeof l&&(this.#j=l),"function"==typeof u?(this.#G=u,this.#ei=[]):(this.#G=void 0,this.#ei=void 0),this.#el=!!this.#j,this.#eh=!!this.#G,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!c,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!b,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!E,0!==this.maxEntrySize){if(0!==this.#q&&!dd(this.#q))throw TypeError("maxSize must be a positive integer if specified");if(!dd(this.maxEntrySize))throw TypeError("maxEntrySize must be a positive integer if specified");this.#em()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!s,this.updateAgeOnHas=!!o,this.ttlResolution=dd(n)||0===n?n:1,this.ttlAutopurge=!!i,this.ttl=r||0,this.ttl){if(!dd(this.ttl))throw TypeError("ttl must be a positive integer if specified");this.#ew()}if(0===this.#V&&0===this.ttl&&0===this.#q)throw TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#V&&!this.#q){let e="LRU_CACHE_UNBOUNDED";dc(e)&&(ds.add(e),dl("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,dy))}}getRemainingTTL(e){return this.#Z.has(e)?1/0:0}#ew(){let e=new dp(this.#V),t=new dp(this.#V);this.#ea=e,this.#eo=t,this.#eb=(r,n,i=di.now())=>{if(t[r]=0!==n?i:0,e[r]=n,0!==n&&this.ttlAutopurge){let e=setTimeout(()=>{this.#ey(r)&&this.#ev(this.#X[r],"expire")},n+1);e.unref&&e.unref()}},this.#eE=r=>{t[r]=0!==e[r]?di.now():0},this.#eS=(i,s)=>{if(e[s]){let o=e[s],a=t[s];if(!o||!a)return;i.ttl=o,i.start=a,i.now=r||n();let l=i.now-a;i.remainingTTL=o-l}};let r=0,n=()=>{let e=di.now();if(this.ttlResolution>0){r=e;let t=setTimeout(()=>r=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=i=>{let s=this.#Z.get(i);if(void 0===s)return 0;let o=e[s],a=t[s];return o&&a?o-((r||n())-a):1/0},this.#ey=i=>{let s=t[i],o=e[i];return!!o&&!!s&&(r||n())-s>o}}#eE=()=>{};#eS=()=>{};#eb=()=>{};#ey=()=>!1;#em(){let e=new dp(this.#V);this.#J=0,this.#es=e,this.#ek=t=>{this.#J-=e[t],e[t]=0},this.#eA=(e,t,r,n)=>{if(this.#ec(t))return 0;if(!dd(r)){if(n){if("function"!=typeof n)throw TypeError("sizeCalculation must be a function");if(!dd(r=n(t,e)))throw TypeError("sizeCalculation return invalid (expect positive integer)")}else throw TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.")}return r},this.#ex=(t,r,n)=>{if(e[t]=r,this.#q){let r=this.#q-e[t];for(;this.#J>r;)this.#eI(!0)}this.#J+=e[t],n&&(n.entrySize=r,n.totalCalculatedSize=this.#J)}}#ek=e=>{};#ex=(e,t,r)=>{};#eA=(e,t,r,n)=>{if(r||n)throw TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#ep({allowStale:e=this.allowStale}={}){if(this.#Y)for(let t=this.#er;this.#eB(t)&&((e||!this.#ey(t))&&(yield t),t!==this.#et);)t=this.#ee[t]}*#eg({allowStale:e=this.allowStale}={}){if(this.#Y)for(let t=this.#et;this.#eB(t)&&((e||!this.#ey(t))&&(yield t),t!==this.#er);)t=this.#B[t]}#eB(e){return void 0!==e&&this.#Z.get(this.#X[e])===e}*entries(){for(let e of this.#ep())void 0===this.#Q[e]||void 0===this.#X[e]||this.#ec(this.#Q[e])||(yield[this.#X[e],this.#Q[e]])}*rentries(){for(let e of this.#eg())void 0===this.#Q[e]||void 0===this.#X[e]||this.#ec(this.#Q[e])||(yield[this.#X[e],this.#Q[e]])}*keys(){for(let e of this.#ep()){let t=this.#X[e];void 0===t||this.#ec(this.#Q[e])||(yield t)}}*rkeys(){for(let e of this.#eg()){let t=this.#X[e];void 0===t||this.#ec(this.#Q[e])||(yield t)}}*values(){for(let e of this.#ep())void 0===this.#Q[e]||this.#ec(this.#Q[e])||(yield this.#Q[e])}*rvalues(){for(let e of this.#eg())void 0===this.#Q[e]||this.#ec(this.#Q[e])||(yield this.#Q[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#ep()){let n=this.#Q[r],i=this.#ec(n)?n.__staleWhileFetching:n;if(void 0!==i&&e(i,this.#X[r],this))return this.get(this.#X[r],t)}}forEach(e,t=this){for(let r of this.#ep()){let n=this.#Q[r],i=this.#ec(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#X[r],this)}}rforEach(e,t=this){for(let r of this.#eg()){let n=this.#Q[r],i=this.#ec(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#X[r],this)}}purgeStale(){let e=!1;for(let t of this.#eg({allowStale:!0}))this.#ey(t)&&(this.#ev(this.#X[t],"expire"),e=!0);return e}info(e){let t=this.#Z.get(e);if(void 0===t)return;let r=this.#Q[t],n=this.#ec(r)?r.__staleWhileFetching:r;if(void 0===n)return;let i={value:n};if(this.#ea&&this.#eo){let e=this.#ea[t],r=this.#eo[t];if(e&&r){let t=e-(di.now()-r);i.ttl=t,i.start=Date.now()}}return this.#es&&(i.size=this.#es[t]),i}dump(){let e=[];for(let t of this.#ep({allowStale:!0})){let r=this.#X[t],n=this.#Q[t],i=this.#ec(n)?n.__staleWhileFetching:n;if(void 0===i||void 0===r)continue;let s={value:i};if(this.#ea&&this.#eo){s.ttl=this.#ea[t];let e=di.now()-this.#eo[t];s.start=Math.floor(Date.now()-e)}this.#es&&(s.size=this.#es[t]),e.unshift([r,s])}return e}load(e){for(let[t,r]of(this.clear(),e)){if(r.start){let e=Date.now()-r.start;r.start=di.now()-e}this.set(t,r.value,r)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;let{ttl:n=this.ttl,start:i,noDisposeOnSet:s=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=r,{noUpdateTTL:l=this.noUpdateTTL}=r,u=this.#eA(e,t,r.size||0,o);if(this.maxEntrySize&&u>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#ev(e,"set"),this;let h=0===this.#Y?void 0:this.#Z.get(e);if(void 0===h)h=0===this.#Y?this.#er:0!==this.#en.length?this.#en.pop():this.#Y===this.#V?this.#eI(!1):this.#Y,this.#X[h]=e,this.#Q[h]=t,this.#Z.set(e,h),this.#B[this.#er]=h,this.#ee[h]=this.#er,this.#er=h,this.#Y++,this.#ex(h,u,a),a&&(a.set="add"),l=!1;else{this.#ef(h);let r=this.#Q[h];if(t!==r){if(this.#eu&&this.#ec(r)){r.__abortController.abort(Error("replaced"));let{__staleWhileFetching:t}=r;void 0!==t&&!s&&(this.#el&&this.#j?.(t,e,"set"),this.#eh&&this.#ei?.push([t,e,"set"]))}else!s&&(this.#el&&this.#j?.(r,e,"set"),this.#eh&&this.#ei?.push([r,e,"set"]));if(this.#ek(h),this.#ex(h,u,a),this.#Q[h]=t,a){a.set="replace";let e=r&&this.#ec(r)?r.__staleWhileFetching:r;void 0!==e&&(a.oldValue=e)}}else a&&(a.set="update")}if(0===n||this.#ea||this.#ew(),this.#ea&&(l||this.#eb(h,n,i),a&&this.#eS(a,h)),!s&&this.#eh&&this.#ei){let e;let t=this.#ei;for(;e=t?.shift();)this.#G?.(...e)}return this}pop(){try{for(;this.#Y;){let e=this.#Q[this.#et];if(this.#eI(!0),this.#ec(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#eh&&this.#ei){let e;let t=this.#ei;for(;e=t?.shift();)this.#G?.(...e)}}}#eI(e){let t=this.#et,r=this.#X[t],n=this.#Q[t];return this.#eu&&this.#ec(n)?n.__abortController.abort(Error("evicted")):(this.#el||this.#eh)&&(this.#el&&this.#j?.(n,r,"evict"),this.#eh&&this.#ei?.push([n,r,"evict"])),this.#ek(t),e&&(this.#X[t]=void 0,this.#Q[t]=void 0,this.#en.push(t)),1===this.#Y?(this.#et=this.#er=0,this.#en.length=0):this.#et=this.#B[t],this.#Z.delete(r),this.#Y--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=t,i=this.#Z.get(e);if(void 0!==i){let e=this.#Q[i];if(this.#ec(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#ey(i))return r&&this.#eE(i),n&&(n.has="hit",this.#eS(n,i)),!0;n&&(n.has="stale",this.#eS(n,i))}else n&&(n.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,n=this.#Z.get(e);if(void 0===n||!r&&this.#ey(n))return;let i=this.#Q[n];return this.#ec(i)?i.__staleWhileFetching:i}#ed(e,t,r,n){let i=void 0===t?void 0:this.#Q[t];if(this.#ec(i))return i;let s=new du,{signal:o}=r;o?.addEventListener("abort",()=>s.abort(o.reason),{signal:s.signal});let a={signal:s.signal,options:r,context:n},l=(n,i=!1)=>{let{aborted:o}=s.signal,l=r.ignoreFetchAbort&&void 0!==n;return(r.status&&(o&&!i?(r.status.fetchAborted=!0,r.status.fetchError=s.signal.reason,l&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),!o||l||i)?(this.#Q[t]===h&&(void 0===n?h.__staleWhileFetching?this.#Q[t]=h.__staleWhileFetching:this.#ev(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,n,a.options))),n):u(s.signal.reason)},u=n=>{let{aborted:i}=s.signal,o=i&&r.allowStaleOnFetchAbort,a=o||r.allowStaleOnFetchRejection,l=a||r.noDeleteOnFetchRejection;if(this.#Q[t]!==h||(l&&void 0!==h.__staleWhileFetching?o||(this.#Q[t]=h.__staleWhileFetching):this.#ev(e,"fetch")),a)return r.status&&void 0!==h.__staleWhileFetching&&(r.status.returnedStale=!0),h.__staleWhileFetching;if(h.__returned===h)throw n};r.status&&(r.status.fetchDispatched=!0);let h=new Promise((t,n)=>{let o=this.#W?.(e,i,a);o&&o instanceof Promise&&o.then(e=>t(void 0===e?void 0:e),n),s.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>l(e,!0)))})}).then(l,e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),u(e))),c=Object.assign(h,{__abortController:s,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,c,{...a.options,status:void 0}),t=this.#Z.get(e)):this.#Q[t]=c,c}#ec(e){return!!this.#eu&&!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof du}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:c=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:f=this.allowStaleOnFetchAbort,context:p,forceRefresh:g=!1,status:y,signal:m}=t;if(!this.#eu)return y&&(y.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:y});let w={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:s,noDisposeOnSet:o,size:a,sizeCalculation:l,noUpdateTTL:u,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:c,allowStaleOnFetchAbort:f,ignoreFetchAbort:d,status:y,signal:m},b=this.#Z.get(e);if(void 0===b){y&&(y.fetch="miss");let t=this.#ed(e,b,w,p);return t.__returned=t}{let t=this.#Q[b];if(this.#ec(t)){let e=r&&void 0!==t.__staleWhileFetching;return y&&(y.fetch="inflight",e&&(y.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let i=this.#ey(b);if(!g&&!i)return y&&(y.fetch="hit"),this.#ef(b),n&&this.#eE(b),y&&this.#eS(y,b),t;let s=this.#ed(e,b,w,p),o=void 0!==s.__staleWhileFetching&&r;return y&&(y.fetch=i?"stale":"refresh",o&&i&&(y.returnedStale=!0)),o?s.__staleWhileFetching:s.__returned=s}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(void 0===r)throw Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#K;if(!r)throw Error("no memoMethod provided to constructor");let{context:n,forceRefresh:i,...s}=t,o=this.get(e,s);if(!i&&void 0!==o)return o;let a=r(e,o,{options:s,context:n});return this.set(e,a,s),a}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:s}=t,o=this.#Z.get(e);if(void 0!==o){let t=this.#Q[o],a=this.#ec(t);return(s&&this.#eS(s,o),this.#ey(o))?(s&&(s.get="stale"),a)?(s&&r&&void 0!==t.__staleWhileFetching&&(s.returnedStale=!0),r?t.__staleWhileFetching:void 0):(i||this.#ev(e,"expire"),s&&r&&(s.returnedStale=!0),r?t:void 0):(s&&(s.get="hit"),a)?t.__staleWhileFetching:(this.#ef(o),n&&this.#eE(o),t)}s&&(s.get="miss")}#eC(e,t){this.#ee[t]=e,this.#B[e]=t}#ef(e){e!==this.#er&&(e===this.#et?this.#et=this.#B[e]:this.#eC(this.#ee[e],this.#B[e]),this.#eC(this.#er,e),this.#er=e)}delete(e){return this.#ev(e,"delete")}#ev(e,t){let r=!1;if(0!==this.#Y){let n=this.#Z.get(e);if(void 0!==n){if(r=!0,1===this.#Y)this.#eN(t);else{this.#ek(n);let r=this.#Q[n];if(this.#ec(r)?r.__abortController.abort(Error("deleted")):(this.#el||this.#eh)&&(this.#el&&this.#j?.(r,e,t),this.#eh&&this.#ei?.push([r,e,t])),this.#Z.delete(e),this.#X[n]=void 0,this.#Q[n]=void 0,n===this.#er)this.#er=this.#ee[n];else if(n===this.#et)this.#et=this.#B[n];else{let e=this.#ee[n];this.#B[e]=this.#B[n];let t=this.#B[n];this.#ee[t]=this.#ee[n]}this.#Y--,this.#en.push(n)}}}if(this.#eh&&this.#ei?.length){let e;let t=this.#ei;for(;e=t?.shift();)this.#G?.(...e)}return r}clear(){return this.#eN("delete")}#eN(e){for(let t of this.#eg({allowStale:!0})){let r=this.#Q[t];if(this.#ec(r))r.__abortController.abort(Error("deleted"));else{let n=this.#X[t];this.#el&&this.#j?.(r,n,e),this.#eh&&this.#ei?.push([r,n,e])}}if(this.#Z.clear(),this.#Q.fill(void 0),this.#X.fill(void 0),this.#ea&&this.#eo&&(this.#ea.fill(0),this.#eo.fill(0)),this.#es&&this.#es.fill(0),this.#et=0,this.#er=0,this.#en.length=0,this.#J=0,this.#Y=0,this.#eh&&this.#ei){let e;let t=this.#ei;for(;e=t?.shift();)this.#G?.(...e)}}}class dm extends Error{static name="InvalidRangeError";constructor(e="Invalid range request"){super(e),this.name="InvalidRangeError"}}class dw extends Error{static name="NoContentError";constructor(e="No content found"){super(e),this.name="NoContentError"}}class db extends Error{static name="SubdomainNotSupportedError";constructor(e="Subdomain not supported"){super(e),this.name="SubdomainNotSupportedError"}}function dv(e,t){null!=t&&e.headers.set("X-Ipfs-Roots",t.map(e=>e.toV1().toString()).join(","))}class dE{headers;isRangeRequest;_fileSize;_body=null;rangeRequestHeader;log;requestRangeStart;requestRangeEnd;byteStart;byteEnd;byteSize;constructor(e,t){if(this.headers=t,this.log=e.forComponent("helia:verified-fetch:byte-range-context"),this.rangeRequestHeader=function(e,t){if(null==e)return;if(e instanceof Headers)return e.get(t)??void 0;if(Array.isArray(e)){let r=e.find(([e])=>e.toLowerCase()===t.toLowerCase());return r?.[1]}let r=Object.keys(e).find(e=>e.toLowerCase()===t.toLowerCase());if(null!=r)return e[r]}(this.headers,"Range"),null!=this.rangeRequestHeader){this.isRangeRequest=!0,this.log.trace("range request detected");try{let{start:e,end:t}=function(e){let t=e.match(/^bytes=(?<start>\d+)?-(?<end>\d+)?$/);if(t?.groups==null)throw new dm("Invalid range request");let{start:r,end:n}=t.groups;return{start:r,end:n}}(this.rangeRequestHeader);this.requestRangeStart=null!=e?parseInt(e):null,this.requestRangeEnd=null!=t?parseInt(t):null}catch(e){this.log.error("error parsing range request header: %o",e),this.requestRangeStart=null,this.requestRangeEnd=null}this.setOffsetDetails()}else this.log.trace("no range request detected"),this.isRangeRequest=!1,this.requestRangeStart=null,this.requestRangeEnd=null}setBody(e){this._body=e,this.setFileSize(this._fileSize??("string"==typeof e?e.length:e instanceof ArrayBuffer||e instanceof Uint8Array?e.byteLength:e instanceof Blob?e.size:(ReadableStream,null))),this.log.trace("set request body with fileSize %o",this._fileSize)}getBody(){let e=this._body;if(null==e)return this.log.trace("body is null"),e;if(!this.isRangeRequest||!this.isValidRangeRequest)return this.log.trace("returning body unmodified for non-range, or invalid range, request"),e;let t=this.byteStart,r=this.byteEnd,n=this.byteSize;return null!=t||null!=r?(this.log.trace("returning body with byteStart=%o, byteEnd=%o, byteSize=%o",t,r,n),e instanceof ReadableStream)?e:this.getSlicedBody(e):(this.log.error("returning unmodified body for valid range request"),e)}getSlicedBody(e){let t=this.byteStart??0,r=null==this.byteEnd?void 0:this.byteEnd+1;return this.log.trace("returning body with offset %o and length %o",t,r),e.slice(t,r)}setFileSize(e){this._fileSize=null!=e?Number(e):null,this.log.trace("set _fileSize to %o",this._fileSize),this.setOffsetDetails()}getFileSize(){return this._fileSize}isValidByteStart(){return null==this.byteStart||!(this.byteStart<0)&&(null==this._fileSize||!(this.byteStart>=this._fileSize))&&(null==this.byteEnd||!(this.byteStart>this.byteEnd))}isValidByteEnd(){return null==this.byteEnd||!(this.byteEnd<0)&&(null==this._fileSize||!(this.byteEnd>=this._fileSize))&&(null==this.byteStart||!(this.byteEnd<this.byteStart))}get isValidRangeRequest(){if(!this.isRangeRequest)return!1;if(null==this.requestRangeStart&&null==this.requestRangeEnd)return this.log.trace("invalid range request, range request values not provided"),!1;if(!this.isValidByteStart())return this.log.trace("invalid range request, byteStart is less than 0 or greater than fileSize"),!1;if(!this.isValidByteEnd())return this.log.trace("invalid range request, byteEnd is less than 0 or greater than fileSize"),!1;if(null!=this.requestRangeEnd&&null!=this.requestRangeStart){if(this.requestRangeStart>this.requestRangeEnd)return this.log.trace("invalid range request, start is greater than end"),!1;if(this.requestRangeStart<0)return this.log.trace("invalid range request, start is less than 0"),!1;if(this.requestRangeEnd<0)return this.log.trace("invalid range request, end is less than 0"),!1}return null!=this.byteEnd||null!=this.byteStart||null!=this.byteSize||(this.log.trace("invalid range request, could not calculate byteStart, byteEnd, or byteSize"),!1)}get offset(){return this.byteStart??0}get length(){return null!=this.byteEnd&&null!=this.byteStart&&this.byteStart===this.byteEnd?1:null!=this.byteEnd?this.byteEnd+1:null!=this.byteSize?this.byteSize-1:void 0}setOffsetDetails(){if(null==this.requestRangeStart&&null==this.requestRangeEnd){this.log.trace("requestRangeStart and requestRangeEnd are null");return}try{let{start:e,end:t,byteSize:r}=function(e,t,r){if((e??0)>(t??1/0))throw new dm("Invalid range: Range-start index is greater than range-end index.");if(null!=e&&(t??0)>=(r??1/0))throw new dm("Invalid range: Range-end index is greater than or equal to the size of the file.");if(null==e&&(t??0)>(r??1/0))throw new dm("Invalid range: Range-end index is greater than the size of the file.");if(null!=e&&e<0)throw new dm("Invalid range: Range-start index cannot be negative.");return null!=e&&null!=t?{byteSize:t-e+1,start:e,end:t}:null==e&&null!=t?null==r?{end:t}:t===r?{byteSize:r,start:0,end:r-1}:{byteSize:t,start:r-t,end:r-1}:null!=e&&null==t?null==r?{start:e}:{byteSize:r-e,start:e,end:r-1}:{byteSize:r,start:0,end:null!=r?r-1:0}}(this.requestRangeStart??void 0,this.requestRangeEnd??void 0,this._fileSize??void 0);this.log.trace("set byteStart to %o, byteEnd to %o, byteSize to %o",e,t,r),this.byteStart=e,this.byteEnd=t,this.byteSize=r}catch(e){this.log.error("error setting offset details: %o",e),this.byteStart=void 0,this.byteEnd=void 0,this.byteSize=void 0}}get contentRangeHeaderValue(){if(!this.isValidRangeRequest)throw this.log.error("cannot get contentRangeHeaderValue for invalid range request"),new dm("Invalid range request");return function({byteStart:e,byteEnd:t,byteSize:r}){let n=r??"*";if((t??0)>=(r??1/0))throw new dm("Invalid range: Range-end index is greater than or equal to the size of the file.");if((e??0)>=(r??1/0))throw new dm("Invalid range: Range-start index is greater than or equal to the size of the file.");if(null!=e&&null==t)return null==r?`bytes */${n}`:`bytes ${e}-${r-1}/${r}`;if(null==e&&null!=t){if(null==r)return`bytes */${n}`;let e=r-1;return`bytes ${e-t+1}-${e}/${r}`}return null==e&&null==t?`bytes */${n}`:`bytes ${e}-${t}/${n}`}({byteStart:this.byteStart,byteEnd:this.byteEnd,byteSize:this._fileSize??void 0})}}let dS={[up]:["application/json","application/vnd.ipld.dag-cbor","application/cbor","application/vnd.ipld.dag-json","application/octet-stream","application/vnd.ipld.raw","application/vnd.ipfs.ipns-record","application/vnd.ipld.car"],[uB]:["application/json","application/vnd.ipld.dag-cbor","application/cbor","application/vnd.ipld.dag-json","application/octet-stream","application/vnd.ipld.raw","application/vnd.ipfs.ipns-record","application/vnd.ipld.car"],[eB]:["application/json","application/vnd.ipld.dag-cbor","application/cbor","application/vnd.ipld.dag-json","application/octet-stream","application/vnd.ipld.raw","application/vnd.ipfs.ipns-record","application/vnd.ipld.car"],[uQ]:["application/octet-stream","application/json","application/vnd.ipld.dag-cbor","application/cbor","application/vnd.ipld.dag-json","application/vnd.ipld.raw","application/vnd.ipfs.ipns-record","application/vnd.ipld.car","application/x-tar"],[e_]:["application/octet-stream","application/vnd.ipld.raw","application/vnd.ipfs.ipns-record","application/vnd.ipld.dag-json","application/vnd.ipld.car","application/x-tar"]},dk={raw:"application/vnd.ipld.raw",car:"application/vnd.ipld.car","dag-json":"application/vnd.ipld.dag-json","dag-cbor":"application/vnd.ipld.dag-cbor",json:"application/json",cbor:"application/cbor","ipns-record":"application/vnd.ipfs.ipns-record",tar:"application/x-tar"};function dA(e){let t=e.get("accept");return!!(null!=t&&Object.values(dk).includes(t))}function dx(e){let t=e?.format;return!!(null!=t&&Object.keys(dk).includes(t))}async function dI(e,t,r,n){let i=r.forComponent("helia:verified-fetch:get-stream-from-async-iterable"),s=e[Symbol.asyncIterator](),{value:o,done:a}=await s.next();if(!0===a)throw i.error("no content found for path",t),new dw;return{stream:new ReadableStream({async start(e){n?.onProgress?.(new lN("verified-fetch:request:progress:chunk")),e.enqueue(o)},async pull(e){let{value:t,done:r}=await s.next();if(n?.signal?.aborted===!0){e.error(new tc(n.signal.reason??"signal aborted by user")),e.close();return}if(!0===r){null!=t&&(n?.onProgress?.(new lN("verified-fetch:request:progress:chunk")),e.enqueue(t)),e.close();return}n?.onProgress?.(new lN("verified-fetch:request:progress:chunk")),e.enqueue(t)}}),firstChunk:o}}class dB extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class dC extends dB{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class dN extends dB{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}let dT=Symbol.for("@achingbrain/uint8arraylist");function d_(e,t){if(null==t||t<0)throw RangeError("index is out of bounds");let r=0;for(let n of e){let e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw RangeError("index is out of bounds")}function dL(e){return!!e?.[dT]}class dR{bufs;length;[dT]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(dL(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(dL(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=d_(this.bufs,e);return t.buf[t.index]}set(e,t){let r=d_(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(dL(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(!Number.isNaN(e=Math.trunc(e))&&!(e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:r,length:n}=this._subList(e,t);return rg(r,n)}subarray(e,t){let{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:rg(r,n)}sublist(e,t){let{bufs:r,length:n}=this._subList(e,t),i=new dR;return i.length=n,i.bufs=[...r],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};let r=[],n=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],o=n,a=o+s.byteLength;if(n=a,e>=a)continue;let l=e>=o&&e<a,u=t>o&&t<=a;if(l&&u){if(e===o&&t===a){r.push(s);break}let n=e-o;r.push(s.subarray(n,n+(t-e)));break}if(l){if(0===e){r.push(s);continue}r.push(s.subarray(e-o));continue}if(u){if(t===a){r.push(s);break}r.push(s.subarray(0,t-o));break}r.push(s)}return{bufs:r,length:t-e}}indexOf(e,t=0){let r;if(!dL(e)&&!(e instanceof Uint8Array))throw TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(isNaN(t=Number(t??0))&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;let i=n.byteLength;if(0===i)throw TypeError("search must be at least 1 byte long");let s=new Int32Array(256);for(let e=0;e<256;e++)s[e]=-1;for(let e=0;e<i;e++)s[n[e]]=e;let o=this.byteLength-n.byteLength,a=n.byteLength-1;for(let e=t;e<=o;e+=r){r=0;for(let t=a;t>=0;t--){let i=this.get(e+t);if(n[t]!==i){r=Math.max(1,t-s[i]);break}}if(0===r)return e}return -1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let r=e8(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){let n=e2(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){let n=e2(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){let n=e2(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let r=e8(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){let n=e2(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){let n=e2(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){let n=e2(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){let n=e2(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){let n=e2(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e||!(e instanceof dR)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!e9(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let r=new dR;return r.bufs=e,null==t&&(t=e.reduce((e,t)=>e+t.byteLength,0)),r.length=t,r}}e7("ustar\0","binary"),e7("ustar ","binary"),e7(" \0","binary");var dO=r(22604);let dP=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t=new Uint8Array(0);for await(let r of e)t=rg([t,r],t.length+r.length);return t})();let t=[],r=0;for(let n of e)t.push(n),r+=n.byteLength;return rg(t,r)},dU=e7("ustar\0","binary"),dD=e7("00","binary"),dF=parseInt("7777",8),d$=function(e){switch(e){case"file":default:return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}},dM=function(e){let t=256;for(let r=0;r<148;r++)t+=e[r];for(let r=156;r<512;r++)t+=e[r];return t},dz=function(e,t){let r=e.toString(8);return r.length>t?e7("7777777777777777777".slice(0,t)+" "):e7("0000000000000000000".slice(0,t-r.length)+r+" ")},dH=function(e){let t=e7(e).byteLength,r=Math.floor(Math.log(t)/Math.log(10))+1;return t+r>=Math.pow(10,r)&&r++,`${t+r}${e}`};function dV(e){let t=new Uint8Array(512),r=e.name,n="";if(5===e.typeflag&&"/"!==r[r.length-1]&&(r+="/"),e7(r).byteLength!==r.length)return null;for(;e7(r).byteLength>100;){let e=r.indexOf("/");if(-1===e)return null;n+=""!==n?"/"+r.slice(0,e):r.slice(0,e),r=r.slice(e+1)}return e7(r).byteLength>100||e7(n).byteLength>155||null!=e.linkname&&e7(e.linkname).byteLength>100?null:(t.set(e7(r),0),t.set(dz(e.mode&dF,6),100),t.set(dz(e.uid,6),108),t.set(dz(e.gid,6),116),t.set(dz(e.size,11),124),t.set(dz(e.mtime.getTime()/1e3|0,11),136),t[156]=48+d$(e.type),null!=e.linkname&&t.set(e7(e.linkname),157),t.set(dU,257),t.set(dD,263),null!=e.uname&&t.set(e7(e.uname),265),null!=e.gname&&t.set(e7(e.gname),297),t.set(dz(e.devmajor??0,6),329),t.set(dz(e.devminor??0,6),337),null!=n&&t.set(e7(n),345),t.set(dz(dM(t),6),148),t)}let{S_IFMT:dq,S_IFBLK:dj,S_IFCHR:dG,S_IFDIR:dW,S_IFIFO:dK,S_IFLNK:dY}=dO,dJ=parseInt("755",8),dZ=parseInt("644",8),dX=new Uint8Array(1024);function dQ(e){return 0!=(e&=511)?dX.subarray(0,512-e):new Uint8Array(0)}function d0(e){if(null==e.pax){let t=dV(e);if(null!=t)return t}return function(e){let t=function(e){let t="";null!=e.name&&(t+=dH(" path="+e.name+"\n")),null!=e.linkname&&(t+=dH(" linkpath="+e.linkname+"\n"));let r=e.pax;if(null!=r)for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t+=dH(" "+e+"="+r[e]+"\n"));return e7(t)}(e),r={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname,uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};return new dR(dV(r)??new Uint8Array(0),t,dQ(t.length),dV({...r,size:e.size,type:e.type})??new Uint8Array(0)).subarray()}(e)}function d1(){return async function*(e){for await(let{header:t,body:r}of e){let e={...t,size:"symlink"===t.type?0:t.size??0,type:t.type??function(e=0){switch(e&dq){case dj:return"block-device";case dG:return"character-device";case dW:return"directory";case dK:return"fifo";case dY:return"symlink";default:return"file"}}(t.mode),mode:t.mode??("directory"===t.type?dJ:dZ),uid:t.uid??0,gid:t.gid??0,mtime:t.mtime??new Date};if("string"==typeof r&&(r=e7(r)),r instanceof Uint8Array||dL(r)){e.size=r.length,yield d0(e),yield dL(r)?r.subarray():r,yield dQ(e.size);continue}if("symlink"===e.type&&null==e.linkname){if(null==r)throw Error("type was symlink but no linkname or body specified");e.linkname=ru(await dP(r)),yield d0(e);continue}if(yield d0(e),"file"!==e.type&&"contiguous-file"!==e.type)continue;let n=0;for await(let e of r??[])n+=e.length,yield dL(e)?e.subarray():e;if(n!==e.size)throw Error(`size mismatch, wrote ${n} of ${e.size} bytes`);yield dQ(e.size)}yield dX}}let d2=["file","raw","directory"];function d8(e){let t,r;if(!d2.includes(e.type))throw new dC(`${e.type} is not a UnixFS node`);let n={header:(("file"===e.type||"directory"===e.type)&&(t=e.unixfs.mode,r=null!=e.unixfs.mtime?new Date(Number(1000n*e.unixfs.mtime.secs)):void 0),{name:e.path,mode:t,mtime:r,size:Number(e.size),type:"directory"===e.type?"directory":"file"})};return("file"===e.type||"raw"===e.type)&&(n.body=e.content()),n}async function*d6(e,t,r){let n=await de(e,t,r);if("file"===n.type||"raw"===n.type){yield*hw([d8(n)],d1());return}if("directory"===n.type){yield*hw(dt(e,t,r),e=>a4(e,e=>d8(e)),d1());return}throw new dC("Not a UnixFS node")}class d4{lru;constructor(e){this.lru=lR(e)}get(e){let t=this.lru.get(e);if(null!=t){if(null!=t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,r){this.lru.set(e,{value:t,expire:Date.now()+r})}has(e){return null!=this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}let d3=new d4(1e3),d5=/^(?<protocol>ip[fn]s):\/\/(?<cidOrPeerIdOrDnsLink>[^/?]+)\/?(?<path>[^?]*)\??(?<queryString>.*)$/,d7=/^\/(?<protocol>ip[fn]s)\/(?<cidOrPeerIdOrDnsLink>[^/?]+)\/?(?<path>[^?]*)\??(?<queryString>.*)$/,d9=/^https?:\/\/(.*[^/])\/(?<protocol>ip[fn]s)\/(?<cidOrPeerIdOrDnsLink>[^/?]+)\/?(?<path>[^?]*)\??(?<queryString>.*)$/,fe=/^https?:\/\/(?<cidOrPeerIdOrDnsLink>[^/?]+)\.(?<protocol>ip[fn]s)\.([^/?]+)\/?(?<path>[^?]*)\??(?<queryString>.*)$/;function ft(e){for(let t of[fe,d5,d9,d7]){let r=e.match(t);if(function(e){let t=e?.protocol;if(null==t)return!1;let r=e?.cidOrPeerIdOrDnsLink;if(null==r)return!1;let n=e?.path,i=e?.queryString;return["ipns","ipfs"].includes(t)&&"string"==typeof r&&(null==n||"string"==typeof n)&&(null==i||"string"==typeof i)}(r?.groups))return r.groups}throw TypeError(`Invalid URL: ${e}, please use ipfs://, ipns://, or gateway URLs only`)}let fr=/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/;async function fn({urlString:e,ipns:t,logger:r},n){var i,s;let o,a,l,u;let h=r.forComponent("helia:verified-fetch:parse-url-string"),{protocol:c,cidOrPeerIdOrDnsLink:d,path:f,queryString:p}=ft(e),g=[];if("ipfs"===c)try{o=eJ.parse(d)}catch(e){h.error(e),g.push(TypeError("Invalid CID for ipfs://<cid> URL"))}else if(null!=(l=d3.get(d)))o=l.cid,a=l.path,h.trace("resolved %s to %c from cache",d,o);else{let e;h.trace("Attempting to resolve PeerId for %s",d);try{if(e="1"===d.charAt(0)||"Q"===d.charAt(0)?ou(d):oc(eJ.parse(d)),null==e.publicKey)throw TypeError("cidOrPeerIdOrDnsLink contains no public key");l=await t.resolve(e.publicKey,n),o=l?.cid,a=l?.path,h.trace("resolved %s to %c",d,o)}catch(t){n?.signal?.throwIfAborted(),null==e?(h.error('could not parse PeerId string "%s"',d,t),g.push(TypeError(`Could not parse PeerId in ipns url "${d}", ${t.message}`))):(h.error("could not resolve PeerId %c",e,t),g.push(TypeError(`Could not resolve PeerId "${d}", ${t.message}`)))}if(null==o){let e=d;fr.test(d)&&d.includes("-")&&!d.includes(".")&&(e=d.replace(/--/g,"%").replace(/-/g,".").replace(/%/g,"-"),h.trace('decoded dnslink from "%s" to "%s"',d,e)),h.trace("Attempting to resolve DNSLink for %s",e);try{l=await t.resolveDNSLink(e,n),o=l?.cid,a=l?.path,h.trace("resolved %s to %c",e,o)}catch(e){n?.signal?.throwIfAborted(),h.error('could not resolve DnsLink for "%s"',d,e),g.push(e)}}}if(null==o){if(1===g.length)throw g[0];throw AggregateError(g,`Invalid resource. Cannot determine CID from URL "${e}"`)}let y=function(e){if(null==e)return;let t=e.answer?.TTL,r=e.record?.ttl,n=null!=r?Number(r/BigInt(1e9)):void 0;return t??n}(l);null!=l&&(y=y??120,h.trace("caching %s resolved to %s with TTL: %s",d,o,y),d3.set(d,l,1e3*y));let m={};if(null!=p&&p.length>0){for(let e of p.split("&")){let[t,r]=e.split("=");m[t]=decodeURIComponent(r)}null!=m.download&&(m.download="true"===m.download),null!=m.filename&&(m.filename=m.filename.toString())}return{protocol:c,cid:o,path:(i=a,s=f??"",u="",null!=i&&(u+=i),s.length>0&&(u=`${u.length>0?`${u}/`:u}${s}`),(u=u.replace(/\/(\/)+/g,"/")).startsWith("/")&&(u=u.substring(1)),u.split("/").map(decodeURIComponent).join("/")),query:m,ttl:y,ipfsPath:`/${c}/${d}${null!=f&&""!==f?`/${f}`:""}`}}function fi(e,t,r){Object.defineProperty(e,t,{enumerable:!0,configurable:!1,set:()=>{},get:()=>r})}function fs(e,t){fi(e,"type",t)}function fo(e,t){fi(e,"url",t)}function fa(e){fi(e,"redirected",!0)}function fl(e,t,r){let n=new Response(t,{...r??{},status:200,statusText:"OK"});return r?.redirected===!0&&fa(n),fs(n,"basic"),fo(n,e),n.headers.set("Accept-Ranges","bytes"),n}function fu(e,t,r){let n=new Response(t,{...r??{},status:502,statusText:"Bad Gateway"});return fs(n,"basic"),fo(n,e),n}function fh(e,t,r){let n=new Response(t,{...r??{},status:501,statusText:"Not Implemented"});return n.headers.set("X-Content-Type-Options","nosniff"),fs(n,"basic"),fo(n,e),n}function fc(e,t,r){let n=new Response(t,{...r??{},status:406,statusText:"Not Acceptable"});return fs(n,"basic"),fo(n,e),n}function fd(e,t,r){let n=new Response(t,{...r??{},status:404,statusText:"Not Found"});return fs(n,"basic"),fo(n,e),n}function ff(e,t,r){t instanceof Error&&(t=t.message);let n=new Response(t,{...r??{},status:400,statusText:"Bad Request"});return fs(n,"basic"),fo(n,e),n}function fp(e,t,r){let n=new Response(null,{...r??{},status:301,statusText:"Moved Permanently",headers:{...r?.headers??{},location:t}});return fs(n,"basic"),fo(n,e),n}function fg(e,t,{byteRangeContext:r,log:n},i){let s;if(!r.isRangeRequest)return fl(e,t,i);if(!r.isValidRangeRequest)return fy(e,t,i);try{s=new Response(t,{...i??{},status:206,statusText:"Partial Content",headers:{...i?.headers??{},"content-range":r.contentRangeHeaderValue}})}catch(r){return n?.error("failed to create range response",r),fy(e,t,i)}return i?.redirected===!0&&fa(s),fs(s,"basic"),fo(s,e),s.headers.set("Accept-Ranges","bytes"),s}function fy(e,t,r){let n=new Response(t,{...r??{},status:416,statusText:"Requested Range Not Satisfiable"});return fs(n,"basic"),fo(n,e),n}function fm(e){return null!=e.match(/\.[a-zA-Z0-9]{1,4}$/)?e:e.endsWith("/")?e:`${e}/`}async function fw({resource:e,options:t,logger:r,cid:n,fetch:i=globalThis.fetch}){let s=r.forComponent("helia:verified-fetch:get-redirect-response");if("string"!=typeof e||null==t||["ipfs://","ipns://"].some(t=>e.startsWith(t)))return null;let o=new Headers(t?.headers),a=o.get("x-forwarded-host"),l=o.get("host");if(null==o.get("x-forwarded-for")&&null==a&&null==l)return s.trace("no redirect info found in headers"),null;s.trace("checking for redirect info");try{let t=ft(e),r=new URL(e),o=a??r.host,u=new URL(r);if("ipfs"===t.protocol&&0===n.version?u.host=`${n.toV1()}.ipfs.${o}`:u.host=`${t.cidOrPeerIdOrDnsLink}.${t.protocol}.${o}`,l?.includes(t.protocol)===!0&&u.host.includes(l))return s.trace("request was for a subdomain already, not setting location header"),null;if(null!=l&&!u.host.includes(l))return s.trace("host header is not the same as the subdomain url host, not setting location header"),null;if(r.host===u.host)return s.trace("req url is the same as the subdomain url, not setting location header"),null;u.pathname=fm(r.pathname.replace(`/${t.cidOrPeerIdOrDnsLink}`,"").replace(`/${t.protocol}`,"")),s.trace("subdomain url %s",u.href);let h=new URL(r,`${r.protocol}//${o}`);h.pathname=fm(r.pathname),s.trace("path url %s",h.href);try{let t=await i(u,{method:"HEAD"});if(t.ok)return s("subdomain supported, redirecting to subdomain"),fp(e.toString(),u.href);throw s("subdomain not supported, subdomain failed with status %s %s",t.status,t.statusText),new db("subdomain not supported")}catch(t){if(s("subdomain not supported",t),h.href===r.href)return s("path url is the same as the request url, not setting location header"),null;return fp(e.toString(),h.href)}}catch(e){s.error("error setting location header for x-forwarded-host",e)}return null}async function fb(e,{ipns:t,logger:r},n){if("string"==typeof e)return fn({urlString:e,ipns:t,logger:r},n);let i=eJ.asCID(e);if(null!=i)return{cid:i,protocol:"ipfs",path:"",query:{},ipfsPath:`/ipfs/${i.toString()}`,ttl:0x1baf800};throw TypeError(`Invalid resource. Cannot determine CID from resource: ${e}`)}async function fv(e,t,r){let n;let i=[];for await(let s of c9(t,e,r))i.push(s.cid),n=s;if(null==n)throw new dN("No terminal element found");return{ipfsRoots:i,terminalElement:n}}async function fE({cid:e,path:t,resource:r,options:n,blockstore:i,log:s}){try{return await fv(i,`${e.toString()}/${t}`,n)}catch(e){if(n?.signal?.throwIfAborted(),["ERR_NO_PROP","ERR_NO_TERMINAL_ELEMENT","ERR_NOT_FOUND"].includes(e.code))return fd(r);return s.error("error walking path %s",t,e),fu(r,"Error walking path")}}let fS=["application/vnd.ipld.dag-json","application/vnd.ipld.raw","application/octet-stream"];class fk{helia;ipns;log;contentTypeParser;blockstoreSessions;constructor({helia:e,ipns:t},r){this.helia=e,this.log=e.logger.forComponent("helia:verified-fetch"),this.ipns=t??function(e,{routers:t=[]}={}){return new ch(e,t)}(e),this.contentTypeParser=r?.contentTypeParser,this.blockstoreSessions=new dy({max:r?.sessionCacheSize??100,ttl:r?.sessionTTLms??6e4,dispose:e=>{e.close()}}),this.log.trace("created VerifiedFetch instance")}getBlockstore(e,t,r,n){let i=function(e){let t=eJ.asCID(e);if(null!=t)return`ipfs://${t}`;try{return`ipfs://${eJ.parse(e.toString())}`}catch{}let{protocol:r,cidOrPeerIdOrDnsLink:n}=ft(e.toString());return`${r}://${n}`}(t);if(!r)return this.helia.blockstore;let s=this.blockstoreSessions.get(i);return null==s&&(s=this.helia.blockstore.createSession(e,n),this.blockstoreSessions.set(i,s)),s}async handleIPNSRecord({resource:e,cid:t,path:r,options:n}){let i;if(""!==r||!e.startsWith("ipns://"))return ff(e,"Invalid IPNS name");try{i=ou(e.replace("ipns://",""))}catch(t){return this.log.error("could not parse peer id from IPNS url %s",e),ff(e,t)}let s=new lM("/dht/record/"+ru(rg([e7("/ipns/"),i.toMultihash().bytes]),"base32"),!1),o=await this.helia.datastore.get(s,n),a=fl(e,cs.deserialize(o).value);return a.headers.set("content-type","application/vnd.ipfs.ipns-record"),a}async handleCar({resource:e,cid:t,session:r,options:n}){let i=dr((function(e,t={}){return new hQ(e,t)})({blockstore:this.getBlockstore(t,e,r,n),getCodec:this.helia.getCodec}).stream(t,n)),s=fl(e,i);return s.headers.set("content-type","application/vnd.ipld.car; version=1"),s}async handleTar({resource:e,cid:t,path:r,session:n,options:i}){if(t.code!==uQ&&t.code!==e_)return fc("only UnixFS data can be returned in a TAR file");let s=this.getBlockstore(t,e,n,i),o=fl(e,dr(d6(`/ipfs/${t}/${r}`,s,i)));return o.headers.set("content-type","application/x-tar"),o}async handleJson({resource:e,cid:t,path:r,accept:n,session:i,options:s}){let o;this.log.trace("fetching %c/%s",t,r);let a=this.getBlockstore(t,e,i,s),l=await a.get(t,s);if("application/vnd.ipld.dag-cbor"===n||"application/cbor"===n)try{let e=uN(l);o=ug(e)}catch(t){return this.log.error("could not transform %c to application/vnd.ipld.dag-cbor",t),fc(e)}else o=l;let u=fl(e,o);return u.headers.set("content-type",n??"application/json"),u}async handleDagCbor({resource:e,cid:t,path:r,accept:n,session:i,options:s}){let o;this.log.trace("fetching %c/%s",t,r);let a=this.getBlockstore(t,e,i,s),l=await fE({cid:t,path:r,resource:e,options:s,blockstore:a,log:this.log});if(l instanceof Response)return l;let u=l.ipfsRoots;if("object"!==l.terminalElement.type)return this.log.error("terminal element is not a dag-cbor node"),fh(e,"Terminal element is not a dag-cbor node");let h=l.terminalElement.node;if("application/octet-stream"===n||"application/vnd.ipld.dag-cbor"===n||"application/cbor"===n)o=h;else if("application/vnd.ipld.dag-json"===n)try{let e=uy(h);o=uC(e)}catch(t){return this.log.error("could not transform %c to application/vnd.ipld.dag-json",t),fc(e)}else try{o=function(e){let t=ax(e,{allowIndefinite:!1,coerceUndefinedToNull:!1,allowNaN:!1,allowInfinity:!1,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,allowBigInt:!1});return new TextDecoder().decode(ub(t))}(h)}catch(t){if("application/json"===n)return this.log('could not decode DAG-CBOR as JSON-safe, but the client sent "Accept: application/json"',t),fc(e);this.log("could not decode DAG-CBOR as JSON-safe, falling back to `application/octet-stream`",t),o=h}let c=fl(e,o);return null==n&&(n=o instanceof Uint8Array?"application/octet-stream":"application/json"),c.headers.set("content-type",n),dv(c,u),c}async handleDagPb({cid:e,path:t,resource:r,session:n,options:i}){let s=!1,o=new dE(this.helia.logger,i?.headers),a=this.getBlockstore(e,r,n,i),l=await fE({cid:e,path:t,resource:r,options:i,blockstore:a,log:this.log});if(l instanceof Response)return l;let u=l.ipfsRoots,h=l.terminalElement,c=h.cid;if(h?.type==="directory"){let n=h.cid;if(""===t?!r.toString().endsWith("/"):!t.endsWith("/")){if(i?.redirect==="error")throw this.log('could not redirect to %s/ as redirect option was set to "error"',r),TypeError("Failed to fetch");if(i?.redirect==="manual")return this.log("returning 301 permanent redirect to %s/",r),fp(r,`${r}/`);r=`${r}/`,s=!0}let o="index.html";try{this.log.trace("found directory at %c/%s, looking for index.html",e,t);let r=await de(`/ipfs/${n}/${o}`,this.helia.blockstore,{signal:i?.signal,onProgress:i?.onProgress});this.log.trace("found root file at %c/%s with cid %c",n,o,r.cid),t=o,c=r.cid}catch(e){return i?.signal?.throwIfAborted(),this.log("error loading path %c/%s",n,o,e),fh("Unable to find index.html for directory at given path. Support for directories with implicit root is not implemented")}finally{i?.onProgress?.(new lN("verified-fetch:request:end",{cid:n,path:o}))}}o.isRangeRequest&&o.isValidRangeRequest&&"file"===h.type&&(o.setFileSize(h.unixfs.fileSize()),this.log.trace("fileSize for rangeRequest %d",o.getFileSize()));let d=o.offset,f=o.length;this.log.trace("calling exporter for %c/%s with offset=%o & length=%o",c,t,d,f);try{let n=(await de(c,this.helia.blockstore,{signal:i?.signal,onProgress:i?.onProgress})).content({signal:i?.signal,onProgress:i?.onProgress,offset:d,length:f});this.log("got async iterator for %c/%s",e,t);let{stream:a,firstChunk:l}=await dI(n,t??"",this.helia.logger,{onProgress:i?.onProgress,signal:i?.signal});o.setBody(a);let h=fg(r,o.getBody(),{byteRangeContext:o,log:this.log},{redirected:s});return await this.setContentType(l,t,h),dv(h,u),h}catch(n){if(i?.signal?.throwIfAborted(),this.log.error("error streaming %c/%s",e,t,n),o.isRangeRequest&&"ERR_INVALID_PARAMS"===n.code)return fy(r);return fu(r.toString(),"Unable to stream content")}}async handleRaw({resource:e,cid:t,path:r,session:n,options:i,accept:s}){if(""!==r)return this.log.trace("404-ing raw codec request for %c/%s",t,r),fd(e,"Raw codec does not support paths");let o=new dE(this.helia.logger,i?.headers),a=this.getBlockstore(t,e,n,i),l=await a.get(t,i);o.setBody(l);let u=fg(e,o.getBody(),{byteRangeContext:o,log:this.log},{redirected:!1});return await this.setContentType(l,r,u,function({headers:e,accept:t}){for(let r of(t??new Headers(e).get("accept")??"").split(",").map(e=>e.split(";")[0]).map(e=>e.trim())){if("*/*"===r)return;if(fS.includes(r??""))return r}}({headers:i?.headers,accept:s})),u}async setContentType(e,t,r,n="application/octet-stream"){let i;if(null!=this.contentTypeParser)try{let r=t.split("/").pop()?.trim();r=""===r?void 0:r;let n=this.contentTypeParser(e,r);if(n?.then!=null){let e=await n;null!=e&&(i=e)}else null!=n&&(i=n)}catch(e){this.log.error("error parsing content type",e)}this.log.trace('setting content type to "%s"',i??n),r.headers.set("content-type",i??n)}codecHandlers={[uQ]:this.handleDagPb,[uB]:this.handleJson,[eB]:this.handleJson,[up]:this.handleDagCbor,[e_]:this.handleRaw,[ez.code]:this.handleRaw};async fetch(e,t){let r,n,i,s,o,a,l,u,h;this.log("fetch %s",e);let c=function(e){let t;if(null!=e)return t=e?.signal===null?void 0:e?.signal,{...e,signal:t}}(t);c?.onProgress?.(new lN("verified-fetch:request:start",{resource:e}));try{let t=await fb(e,{ipns:this.ipns,logger:this.helia.logger},c);r=t.cid,n=t.path,i=t.query,s=t.ttl,o=t.protocol,a=t.ipfsPath}catch(t){return c?.signal?.throwIfAborted(),this.log.error("error parsing resource %s",e,t),ff(e.toString(),t)}c?.onProgress?.(new lN("verified-fetch:request:resolve",{cid:r,path:n}));let d=function({query:e,headers:t,logger:r}){let n=r.forComponent("helia:verified-fetch:get-resolved-accept-header"),i=new Headers(t),s=i.get("accept")??void 0;if(null!=s&&n('incoming accept header "%s"',s),!function({query:e,headers:t}){return dA(t)||dx(e)}({query:e,headers:i}))return n("no explicit IPLD content-type requested, returning incoming accept header %s",s),s;let o=function(e){if(null!=e)return dk[e]}(e?.format);e?.format!=null&&n('incoming query format "%s", mapped to %s',e.format,o);let a=s;return!dA(i)&&dx(e)&&(n("accept header not recognized, but query format provided, setting accept header to %s",o),a=o),n('resolved accept header to "%s"',a),a}({query:i,headers:c?.headers,logger:this.helia.logger}),f=function(e,t){let r=dS[e.code];if(null!=t)return function(e,t){for(let r of e.split(",").map(e=>{let t=e.trim().split(";");return{mimeType:`${t[0]}`.trim(),weight:function(e){if(null!=e&&(e=e.trim()),e?.startsWith("q=")!==!0)return 1;let t=parseFloat(e.replace("q=",""));return isNaN(t)?0:t}(t[1])}}).sort((e,t)=>e.weight===t.weight?0:e.weight>t.weight?-1:1).map(e=>e.mimeType))for(let e of t)if(r.includes(e)||"*/*"===r||r.startsWith("*/")&&e.split("/")[1]===r.split("/")[1]||r.endsWith("/*")&&e.split("/")[0]===r.split("/")[0])return e}(t,r)}(r,d);if(this.log("output type %s",f),null!=d&&null==f)return fc(e.toString());let p=await fw({resource:e,options:c,logger:this.helia.logger,cid:r});if(null!=p)return p;let g={resource:e.toString(),cid:r,path:n,accept:f,session:c?.session??!0,options:c};if("application/vnd.ipfs.ipns-record"===f)u="ipns-record",l=await this.handleIPNSRecord(g);else if("application/vnd.ipld.car"===f)u="car",i.download=!0,i.filename=i.filename??`${r.toString()}.car`,l=await this.handleCar(g);else if("application/vnd.ipld.raw"===f)u="raw",i.download=!0,i.filename=i.filename??`${r.toString()}.bin`,l=await this.handleRaw(g);else if("application/x-tar"===f)u="tar",i.download=!0,i.filename=i.filename??`${r.toString()}.tar`,l=await this.handleTar(g);else{this.log.trace('finding handler for cid code "%s" and output type "%s"',r.code,f);let e=this.codecHandlers[r.code];if(null==e)return fh(`Support for codec with code ${r.code} is not yet implemented. Please open an issue at https://github.com/ipfs/helia-verified-fetch/issues/new`);this.log.trace('calling handler "%s"',e.name),l=await e.call(this,g)}return l.headers.set("etag",function({cid:e,reqFormat:t,weak:r,rangeStart:n,rangeEnd:i}){let s=null==t?"":`.${t}`;return(null!=n||null!=i)&&(s+=`.${n??"0"}-${i??"N"}`),`${!0===r?"W/":""}"${e.toString()}${s}"`}({cid:r,reqFormat:u,weak:!1})),!function({ttl:e,protocol:t,response:r}){let n;n="ipfs"===t?"public, max-age=29030400, immutable":null==e?"public, max-age=300":`public, max-age=${e}`,r.headers.set("cache-control",n)}({response:l,ttl:s,protocol:o}),l.headers.set("X-Ipfs-Path",a),!0===i.download&&(h="attachment"),null!=i.filename&&(null==h&&(h="inline"),h=`${h}; ${function(e){let t=e.replace(/[^\x00-\x7F]/g,"_");return t===e?`filename="${e}"`:`filename="${t}"; filename*=UTF-8''${encodeURIComponent(e)}`}(i.filename)}`),null!=h&&l.headers.set("Content-Disposition",h),c?.onProgress?.(new lN("verified-fetch:request:end",{cid:r,path:n})),l}async start(){await this.helia.start()}async stop(){await this.helia.stop()}}async function fA(e,t){var r,n;r=e,r?.blockstore!=null&&r?.datastore!=null&&r?.gc!=null&&r?.stop!=null&&r?.start!=null||(e=await hA({blockBrokers:[r0({allowInsecure:e?.allowInsecure,allowLocal:e?.allowLocal})],routers:[...(e?.routers??["https://delegated-ipfs.dev"]).map(e=>lo(e)),lx({gateways:e?.gateways??["https://trustless-gateway.link"]})],dns:null==(n=e?.dnsResolvers)?void 0:Array.isArray(n)?lU({resolvers:{".":n}}):lU({resolvers:n})}));let i=new fk({helia:e},t);async function s(e,t){return i.fetch(e,t)}return s.stop=i.stop.bind(i),s.start=i.start.bind(i),s}let fx=async function(e,t){return null==i&&(i=await fA()),i(e,t)};fx.start=async function(){await i?.start()},fx.stop=async function(){await i?.stop()}},8621:(e,t,r)=>{"use strict";r.d(t,{J:()=>function e(t,r,i){if(null==t)return i;switch(typeof r){case"string":{let s=t[r];if(void 0===s){if(function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}(r))return e(t,(0,n.b)(r),i);return i}return s}case"number":case"symbol":{if("number"==typeof r){var s;r=Object.is(s=r,-0)?"-0":s.toString()}let e=t[r];if(void 0===e)return i;return e}default:{if(Array.isArray(r))return function(e,t,r){if(0===t.length)return r;let n=e;for(let e=0;e<t.length;e++){if(null==n)return r;n=n[t[e]]}return void 0===n?r:n}(t,r,i);let e=t[r=Object.is(r?.valueOf(),-0)?"-0":String(r)];if(void 0===e)return i;return e}}}});var n=r(60855)},60855:(e,t,r)=>{"use strict";function n(e){let t=[],r=e.length;if(0===r)return t;let n=0,i="",s="",o=!1;for(46===e.charCodeAt(0)&&(t.push(""),n++);n<r;){let a=e[n];s?"\\"===a&&n+1<r?i+=e[++n]:a===s?s="":i+=a:o?'"'===a||"'"===a?s=a:"]"===a?(o=!1,t.push(i),i=""):i+=a:"["===a?(o=!0,i&&(t.push(i),i="")):"."===a?i&&(t.push(i),i=""):i+=a,n++}return i&&t.push(i),t}r.d(t,{b:()=>n})}}]);
//# sourceMappingURL=2881-07abb0d83c440c3e.js.map